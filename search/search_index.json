{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"clojure-lsp # A Language Server for Clojure(script). Taking a Cursive-like approach of statically analyzing code. homepage \u2022 features \u2022 installation \u2022 settings \u2022 clients \u2022 troubleshooting \u2022 support us Overview # The goal of this project is to bring great editing tools for Clojure/Clojurescript to all editors and programatically via its CLI and API. It aims to work alongside you to help you navigate, identify and fix errors, perform refactors and much more! You will get: Autocomplete Jump to definition/implementation Find references Renaming Code actions Errors Automatic ns cleaning Lots of Refactorings Code lens Semantic tokens (syntax highlighting) Call hierarchy Java interop For all available documentation, check the official website . Also, clojure-lsp doesn't need to run only with an editor, for more information check the Outside editor (API) section. Contribution # Contributions to clojure-lsp are very welcome! You can open an issue or a PR and we will love to help. Support the project # clojure-lsp has more than 30.000 lines of code, to keep all of this working, we need to help the community with a lot of issues and implement new features. As a LSP server, this project is the base for Clojure clients like Emacs(lsp-mode), VSCode(Calva), vim and other editors. You can help us keep going and improving it by supporting the project , the support helps to keep the project going and being updated and maintained. Thank you to Clojurists Together which sponsored this project during Q3 2021 and Q1 2022 Gold sponsors # No Gold sponsors at the moment Sponsors # Special thanks to Eccentric-J for the clojure-lsp logo","title":"Overview"},{"location":"#clojure-lsp","text":"A Language Server for Clojure(script). Taking a Cursive-like approach of statically analyzing code. homepage \u2022 features \u2022 installation \u2022 settings \u2022 clients \u2022 troubleshooting \u2022 support us","title":"clojure-lsp"},{"location":"#overview","text":"The goal of this project is to bring great editing tools for Clojure/Clojurescript to all editors and programatically via its CLI and API. It aims to work alongside you to help you navigate, identify and fix errors, perform refactors and much more! You will get: Autocomplete Jump to definition/implementation Find references Renaming Code actions Errors Automatic ns cleaning Lots of Refactorings Code lens Semantic tokens (syntax highlighting) Call hierarchy Java interop For all available documentation, check the official website . Also, clojure-lsp doesn't need to run only with an editor, for more information check the Outside editor (API) section.","title":"Overview"},{"location":"#contribution","text":"Contributions to clojure-lsp are very welcome! You can open an issue or a PR and we will love to help.","title":"Contribution"},{"location":"#support-the-project","text":"clojure-lsp has more than 30.000 lines of code, to keep all of this working, we need to help the community with a lot of issues and implement new features. As a LSP server, this project is the base for Clojure clients like Emacs(lsp-mode), VSCode(Calva), vim and other editors. You can help us keep going and improving it by supporting the project , the support helps to keep the project going and being updated and maintained. Thank you to Clojurists Together which sponsored this project during Q3 2021 and Q1 2022","title":"Support the project"},{"location":"#gold-sponsors","text":"No Gold sponsors at the moment","title":"Gold sponsors"},{"location":"#sponsors","text":"Special thanks to Eccentric-J for the clojure-lsp logo","title":"Sponsors"},{"location":"CHANGELOG/","text":"Changelog # Unreleased # General Fix move-form double edit problem in cljc files. Fix disabling :clojure-lsp/unused-public-var linter also disabling :clojure-lsp/different-aliases Bump clj-kondo to 2024.09.28-20240930.094425-2 Add support for ignoring tests references for the clojure-lsp/unused-public-var linter. #1878 2024.08.05-18.16.00 # General Fix CI for macos amd64. #1859 Replace CirrusCI with Github for macos-aarch64 binary standardizing deploy process. 2024.08.03-15.28.27 # General Bump clj-kondo to 2024.08.01 fixing high memory usage issue. Bump Clojure to 1.11.3 Fix use of :filename-pattern from kondo breaking references. Add api.dump to the pod namespace so it can be used with babashka. Editor Add clojure.test/deftest option to resolve macro as code action. #1850 Allow starting clojure-lsp without a project root but with limited features. #1815 Add code action \"Add require\" for namespaced keywords. #1793 2024.04.22-11.50.26 # General Bump clj-depend to 0.11.0 . Fix renaming ns when one source path is a prefix of another (e.g. src/clj and src/cljs ) #1805 Editor Use scope location instead of name location for folding feature. Fix paredit commands to consider previous element when cursor inside a closing bracket. Fix paredit commands to move cursor after applying command. Fix corner case on paredit comamnds duplicating forms. References of a var-definition now consider full quoted qualified symbols. #1804 2024.03.31-19.10.13 # Editor Adding require command fails for requires without alias. #1791 Add require command without alias now add requires with brackets. Project tree feature now support keyword definitions like re-frame sub/reg. #1789 Support textDocument/foldingRange LSP feature. #1602 Improve textDocument/documentSymbol considering keyword definitions and returning flatten elements. Fix Add require/import usages count in code actions. #1794. 2024.03.13-13.11.00 # General Bump clj-kondo to 2024.03.13 fixing high memory usage issue. Editor Fix workspace/didChangeConfiguration exception causing noise on logs. #1784 2024.03.01-11.37.51 # General Bump clj-kondo to 2024.02.13-20240228.191822-15 . Add :clojure-lsp/different-aliases linter. #1770 Fix unused-public-var false positives for definterface methods. #1762 Fix rename of records when usage is using an alias. #1756 Editor Fix documentation resolve not working for clients without hover markdown support. Added setting to allow requires and imports to be added within the current comment form during code action and completion: :add-missing :add-to-rcf #1316 Fix suppress-diagnostics not working on top-level forms when preceded by comment. #1678 Fix add missing import feature on some corner cases for java imports. #1754 Fix semantic tokens and other analysis not being applied for project files at root. #1759 Add support for adding missing requires and completion results referring to JS libraries which already have an alias in the project #1587 2024.02.01-11.01.59 # General Fix binary not wokring on some aarch64 linux. #1748 Add new Project tree feature via the clojure/workspace/projectTree/nodes custom method. #1752 Fix --log-path setting to work with listen /empty arg, starting clojure-lsp server and logging properly. Editor Fix didChangeConfiguration throwing exception. #1749 Fix rename of ns causing wrong ns names because of duplicate rename actions. #1751 Fix range-formatting throwing exceptions when unbalanced parens are sent from client. #1758 Fix rename functions need to clean up LSP state or restart in some clients implementing LSP method didRenameFiles . #1755 Fix thread last all failed after comment form #_(...) . #1745 2023.12.29-12.09.27 # General Fix deep-merge of client settings with project settings. Fix max-line-length on clean-ns feature not respecting some lines when contains a lot of refers. #1729 Bump cljfmt to 0.12.0. Bump clj-kondo to 2023.12.15 . Editor Fix edn tree visualization for keys with same name in the same level. #1558 Make clear when hover feature is in a calling and not in a specific symbol. #1281 Exclude keys that are already included in the function call from completion suggestions. #1720 API/CLI Drastically improves performance of format task matching cljfmt , avoiding analyzing the project. #1723 2023.10.30-16.25.41 # General Bump clj-kondo to 2023.10.21-20231022.204832-4 . Fix move-to-let/expand-let bug for multi-arity functions #1283 Fix :dependency-scheme setting for .java files from jars #1653 Bump graalvm to 21. Improve overall performance using GraalVM 21 PGO (Profile-Guided Optimizations). Extract the responsibility for merging clj-depend config #1265 Support passing configurations to clj-depend via CLI #1694 Bump clj-depend to 0.9.2 Performance: remove keyword-usages elements from external analysis as they are not used for any feature and for big projects may affect memory. #1700 Editor New paredit refactorings: forward-slurp forward-barf backward-slurp backward-barf raise kill Improve rename to avoid internal errors and show proper error messages. #1691 Exclude unused-public-vars when inside a comment block. Add :analysis-summary field to serverInfo command to get information about project for performance analysis. Add :analysis settings, with options to disable specific analysis for better performance on huge projects. #1700 2023.08.06-00.28.06 # General Fix truncation of namespaced keywords #1640 Add rewrite-clj node to cursor-info. Fixing semantic-tokens, collons not managed by lsp anymore. #1550 Fix :paths-ignore-regex setting to consider settings reload. Bump clj-kondo to 2023.07.14-20230717.090255-3 . #1624 Fix inconsistencies with :defined-by->lint-as . Improve memory usage during cache save, avoiding \"Out of memory\" exceptions. Prevent file rename when a namespace is defined in multiple files #1574 Fix user formatting setting being override by :style/indent metadata in macros. Bump cljfmt to 0.11.2 . #1634 Bump lsp4clj to 1.8.1 . Added functionality to workspace/didChangeConfiguration so it changes configuration on runtime. Editor Avoid returning all known keywords on empty keywords completion for performance reasons. API/CLI Improve mem/cpu usage using less analysis for tasks. 2023.07.01-22.35.41 # General Update flake.nix to build with babashka. #1373 Bump clj-kondo to 2023.06.02-20230630.144012-16 . Improve support for ClojureDart .cljd files. #1589 Slightly reduce OutOfMemory exceptions that may happen with the JVM version. Support ignore unused-public-vars via :linters :clojure-lsp/unused-public-var :exclude-when-contains-meta clj-kondo setting. Fix restructure-keys when map has an :or . #1583 Bump lsp4clj to 1.8.0 . Add post startup tasks progress feedbacks, like \"Generating stubs\", \"Analyzing JDK source\" and \"Fetching Clojars\". Bump cljfmt to 0.10.6 . #1605 Editor New code actions: Replace ':refer :all' with ':refer [my-refer]' and Replace ':refer :all' with alias . #1575 Enhance java support for hover and completion of static class members. Improve :paths-ignore-regex to ignore features avoiding impact in huge files that are intented to be excluded. Fixed semantic-tokens for full qualified namespace Add score to completion items for a better completion client sorting. #1595 Revamp keyword completion. #1599 Avoid LSP errors when cleaning a file without namespaces. #1603 API/CLI New feature: Find all references via API and CLI. #1572 2023.05.04-19.38.01 # General Bump clj-kondo to 2023.04.15-20230503.152749-8 Editor Fix edn tree to consider symbols. #1556 Fix edn tree to consider vector root nodes. #1557 Fix edn tree to handle invalid edn code and not throw exceptions while typing code. API/CLI Avoid enabling unecessary analysis features for API/CLI lint, improving memory usage. 2023.04.19-12.43.29 # General Fix reflection issue in JDK19 with Thread/sleep #1520 Bump clj-kondo to 2023.04.15-20230418.173453-3 , fixing analysis inconsistencies with schema.core Ignore vars defined wrongly via config. #1510 Add support for :output {:langs true} in clj-kondo config to show .cljc language contexts Editor Fix classpath issue message to properly ignore or retry after user input. #1500 Decreate debounce time for calculating changes and diagnostics, improving UX in cost of performance, it doesn't seem to highly affect performance though. Add new setting to change diagnostics range type. #1530 Spec compliance: avoid registering client capabilities if dynamic registration is not set. #1535 Improve java support: using new java-member-definitions analysis, first feature is the allow completion of static members (fields and methods) for java classes. Show edn tree when in edn files via documentSymbol feature. Improve java db cache consistency + analysis performance. 2023.02.27-13.12.12 # Editor Fix exception on hover feature on graal images. 2023.02.26-23.46.05 # General Add new setting :paths-ignore-regex to allow ignore analyzing/linting specific paths, useful if you have folders or files that are not relevant to be linted and are huge which may affect performance. Bump clj-kondo. Fixes missing lint class constructors, making clojure-lsp show add import code action always. Fix wrong ns rename for cljc files. #1508 Editor Fix cache issue: wrong external dependencies analysis when running clojure-lsp in editor after running on CLI, affecting navigation. #1473 Bump lsp4clj fixing progress notifications during initialization for Calva. Allow go to definition of namespace even when the var is not known. Ex: clojure.string/foo will go to the definition of clojure.string . This is useful for cases where the var was not created yet but user wants to go to the ns to check the available functions or check the correct name of the function. Avoid basing results on old analysis. Add new setting :completion :analysis-type to choose between :fast-but-stale (default) or :slow-but-accurate , this should define whether completion should wait for changes that may still happening, this by default reverts the behavior introduced after #1425. #1487 Fix textDocument/hover issue when doc metadata isn't a string literal. Follow references to other vars in doc metadata for use in textDocument/hover . Support :arglists meta when finding docs of functions via hover feature. #1504 Enhance hover to search clojuredocs on CLJS. #1506 2023.01.26-11.08.16 # General Bump clj-kondo to 2023.01.20 Avoid false-positives of unused-public-var for functions used in :gen-class that starts with - as convention. #1443 New jar available on releases: clojure-lsp-server.jar , an Uberjar not aot-ed containing both clojure-lsp core + server code, improving startup time for JVM clients, for example for lein-clojure-lsp . Any lib using clojure-lsp-standalone.jar should consider switch to this new jar. Change :source-paths-ignore-regex default value to [\"target.*\"] , removing resource folders. #1452 Bump cljfmt to 0.9.2 Bump lsp4clj to 1.7.0 Support :style/indent metadata for indentation with cljfmt #1420 Editor Fix add missing import code action when there are multiple options. #1422 Only show completion items if no changed code is being processed, avoiding wrong completion items. #1425 Improve semantic tokens for defprotocol, definterface coloring as interface tokens. Include reffered vars in completion. #1440 Allow rename alias of function calls, renaming properly both function usages and alias definition. Add support for keyword analysis in edn files, allowing find-references, document highlight and other lsp features to keywords. find-definition and references for quoted symbols like 'clojure.core/inc and symbols mentioned in .edn files. #1446 Show error messages when can't apply edits after commands. #1448 API/CLI Make diagnostics command print as json or edn. #1419 Make possible starting a chan server with clojure-lsp components, useful to other clients extend. Consider edn files when linting project, allowing to format edn files. #1452 Report diagnostics lines and columns as 1 based, not 0 like LSP, following clj-kondo standard. #1459 2022.12.09-15.51.10 # General Fix rename issue with VS-Code/Calva on MS-Windows. #1388 Only publish progress on initialize if client provided a workDoneProgress . #1363 Bump clj-kondo to 2022.12.08 . Avoid wrong clj-kondo configs in case clojure-lsp process is spawned from a different directory than project-root. Fall back on CLJS var when finding definition from Clojure and nothing was found. #1403 Editor Show better icons for multimethods, var-arg fns, protocols, records, interfaces and types on workspace/symbol and textDocument/documentSymbol . Inlining the last binding of a let removes the let. #210 Allow import java classes via code-actions Add import 'x.y.Z' . Make add-import command/code-action smarter, checking if there is already a package import to just include the classname instead of full import. Add new refactoring cycle-keyword-auto-resolve , e.g. ::bar -> :foo/bar and vice-versa. #1128 Supporting find definition/references/implementations of definterface . Avoid watching ignored source-paths, causing find-definition/references and other features go to wrong files. API/CLI Allow specify analysis type for dump command, default to analyze project only analysis. #1383 Add :result to the dump command. #1390 Important regression fix where clojure-lsp may do inconsistent lint when classpath scan fail without showing to user the error. 2022.11.03-00.14.57 # General Bump clj-kondo to 2022.11.02 avoiding breaking changes on custom hooks. Bump graalvm to 22.3.0. #1345 Editor Add refactorings to change param order of defn / defmacro , also changing call sites. #1131 Avoid shadowing existing locals when restructuring keys. #1229 Let editors control whether the server's log includes traces of the messages they are exchanging. https://github.com/clojure-lsp/lsp4clj/issues/27 Bump promesa to 9.0.470 Bump lsp4clj to 1.5.0 For users with fewer cores, avoid unnecessary waits for file analysis. Reduce CPU usage by aborting requests that the client won't use. Fix to mark some code actions as preferred, so editors can emphasize them. https://github.com/clojure-lsp/lsp4clj/issues/32 Adds java classes completions, since clj-kondo now knows all java classes defined on external dependencies. #1329 Fix completion to consider required namespaces without alias or refers. #1352 2022.10.05-16.39.51 # General Improve clj-depend merge config to overwrite source-paths only if it is nil or empty. #1264 Fix stubs generation issue on MS-Windows, coming out of enabling all integrations tests on windows. #1211 Improve MS-Windows support by fixing various path, URI and line ending issues coming out of repairing the unit tests suite on windows. #1211 End dep-graph-queries experiment; clojure-lsp now uses the dep-graph to optimize queries whenever possible Bump clj-kondo to 2022.10.05 . #1226 Fix issue with changes being reporting with spurious and incorrect line endings on MS-Windows text files. #1211 Index internal data by URI instead of filename, to minimize conversion between these formats when running queries. #1207 Add support to enable trace logs on server via --trace flag. (For latest Emacs's lsp-mode this can be enabled easyly via lsp-clojure-trace-enable variable) Bump graalvm version for MS-Windows to 22.2.0, in sync with the other archs. #1211 Editor Fix to avoid error when checking code actions from an #_x uneval node. #1227 Add support to decompile jar as a java project when finding the definition of a java class, allowing to have LSP features on that java project. #1187 Add refactorings similar to Sort map : Sort vector , Sort list , Sort set , and Sort clauses for functions like assoc . #1155 Support java class decompilation for zipfile scheme (vim users). Avoid keeping diagnostics of external closed files for Calva. https://github.com/BetterThanTomorrow/calva/issues/1864 Lint opened files after a clojure-lsp or clj-kondo config file is saved on disk, avoiding users to re-edit files. #1247 Allow find definition of java class usages where definition comes from clojure, like defrecords. Fix: wait for rename to apply before allowing another rename, to ensure suggested name is correct. #1270 Process requests in parallel, to prevent typing lag and other performance problems introduced during migration away from lsp4j. #1240 Fix: Avoid wrong ns require after Create ns and require code-action/command. Fix: Avoid errors when a file starts with a comment. #1252 Bump promesa to 9.0.462 and use it for parallel request processing. API/CLI Fix missing diagnostics when --project-root is different than current directory. #1245 Add new dump feature, returning analysis, project information, dependency-graph and others. Check clojure-lsp.api/dump for more information. #744 Improve CLI output avoiding logs from clj-kondo which are already available via verbose log. 2022.09.01-15.27.31 # General Remove dependency on lsp4j. https://github.com/clojure-lsp/lsp4clj/issues/8 Fix extra space on :import when sorting classes. #1152 Bump Graalvm from 22.0.0.2 to 22.2.0 improving binary performance/size. #1154 Bump clj-kondo to 2022.08.03 . General release of dep-graph-queries, improving query performance. See prior release for feature details. Generate nightly builds for macos aarch64 (M1/M2) every push on master. Bump lsp4clj to 1.2.1 . Bump cljfmt to 0.9.0 . Fix issue with classpath clojure build tools invocation on MS-Windows. #1132 Bump babashka/fs to 0.1.11 . Editor Improve completion sorting, showing locals before functions and other completion items. #1158 Fix hover to show current var definition docs instead of def / defn . #1157 Improve hover for requires to show ns docstring. #1171 Fix destructuring of things that have been destructured before. #1156 Some completions require that a new alias be added to the ns form. Fix this feature for Calva users, and improve performance for all users. #1068 Fix resolve-macro-as code action corner case. #1084 Ensure line numbers provided by document-symbol correspond to the latest version of the file. #1178 Avoid exceptions when clients use URIs that don't exist on disk. Fix documentation on completion items. #1181 Fix rename of defrecords. #1165 Fix to send all diagnostics to client at startup, even in very large projects. #1153 Fix to preserve kebab-casing in server-info-raw. #1195 Add refactoring Restructure keys , the inverse of Destructure keys . #1170 Add refactorings to convert between (:x m) and (get m :x) or (:y (:x m)) and (get-in m [:x :y]) . #1172 Add support to imported java class on completion. #1193 Add new question to skip or retry classpath scan during startup if failed. Improve performance of processing of changed files outside editor calling clj-kondo in batch. #1205 When renaming a keyword that is also a destructured key, rename its local usages too. #1192 2022.07.24-18.25.43 # General Bump cljfmt from 0.8.0 -> 0.8.2 Editor Add clojure.core/fn to resolve-macro-as options. #1094 Restore #995 Improve element selected on textDocument/hover (previously reverted) with a fix that keeps it working for Calva even after a syntax error is introduced. Improve call hierarchy performance by parsing less frequently. #1092 Improve system wide performance by keeping a graph of dependencies between namespaces. #990 #1053 Enable setting :experimental {:dep-graph-queries true} to beta test this feature. Improve performance by adding second level of analysis indexing. Improve performance of things that need keyword definitions, like completion and custom lint. Fix hover showing previous function elements on some cases. #1098 Fix: find definition will find registration of unnamespaced keyword. Fix to update unused-public-var lint on registered keywords as usages change in other files. #1018 Fix to navigate to var defined by declare, when there aren't any later defs. #1107 Fix to always go to the definition of the correct var imported by potemkin. #1020 Fix to correctly rename namespaces. #1121 Fix to correctly :keep require and import indent spacing. #1141 Improve accuracy of progress reporting during uncached startup. #1134 Add refactoring Destructure keys to destructure keywords. #905 Add refactoring Extract to def to create a def from the thing under the cursor. #1136 Include defmethods in document and workspace symbols. #1016 2022.06.29-19.32.13 # Editor Reverted #995 Improve element selected on textDocument/hover , as it caused clojure-lsp to stop working for Calva users after a syntax error was introduced. #1080 2022.06.22-14.09.50 # General clojure-lsp has a flake.nix now, being able to be built using clj-nix. #999 Remove use-source-paths-from-classpath setting, its value was already true and disabling it could cause false-positives. Add compute-external-file-changes setting as true by default, when enabled it will consider file changes outside editor like git branch changes and update analysis, avoiding the need to restart server when a file is changed outside editor, this will only work if client file-watchers is enabled. #1002 Bump lsp4clj to 0.4.1. Remove deprecated disabled setting :linters :clj-kondo :async-custom-lint? . #1017 Fix references and code lens of defrecord/deftype for cljs files. #1055 Fix clean-ns to move reader conditionals to before normal requires. #1057 Add new optional linter: clj-depend integration. #957 Add new setting :source-paths-ignore-regex to filter source-paths that are auto generated for example for cljs projects, the default value should be enought for most cases ( [\"resources.*\" \"target.*\"] ), replacing old ignore-classpath-directories . Bump clj-kondo to 2022.06.22. Editor Add support to rename namespace of namespaced keywords like re-frame events/subs. #978 Improve performance of find-declaration feature. #1021 Fix to avoid suggesting an alias from a clj file to a cljs file. #1024 Find references of namespace usages now find all namespace usages on project, not only the definition. #1022 Improve element selected on textDocument/hover , showing the function being called instead of the closest element found backwards. #995 Fix drag from quoted symbols and other special nodes #969 Drag requests two smaller edits, instead of one large edit, potentially avoiding flicker. #1043 Drag is disabled between clauses, to avoid arbitrarily choosing one to move. #1030 Cursor doesn't move within dragged clause. #1029 Improve performance of drag forward. Avoid invalid cached analysis and document text after a rename. #1049 Improve lint performance by only linting references files when usage is added or removed. #1019 Extracted functions are private. #1039 Fix errors when Emacs lock files are linted. #1054 2022.05.31-17.35.50 # General Bump clj-kondo to 2022.05.31 Consider .clj_kondo files as clj files. 2022.05.23-13.18.11 # General Allow specify how many classes clojure-lsp should check before moving sorted package imported classes to next line. #966 Allow :linters to be configured by LSP clients passing string keys/values. #977 Support clj-kondo :config-in-ns and :ns-groups for clojure-lsp/unused-public-var linter. #981 Improve clean-ns correct positioning of multiple refers. Editor Fix powershell.exe command execution error on Windows Fix drag in are when clojure.test is aliased. #967 Reduce time to calculate semantic tokens, reducing CPU usage in large files. #970 Fix JDK global cache load when jdk source were already analyzed on previous sessions, fixing finding definition of jdk classes not working sometimes. Fix command move-form not working. Fix find definition of macros required by :require-macros on cljs files. #980 Add support to completion keywords found on function definition :keys destructuring, improving completion on api calls. Avoid duplicate parens when inserting snippets during completion. #982 CLI/API Make all cli features open files faster, improving speed of all CLI/API features. Fixes #985 2022.05.03-12.35.40 # General Bump clj-kondo to 2022.04.26-20220429.192438-2 . Decrease uncached startup time by 60-70%, by instructing clj-kondo to skip var definition bodies when analyzing deps. #1674 Improve speed of alias/ns completions. Change alias/ns completions to return a label that matches the input. Support sorting classes inside package imports during clean-ns . #932 Avoid saving duplicate source-paths, not calling clj-kondo to analyze same filenames multiple times, improving startup speed. Improve progress report both on editor and CLI using new clj-kondo callback feature. Editor Support workspace/willRenameFiles , renaming namespaces and all its references when a file is renamed. Don't save cache when classpath lookup failed. Wait for editor to apply edits before requesting cursor re-positioning. Fixes cursor positioning after drag in Calva. drag: Request edit only of changed clauses, not entire parent, reducing flicker. CLI/API Bump lsp4clj to 0.3.0 . This release was supported by Clojurists Together 2022.04.18-00.59.32 # General Improve settings documentation. Fix completion performance regression from previous release. Consider .bb and .cljd files as clj files. #906 Bump to clojure 1.11.0 Improve analysis query performance as a whole for lots of features. #916 Bump clj-kondo to 2022.04.09-20220414.123207-3 fixing semantic tokens for :require , :refer and :as . #1609 Move lsp4clj to outside clojure-lsp to its own repo/jar release. Fix local files outside source-paths not being linted even if opened/changed. Consider filename + lastModified as checksum for external files, avoiding analyzing it if analysis is already present. graalvm: Compile static linux with --musl for better compatibility. #868 java: Use XDG_CACHE_HOME or .cache/clojure-lsp instead of config files for JDK cache. java: Cache JDK analysis globally avoiding high CPU usages after startup. java: Add :java :home-path setting for easier way to specify java location for JDK source analysis. #907 Editor Introduce ALPHA move-form command. #566 Rename \"Move coll entry up/down\" to \"Drag forward/backward\", matching Calva/Paredit terminology drag: clauses move intuitively in clojure.test/are drag: top-level forms can be dragged #891 Improve completion performance for most cases, reducing time to compute clj/cljs core symbols. completion: suggest functions defined in Clojure 1.10 and 1.11 completion: Fix to no require extra ns when alias is already required. #920 promote-fn: new feature Promote a fn to a top-level defn. #783 @mainej promote-fn can also promote a literal #() to a fn demote-fn: Demote a fn to a literal #() breaking remove cycle-fn-literal, since the same refactorings can be performed with the more clearly named promote-fn and demote-fn drag: Fix to drag element-wise in destructured keys, not pair-wise. #927 test-tree: reduce CPU usage, especially during startup CLI Reduce CPU and wall-clock time in cli commands clean-ns and diagnostics This release was supported by Clojurists Together 2022.03.31-20.00.20 # Fix URI resolver on java JDK logic. Fix zipfile scheme when finding external deps. 2022.03.31-14.21.14 # Add java class find-definition support, decompiling .class files when available. #762 Add JDK source discoverability feature, searching for installed JDK for later analyze with clj-kondo and support java classes interop. Add :java :download-jdk-source? setting to download JDK source after startup if not cached before globally or found locally. Disabled by default. Avoid high CPU usage and freezes by more efficiently finding referenced files to notify on file change. #844 @mainej Bump clj-kondo to 2022.03.10-20220331.135739-32 improving java analysis and fixing a critical regression for re-frame. #888 This release was supported by Clojurists Together 2022.03.26-18.47.08 # Fix unused-public-var not considering excluding comments, changing async-custom-lint? setting to false. 2022.03.25-12.02.59 # General Fix cljfmt settings merge during refresh/classpath configs merge to avoid multiple config vectors on same symbol. Fix install script for aarch64. #794 Fix handling cljfmt config files that end in .clj https://github.com/weavejester/cljfmt/issues/190 parser: more efficiently seek to cursor position, improving performance especially in large files. #793 @mainej Fix clean-ns not sorting properly node requires for cljs. #815 Fix move-to-let to ensure locals don't move out of scope. #830 Improve logic around require suggestions. #837 Enhance move-to-let to introduce and expand let if an existing one doesn't exist. #829 Bump org.clojure/clojure to 1.11.0 . Fix move-coll-entry to maintain cursor position instead of a range. #862 Clean ns automatically after adding missing require/imports, enabled by default under new :clean :automatically-after-ns-refactor flag. #558 Editor extract-function: Fix wrong args when extracting from multi-arity fn. #683 extract-function: Fix wrong args when extracting after a local usage. #812 @mainej move-coll-entry: clauses move intuitively in assoc , case , cond , and similar functions. #780 @mainej move-coll-entry: fix NPE when when invoked from top-level #803 @mainej Generate stubs async after startup, improving startup time. #788 Improve and add lots of new snippets following practicalli config. #797 Improve how watched new files are analyzed avoiding infinite loops and performance issues. #796 Avoid infinite loops when several files are changed simultaneously. #796 @mainej Fix \"incoming call hierarchy\" not considering usages inside defmethods. #808 range-formatting: more efficiently locate extent of range and reduce number of calls to cljfmt, improving performance especially when formatting large ranges. #795 @mainej cycle-fn-literal: new feature convert between function-literal syntaxes (fn [] ...) <-> #(...) . #774 Add find-implementation feature to defmulti and defmethod . #751 Make find-implementation of defprotocol names find its implementations and find-implementation on deftype / defrecord methods find other implementations. Add new code action Introduce let for existing command. #825 Make find-implementations consider reify . #827 Fix namespace on file creation when nested source-paths are available. #832 unused-public-var: fix to show warnings on vars defined with declare. #840 unused-public-var: large performance improvements, especially for large projects. #861 @mainej API/CLI Extract lsp4clj as a seperate library. #807 @Cyrik Supported by Scarlet Fix inconsistency with clean-ns/format not copying kondo configs. This release was supported by Clojurists Together 2022.02.23-12.12.12 # General Use :source-aliases setting during default deps.edn and lein project-spec aliases, avoiding the need to configure a whole project-spec just because of a additional alias. Exclude from unused-public-var linter vars with metadata ^:export . #753 Fix clean-ns multiple refers sort when there is a alias before the refers. Bump clj-kondo from 2022.01.15 to 2022.02.09 adding support for implementation analysis and more improvements. Medium performance improvement during startup when unused-public-var linter is disabled. Medium performance improvement during startup on unused-public-var calculation parallelizing calculations. Small performance improvement on code actions calcullation. Add :use-source-paths-from-classpath setting defaulting to true, which makes clojure-lsp do not manually discovery source-paths but get from classpath excluding jar files and paths outside project-root. #752 #551 Improve completion performance when all clojure.core or cljs.core symbols are valid completions. #764, #771 @mainej Fix scenarios where the lint findings in individual files differed from what you'd expect based on the .clj-kondo/config.edn settings. Add :exclude-regex and :exclude-when-definted-by-regex to :clojure-lsp/unused-public-var linter. Bump org.clojure/clojure to 1.11.0-rc1 . Editor Fix exception during code actions calculation when in a invalid code of a map with not even key-pairs. Don't return diagnostics for external files like files on jar dependencies, avoiding noise on lint when opening dependencies. Support finding implementations of defprotocol and references of defrecord/deftype, implementing LSP method textDocument/implementation . #656 Make the actions and commands aware of when they were invoked from comments or whitespace. This will allow individual refactorings to be more deliberate about how they handle comments and whitespace. #716 @mainej Correctly position the cursor after calling move-coll-entry-down on an entry with leading comments. #758 @mainej Don't return completions when invoked from a comment, avoiding performance problems. #756 Fix small anomalies in parameter names of extracted private functions. #759 @mainej Add semantic tokens for protocol implementations methods like defrecord and deftype. Small performance improvevement on code lens calculation using transducers. API/CLI Small performance improvement to format , clean-ns , diagnostics , and rename via parallelizing parts of the logic. Fix edn->json parser of serverInfo/raw for Calva use cljfmt configuration. #763 Add :cljfmt-raw config to serverInfo/raw for Calva. #768 Add support for passing specific --filenames for most actions. #775 This release was supported by Clojurists Together 2022.02.01-20.02.32 # General Fix classpath hash regression introduced by last release 2022.02.01-16.53.14 # General Migrate project from depstar -> tools.build. #711 Improve classpath hash to consider invaliding cache when local root deps was changed. Replace datalevin cache db with transit. #703 Bump Graalvm from 21.3.0 to 22.0.0.2 improving binary performance/size Update XDG_CONFIG_HOME to clojure-lsp directory in doc/settings.md Editor Support going to namespace definition on an alias. #706 Add LSP textDocument/declaration , for now adding the making possible navigate to alias and namespaces declared on the namespace. #680 Fix removal of file analysis on didClose for external files like jars. #717 Fix cursor not moving when using code actions that move the cursor automatically. Fix additional-snippets to work on top-level forms as well. Fix resolve completion item not returning insertText. #719 @Cyrik Remove support for LSP codeAction/resolve . It added complexity and was not used in a way that improved performance of the action menu. #722, #725, #726 Fix create public function refactoring not working when function is not a function call. 2022.01.22-01.31.09 # General Fix freezing in some cases during clojure-lsp startup linting. #708 2022.01.20-14.12.43 # General Bump clj-kondo to 2022.01.15 . Add :classpath to serverInfo command for downstream usages. Fix issues in extract-function that arise when operating over .cljc files. Add setting :copy-kondo-configs? to allow disable auto clj-kondo config copy, enabled by default. #694 Lint unused public keywords, like unused re-frame events/subs. #691 Fix rename of namespaced keywords -> aliased keywords. #665 Huge refactor on clojure-lsp codebase, spliting code into submodules, this made possible remove a lot of deps from API jar and help separate clojure-lsp features in the future. #658 Send testTree notification for all project test files after clojure-lsp start. #697 Editor Improve 'create function' refactor code action handling multiple cases. #682 Fix 'resolve macro as ...' code action not working. Fix showDocumentRequest issues when triggered via some refactor code action. Add new code actions + commands Move coll entry down and Move coll entry up to move entries within collections. #684, #701 API/CLI Make format , clean-ns and rename features not need to scan whole classpath, analyzing only project code improving performance a lot. 2022.01.03-19.46.10 # Catch clj-kondo prints to stdout and log to clojure-lsp log file avoiding crashes on some clients like vscode/Calva. 2022.01.03-15.41.19 # General Fix some analysis conflicts regarding custom-async-lint? feature introduced on latest release causing outdated analysis and some deadlocks. Editor Fix inline symbol code action regression from previous releases. #678 Fix expand let refactor duplicating variables in some cases. #676 Add completion support to potemkin usages of a namespace. API/CLI Wait for db cache upsert before end proccess, avoiding the need to re-lint whole classpath on next api/cli runs. Fix the need to use :raw? true on babashka pod usage. 2021.12.20-00.36.56 # General Bump clj-kondo to 2021.12.19 , supporting auto-load configs, improving potemkin support, adding more linters and more. Merge :cljfmt settings with :cljfmt-config-path if file path exists. Avoid high CPU and lockup when clj-kondo throws exceptions. #671 Allow absolute paths in deps.edn :local/root #672 Fix clojure-lsp not loading for some mono-repo cases, improving local/root support for polylith projects. #673 Avoid infinite loop because of cyclic dependencies on deps source-path discovery. Add babashka pod. #555 Editor Change call hierarchy to return selection range of usage, not function definition. Return edits in codeAction/resolve responses rather than commands . #655 Improve :linters :clj-kondo :async-custom-lint? to avoid infinite loops and default to true . Add new custom LSP feature Test Tree , which shows all test hierarchy of a file. #653 Improve function name finding to consider other function definition types for some features. #666 Make textDocument/hover return the correct range from LSP spec, the element range instead of the element scope range. API/CLI Exit process if any error during classpath lookup. Opt-out via :api :exit-on-errors? flag. 2021.12.01-12.28.16 # General Add support for LSP method textDocument/prepareRename which it's the proper way to check if the rename will work correctly. #642 Expose new custom method clojure/cursorInfo/raw for custom hack on current cursor information code. #645 Support stub generation using clj-easy/stub , adding analysis and linting support for closed sources codes like Datomic. Check :stubs settings for more details. #637 Handle config deep merge differently for collections, concating instead of overwriting. Fix unnecessary exception thrown on graal images during startup. Support deps.edn :local/root source-paths discovery, improving support for monorepo projects like polylith . #652 New setting value for :clean :sort :require : :lexicographic . #654 Bump clj-kondo to 2021.10.20-20211126.151305-16 . Editor Support completion on aliased keywords. #649 Add new Sort map keys refactoring code action. #651 Add new Create function code action, allowing to create a function on a existing namespace or creating a new namespace + the function. #646 Improve Extract function refactoring to consider comments above current function. Experimental: new :linters :clj-kondo :async-custom-lint? setting, when true, scan unused-public-vars async improving lint/analysis UI feedback for huge buffers (> ~1000 lines). Default false . This release was supported by Clojurists Together 2021.11.16-16.52.14 # General Improve rename feature to not heavily rely on valid source-paths for most cases. Fix setTrace exception logs for graalvm native images. Huge improvements on namespaces renames and namespaces references find. #573 Fix/Remove warnings during datalevin access. Improve freezing for some MacOS cases. #631 Bump clj-kondo to 2021.10.20-20211116.110002-7 improving code parsing and other fixes. Editor Fix \"Add require\" code actions adding multiple requires instead of the selected. Improve \"Add require\" wording, making it easier to understand what each different action will do. Smart check all available refers to require, adding refer options to Add require code actions. #627 Big improvements on keyword completions. #630 Add setting keep-parens-when-threading? to keep parens for single arity functions when threading. #636 Avoid adding duplicate requires when adding a new require via code action. #640 Improve common known snippets to replace completion items, improving completion UX. #638 This release was supported by Clojurists Together 2021.11.02-15.24.47 # General Bump Graalvm from 21.2.0 to 21.3.0 improving binary performance/size Fix wrong parse of code when code contains namespaced maps like #:foo{:bar 1} . This issue was affecting a lot of features for example code actions. Bump datalevin from 0.5.26 to 0.5.27. Improve semantic tokens for dynamic vars, function definitions, namespaced and aliased keywords. Fix bug where :source-paths settings could be hot-reloaded with wrong-value. Editor Deprecates setting :show-docs-arity-on-same-line? in favor of :hover :arity-on-same-line? . Add support to new LSP LinkedEditingRange feature. #341 Improve suggested Add require ... code actions, this should make clojure-lsp smarter when user wants to add a missing require. #614 Change :notify-references-on-file-change default from false to true , we had some performance improvements and I've been testing this for some time now and didn't see any new issues with that. This should improve a lot the UX when user change any code that is references on other files, updating the diagnostics for those files as well. Improve rename feature UX to output errors when it's not possible rename. Add support for window/showDocument LSP method, used on create-test command/code action after creating the test to show the test file. Add new Unwind thread once and Unwind whole thread code actions to undo a thread call. Improve code actions performance requesting async all actions. Add new LSP custom method clojure/clojuredocs/raw which takes a symbol and a namespace (both strings) and returns any Clojuredocs entry found, otherwise null . Fix missing keywords rename/references for destructured keywords. CLI Show error/warning message when a classpath scan fail during analysis. Fixes #626 Add coloring to diagnostics output matching diagnostic severity. This release was supported by Clojurists Together 2021.10.20-16.49.47 # Editor Hot fix clojuredocs on graalvm native image. Bump clj-kondo to 2021.10.20-20211020.123254-3 to fix a specific issue with cljs. Implement support to return to client LSP Errors, making user UX better since clojure-lsp can return specific errors for specific exceptions. 2021.10.20-13.04.11 # General Improve intialization feedback report messages. Consider dev and test alias for deps.edn projects as project-specs during classpath lookup. #586 Avoid scanning source-paths twice, as it was being considered as part of external classpath as well. Change cache db from sqlite to datalevin for faster startup + better graalvm compatibility. Make the cache analysis save async to make startup faster. Support Auto refresh settings memoizing with a ttl of 1 second avoiding the need of restarting server when changing configs. #502 Bump clj-kondo adding new gen-class linter and other fixes/improvements. Fixes #589 Remove unused duplicate require if any. #527 Fix crash on clean-ns when ns contains comments. Improve project analysis filter to check source-paths. #597 Editor Add reference code lens for ns forms. #578 Fix expand-let bug that occurs when a list form precedes let. #590 Add new command to create test for function at point. #582 Add new code action to create test for current function/var Add private to documentSymbol to make clear that a var or function is private . Add new code action Suppress xxx diagnostic , adding clj-kondo comment code to ignore the diagnostic. #591 Add more semantic tokens: aliases for macros, variable and function definitions. Add clojuredocs information during symbol hover. #571 This release was supported by Clojurists Together 2021.09.30-15.28.01 # Editor Hot fix hover content wrong type hinting. 2021.09.30-12.28.16 # General Use lower-case for refer/import/require sorting. #560 #561 Avoid removing comments when sorting/cleaning namespace. #559 Break lines when sorting refers along with then new :clean :sort :refer :max-line-length setting with a default of 80 . #562 Deprecate lens-segregate-test-references in favor to :code-lens :segregate-test-references Check for a default .cljfmt.edn config file for cljfmt config settings if no :cljfmt-config-path was provided. #563 Bump clj-kondo to 2021.09.25 fixing false-positives with potemkin import-var analysis. Re-scan whole project if any clj-kondo config changed for better consistence. #331 Fix clojure-lsp not initializing when empty project.clj . #579 Support finding config in classpath via new setting :classpath-config-paths [\"my-org/my-lib\"] . #580 Editor Fix resolve macro as code action after regression introduced recently. Fix unused-public-var not being suppressed during project startup. #554 Improve hover feature to return elements when inside a function call. #569 Fix create-private-function command and code action to consider when new function is inside thread macros. Support $/progress LSP feature, sending notifications for client when server is starting, improving the feedback for the user. Improve semantic tokens support for java classes and methods. API/CLI Support renaming namespaces as well with rename feature. Use relative paths instead of absolute paths on diff messages. Add analyze-project! to analyze whole project only and cache analysis, useful for REPL usage for example. Follow same exit status from clj-kondo for diagnostics feature. #572 Improve start project feedback reporting the percentage and specific message. This release was supported by Clojurists Together 2021.09.13-22.25.35 # Editor Rollback change on didChangeWatchedFiles for :change events, avoiding outdated changes overwriting newer changes. 2021.09.13-19.32.00 # General Create .clj-kondo folder if not exists in project root. #528 Fix exception when :clojure-lsp/unused-public-var linter is :off . #546 Bump clj-kondo to 2021.08.07-20210903.210340-28 to fix a false-positive with potemkin. https://github.com/clj-kondo/clj-kondo/issues/1370. Bump clj-kondo to 2021.08.07-20210909.131804-29 fixing issues with built-in clj-kondo cache not present on graalvm binaries. #548 Exclude cljs.test/deftest from unused public vars linter. Migrate default db file from .lsp/sqlite.db to .lsp/.cache/sqlite.db , this is necessary as in the future we will replace sqlite with other db implementation, for users they just need to consider/gitignore the .lsp/.cache folder, this way any next change on db implementations or any other cache will not affect user. Auto migrate existing .lsp/sqlite.db to new .lsp/.cache/sqlite.db to avoid unnecessary project re-scan. Deprecates :sqlite-db-path in place of :cache-path . Editor Fix didChangeWatchedFiles to correctly create the file on server, properly change file content and re-scan with clj-kondo, or remove file analysis. This should improve LSP analysis reliability when changing files outside the editor. #536 Improve completion only showing valid local vars for current cursor. Improve completion sorting adding priority to each item, showing most used symbols like variables and functions first before other completion items. API/CLI New diagnostics command, which return all diagnostics found by clojure-lsp (using clj-kondo). Check the API section for more details. This release was supported by Clojurists Together 2021.09.04-17.11.44 # Hotfix java classes not present on jar, required for clojure-lsp downstreams. 2021.09.03-00.42.46 # General Improve logging during startup for better troubleshooting. Refactor allowing calls to clojure-lsp.main/run! for manually passing args, useful for lein-clojure-lsp for example. Internal: Move graalvm configuration to sqlite-jdbc. Recognize deftest as function definition form for refactoring features like extract-function . Bump Graalvm from 21.1.0 to 21.2.0 API/CLI Use clj-kondo custom lint for API as well, required for correct diagnostics API feature. Editor Fix regression, custom source-paths from initializationOptions were not being parsed correctly. #537 Documentation New domain for documentation and webpage https://clojure-lsp.io 2021.08.24-14.41.56 # General Fix classpath scan when classpath has other things like new lines or warning message besides the classpath. Fixes #523 Improve clean-ns to remove empty reader conditionals( #?(:clj) or #?@(:clj []) on ns form) after cleaning requires/imports. Fix clean-ns false-positives removals to cljc files when the alias/refer/import is being used inside a reader conditional. Add new setting :linters :clj-kondo :ns-exclude-regex which allows exclude diagnostics/findings for namespaces matching that regex. Fix merge of configs resolved for projects with multiple configurations in parent folders and subprojects. Docs Improved the settings docs with a new link to a file with all available clojure-lsp settings. 2021.08.16-19.02.30 # Fix clojure-lsp --version 2021.08.16-14.47.54 # General Fix wrong parse of source-paths for bb.edn when :paths contains symbols not only strings. #507 Bump clj-kondo to fix a issue with clojure-lsp running in a lein process. Editor Fix find-definition in jars for cljc files where the var is available on both cljs and clj files. #509 Add clojure.core.async common vars to common-refers to be required via code action. Remove diagnostics when files are deleted, properly cleaning server. #513 Don't add ns form to blank edn files. #515 Fix initializationOptions parsing for some clients. #516 Fix refactor 'add missing refer' when there is already that namespace with a alias but no refers. Improve :notify-references-on-file-change performance and use-cases, still disabled by default for some time. API Rollback printing only via CLI to work with API as well. (can be disabled via :raw? option) Support for release of lein-clojure-lsp 2021.08.05-19.36.09 # Bump clj-kondo to fix window path issues with analysis. Fix issue with references code lens for vim. 2021.08.05-18.25.54 # Fix async project lint after startup for huge projects. #506 Fix :lint-project-files-after-startup? to be considered before clojure-lsp lint unusued public vars. Fix excluded symbols for code lens, making clojure-lsp check clj-kondo config as well for the :clojure-lsp/unused-public-var excludes 2021.08.03-13.33.03 # General Parse correctly unescaped URIs sent from clients like vim avoiding errors on some features. Bump clj-kondo fixing analysis position issue with declare , making rename and other features work. Don't use PowerShell profiles on Windows when analyzing classpath. Fixes https://github.com/BetterThanTomorrow/calva/issues/1050 Support babashka classpath and source-paths discovery via bb.edn file. (needs babashka >= 0.5.1) Editor Add :hover :hide-file-location? settings option to disable displaying the source path on hover. Use new clj-kondo :custom-lint-fn for the :unused-public-var , this should improve performance and give the ability to suppress unused vars via code with #_{:clj-kondo/ignore [:clojure-lsp/unused-public-var]} or #_:clj-kondo/ignore 2021.07.28-14.24.06 # General Minor fix on the analysis queries comparison. Improve GraalVM configuration to use direct/less configurations. Bump clj-kondo 2021.06.18 -> 2021.07.28 which adds support for macroexpanding. Editor Fix outgoing/incoming call hierarchy when vars are outside project/external jars. Fix completion of aliases without var names typed yet, for example: string/ API/CLI Fix filename in diffs with dry option. Add coloring to diffs following git diff. Add ns-exclude-regex for commands that check whole project, allowing to exclude certain namespaces via regex. 2021.07.19-14.46.52 # General clean-ns now sorts ns children forms according to the ClojureStyleGuide, at the moment moving require form before import form, enabled by default under flag :clean :sort :ns setting. Improve startup error handler and logging during project analysis. Related to #484 Performance improvements using transducers on analysis queries. Fixed auto-resolve source-paths for lein projects that get source-paths dynamically, clojure-lsp will use the default source-paths for these cases Editor Improve hover output, both markdown and plain text forms. Allow calling thread-first/last and thread-first-all/last-all from within the list. Improve resolve-macro-as messages and default excluded symbols. API/CLI Fix empty XDG_CONFIG_HOME not defaulting to $HOME/.config #474 Improve verbose logging setting. 2021.07.12-12.30.59 # Editor Make semantic-tokens return no token for unknown symbols which has :clj-kondo/unknown-namespace on its analysis. Fix file uri location when hovering a symbol. Add reference code lens to keyword definitions, e.g. re-frame.core/reg-sub . Add semantic-tokens debug information to cursor-info response. API/CLI Fix when ns form does not match filename. #466 Fix errors with project-root on graalvm binary Improve API usage avoiding exceptions and returning just data instead. Improve analysis cache to multiple API calls. Add new --raw option allowing to display only raw data. Useful to integrate with other tools like reviewdog. 2021.07.05-20.31.12 # API/CLI Add --verbose option for debugging purposes. Fix usage as library parsing :exec-args correctly 2021.07.05-15.12.14 # General Add :clean :sort settings option to disable sorting during clean-ns . Add :keep value to :ns-indent-blocks-indentation setting to don't change indentation during clean-ns . Deprecate install-latest-clojure-lsp.sh in place of install new script. Improve source paths discoverability for leiningen projects following the same rules as deps.edn projects. For more information, check the settings section . API/CLI Add --dry option to commands, useful to print only diffs instead of making changes. Check the new setup-clojure-lsp Github Action to run clojure-lsp on CI. Add format feature using cljfmt. Now, every release is available in clojars as com.github.clojure-lsp/clojure-lsp . 2021.07.01-19.49.02 # Fix --project-path option for API. Add --log-path option to API. 2021.07.01-13.46.18 # Fix find-references and references lens for defrecord . Improve clean-ns refactoring following the Clojure style guide. Fix clean-ns corner case issue where it would replace the :as value with the :refer value. Deprecate :keep-require-at-start? in favor of :clean :ns-inner-blocks-indentation with default value of :next-line . Bump org.xerial/sqlite-jdbc from 3.34.0 to 3.36.0. Avoid adding duplicated namespace for new blank files. Add API / CLI support, form more information check the API section. 2021.06.24-14.24.11 # Fix missing LSP 3.16 graalvm reflection configs. #452 2021.06.24-01.20.01 # Fix graalvm reflect config for LSP 3.16 protocol. #449 Use last definition when showing signature help. #446 Create 2 new LSP custom methods: clojure/serverInfo/raw and clojure/serverInfo/log deprecating old commands server-info and cursor-info , check the documentation for more information. Add :final-settings to serverInfo methods. #450 2021.06.21-14.30.54 # Avoid removing whole require if unused refer but with used alias during clean-ns. #447 Bump cljfmt 0.7.0 -> 0.8.0. Fixes #266 Bump clj-kondo 2021.06.01 -> 2021.06.18 2021.06.14-17.00.47 # Improve source paths discoverability for deps.edn projects. Adds :source-aliases for customization. For more information, check the settings section . 2021.06.01-16.19.44 # Fix graalvm issue on completionItem InsertTextMode Bump clj-kondo and rewrite-clj to latest releases. 2021.05.27-17.42.34 # Fix corner case error with project paths with spaces or other special characters. #437 Drastically improve didOpen performance, improving kondo findings parsing and making linting async avoiding blocking some editors. #435 Fix :auto-add-ns-to-new-files? flag always being considered as true . #436 2021.05.22-16.50.45 # Fix completion item kind of clojure core items. Fixes #426 Fix graalvm reflect config for SublimeText - #430 Improve code lens for segregated code lens when on test files. 2021.05.14-15.26.02 # Include non full qualified vars on unused-public-var exclude filter. Improve hover documentation: use correct markdown for docstrings; remove unnecessary new lines; add link to filename location. Rollback full text changes on last release and change approach for a temporary fix. #424 2021.05.06-19.44.00 # Quick fix full text changes to handle it sync for semantic tokens Segregate main references from test references with option to disable via lens-segregate-test-references 2021.04.27-20.17.45 # Significantly improve the performance of workspace symbol filtering/searching. See relevant commit . Always sort refers when clean-ns. Add support for installing with homebrew on Linux. Bump clj-kondo to 2021.04.24-20210426.144134-2 adding support for finding re-frame by keyword. Fixes #411 Fix find definition going to declare - Fixes #340 Remove common already known clojure macros from Resolve macro as code action. 2021.04.23-15.49.47 # Improve resolve-macro-as command to check and log if couldn't resolve the macro. Improve workspace symbol filtering/searching. Now, the sole candidates shown are guaranteed to include all the characters contained in the filter/search string. Add more tokens to semantic tokens: keywords, functions/var usages, java classes, local variables. Bump Graalvm from 21.0.0 to 21.1.0 Bump clj-kondo to 2021.04.23 fixing some keywords corner cases. 2021.04.13-12.47.33 # Add common snippets on completion. Check all available snippets here . Add support for custom snippets via :additional-snippets . Check here for more information. - Fixes #403 Bump lsp4j from 0.11.0 -> 0.12.0 2021.04.07-16.34.10 # Fix renaming keywords in cljc files producing duplicate edits. After project startup, publish all project only diagnostics. This is a approach done by other LSPs to make work features like Project errors . Feature flag via lint-project-files-after-startup? with default true . Add experimental support for aarch64 linux native binary Fix formatting issues with a regression introduced on a previous release. - Fixes #339 and #396 2021.04.03-18.43.55 # Fix textDocument/workspaceSymbols filter not working on native binaries. Report duplicate linters as default, can be disabled via :linters :clj-kondo :report-duplicates - Fixes #390 Bump rewrite-clj to 1.0.605-alpha to fix exceptions when on clojure files with babashka interpreter on first line. Bump clj-kondo 2021.04.01-20210402.215253-6 to fix bug https://github.com/clj-kondo/clj-kondo/issues/1246 2021.03.30-20.42.34 # Bump clj-londo 2021.03.22-20210327.192113-4 - Fixes #385 Add support for outgoing call hierarchy - Fixes #384 Improve and fix missing completion item kinds. 2021.03.26-23.41.07 # Bump clj-kondo 2021.03.22-20210324.110254-3 - Fixes #382 [graalvm] Fixes Unable to invoke no-args constructor for class org.eclipse.lsp4j.ShowDocumentCapabilities error. Fix/enhance keyword rename - #383 2021.03.24-00.41.55 # Migrate from lein to deps.edn Bump clj-kondo to 2021.03.22 Fix clean-ns sorting according to symbols not brackets - Fixes #380 Fix missing graalvm reflect config for CompletionItemTextEdit - Fixes #381 2021.03.21-23.29.19 # Add code action 'resolve macro as', it requires client to fill the chosen macro and clj-kondo config file. Bump rewrite-clj to 1.0.594-alpha Bump data.json to 2.0.1 Bump lsp4j to 0.11.0 2021.03.18-19.23.41 # Add support for diagnostic tags: deprecated and unnecessary. Fix wrong textDocument/documentHighlight for function local-usages. Use new clj-kondo copy-configs flag to copy hooks during lint. Bunp clj-kondo to fix unused public linter check for :exclude-when-defined-by 2021.03.16-20.28.06 # Fix server not analyzing after a wrong code on cljs files - #367 Rollback incremental didChange adding a new :text-document-sync-kind setting with :full as default. 2021.03.14-23.22.46 # Fix completion inside refers, re-add support for it - Fixes #364 Change range of expression functions clj-kondo diagnostics to avoid collision with function signature. 2021.03.06-17.05.35 # Fix incremental didChange, debouncing distincting by uri, fixing some inconsistent file changes when multiple files are changed at same time (rename, iedit, etc). Make unused-public-var ignore -main public functions. Add :exclude-when-defined-by option to unused-public-var linter, check settings documentation for more information. 2021.03.05-13.35.47 # Fix clojure-lsp lint crash when analyzing specific macros with clj-kondo hooks. Fix didChange for Nvim client. Add new clojure-lsp linter: unused-public-var - Fixes #359 Add option to disable clj-kondo linter, check settings documentation for more details. 2021.03.01-19.18.54 # Bump clj-kondo fixing issues on require form not being analyzed. Fix textDocument/workspaceSymbols to use the query sent by client. 2021.02.27-23.35.55 # Add support to complete full qualified namespaces - Fixes #337 Add :log-path setting to log to a custom file. Avoid exception on code actions when on cljc reader macros - Related to #346 2021.02.26-13.58.48 # Improve clojure-lsp config search checking always home dir considering XDG_CONFIG_HOME and project root up to system root (/) - Fixes #339. Handle incremental text changes on textDocument/didChange notifications following LSP protocol, improving performance for huge files. Add clj-kondo version to --version and server-info. Add new create private function code action. 2021.02.24-14.23.08 # Improve completion performance resolving the item only when documentation is requested Add new thread first/last all code actions 2021.02.21-21.02.51 # Implement support for textDocument/signatureHelp - Fixes #324 Disable notify-references on didChange with a flag notify-references-on-change . Fix completion not working when reader macro on file - Fixes #332 2021.02.19-23.08.40 # Fix duplicated symbols for cljc files on textDocument/documentSymbols - Fixes #328 Add namespace require when completing a unimported namespace - Fixes #309 Fix completion not working for cljc files 2021.02.19-00.19.27 # Fix completion of invalid clojure core (e.g. foo/ ) - Fixes #270 2021.02.17-17.00.45 # Allow find all references across the project of simple keywords Allow specify custom sqlite.db location with sqlite-db-path , default to <project>/.lsp/sqlite.db 2021.02.14-19.46.47 # Removing false positive logs from invalid analysis from clj-kondo macro expand analysis Fix call hierarchy when the reference was not open yet in the editor. Smart re-analyze variable/function references when arguments of the definition were updated. Rollback Macos native image compress until it works for MacOS Big Sur - #322 2021.02.13-18.04.19 # Bump clj-kondo to fix false-positive unresolved-vars Prioritize project analysis on all analysis during find definition - Fixes #318 Compress native binaries with UPX decreasing binary size. 2021.02.12-03.13.12 # Fix completion issues with graalvm native linux binaries when completing local variables. Fix completion exception when completing numbers - Fixes #310 Completion inside a require suggests all available namespaces Change log pattern to /tmp/clojure-lsp.<TIMESTAMP>.out use default temp file. Should fix issues with permissions on tmp folder. 2021.02.11-12.43.06 # Fix auto add ns not working for projects. New code action: Move to let New code action: Change coll to map, list, set or vector 2021.02.10-03.01.19 # Fix config passed to clj-kondo during analysis - Fixes #308 2021.02.09-18.28.06 # Fix auto add ns to check project root and source paths Add alias on copmletion items - Fix completion items for Calva client 2021.02.07-22.51.26 # Fix install-latest-clojure-lsp.sh script - #304 Fix clojure-lsp re-analysing classpath when project contains a keyword starting with a number - #305 Allow clj-kondo to pick up config correctly in mono repos - #303 2021.02.07-03.04.31 # Make release's native binaries executable by default - #299 Improve completion removing the necessity to call completion/resolveItem - #292 New code action: Add suggested alias to namespaces - #302 2021.02.05-03.05.34 # Add support for keyword analysis (definition, references, completion, rename, hover) Reduce jar and binaries size excluding some dependencies (Need to fix a lein issue yet) 2021.02.04-02.08.58 # Fix --version on graalvm native compiled binaries 2021.02.04-01.09.21 # Add integration tests to release process 2021.02.02-14.02.23 # Fix clojure-lsp embedded jar binary during release CI Fix duplicate references on cljc files 2021.02.02-03.06.46 # Add clojure.java.io to known requires - #291 Add manual System/gc after first classpath scan, it should decrease memory after the first startup Add support for Windows GraalVM compiled native binary 2021.02.01-20.37.52 # Add native binaries for Linux and MacOS compiled with GraalVM #267 (Experimental) 2021.01.28-03.03.16 # Fix clj-kondo batch analysis when merging batchs - Fix #284 2021.01.27-21.47.42 # Fix missing printlng and avoid errors for next time (this was causing issues in clients like vim coc) 2021.01.26-22.35.27 # Fix document-symbol after #261 - Fixes #276 Reduce memory usage on startup batch analyzing classpath via clj-kondo. - Fixes #268 2021.01.25-22.56.05 # Do not remove document on textDocument/didClose , related to #264. Fix default project-specs for shadow-cljs to use npx prefix. Fix range of textDocument/hover for definition usages. Fix completionItem/resolve broken after #261. 2021.01.25-17.22.05 # Remove references code-lens from deftest forms Fix completion for alias ns from external deps - Fixes #269 2021.01.22-13.04.28 # Huge refactor https://github.com/clojure-lsp/clojure-lsp/pull/261 which uses clj-kondo analysis / findings output to almost all clojure-lsp features. Should significantly increase performance and startup time Should fix almost all bugs/issues with windows Users since we now rely on clj-kondo analysis Remove all lint configs from clojure-lsp including macro-defs , they should be configured on clj-kondo side now via .clj-kondo/config.edn Move file path on documentation to bottom 2021.01.20-01.39.32 # Fixes args for extract-function refactoring - Fixes #263 2021.01.16-03.28.20 # Check for defintions when finding references with includeDeclaration as true - Fixes #260 Add custom command cursor-info to debugging clojure-lsp. Fix unnecessary new-lines on imports when executing clean-ns 2021.01.14-23.15.54 # Check for the whole line to add-miising-* code actions instead of expect the cursor at the ns to be required/imported - Fixes #258 Return all possible add-missing-* code actions to the same line. 2021.01.14-17.19.10 # Fix add missing import code actions after refactor 2021.01.14-12.44.42 # Fixes #208 2021.01.14-02.30.28 # LSP 3.16: Add support for codeAction/resolve improving performance if client supports it Bump extend lib [CI] Remove auto release, next releases should contain more than one PR/fix","title":"Changelog"},{"location":"CHANGELOG/#changelog","text":"","title":"Changelog"},{"location":"CHANGELOG/#unreleased","text":"General Fix move-form double edit problem in cljc files. Fix disabling :clojure-lsp/unused-public-var linter also disabling :clojure-lsp/different-aliases Bump clj-kondo to 2024.09.28-20240930.094425-2 Add support for ignoring tests references for the clojure-lsp/unused-public-var linter. #1878","title":"Unreleased"},{"location":"CHANGELOG/#20240805-181600","text":"General Fix CI for macos amd64. #1859 Replace CirrusCI with Github for macos-aarch64 binary standardizing deploy process.","title":"2024.08.05-18.16.00"},{"location":"CHANGELOG/#20240803-152827","text":"General Bump clj-kondo to 2024.08.01 fixing high memory usage issue. Bump Clojure to 1.11.3 Fix use of :filename-pattern from kondo breaking references. Add api.dump to the pod namespace so it can be used with babashka. Editor Add clojure.test/deftest option to resolve macro as code action. #1850 Allow starting clojure-lsp without a project root but with limited features. #1815 Add code action \"Add require\" for namespaced keywords. #1793","title":"2024.08.03-15.28.27"},{"location":"CHANGELOG/#20240422-115026","text":"General Bump clj-depend to 0.11.0 . Fix renaming ns when one source path is a prefix of another (e.g. src/clj and src/cljs ) #1805 Editor Use scope location instead of name location for folding feature. Fix paredit commands to consider previous element when cursor inside a closing bracket. Fix paredit commands to move cursor after applying command. Fix corner case on paredit comamnds duplicating forms. References of a var-definition now consider full quoted qualified symbols. #1804","title":"2024.04.22-11.50.26"},{"location":"CHANGELOG/#20240331-191013","text":"Editor Adding require command fails for requires without alias. #1791 Add require command without alias now add requires with brackets. Project tree feature now support keyword definitions like re-frame sub/reg. #1789 Support textDocument/foldingRange LSP feature. #1602 Improve textDocument/documentSymbol considering keyword definitions and returning flatten elements. Fix Add require/import usages count in code actions. #1794.","title":"2024.03.31-19.10.13"},{"location":"CHANGELOG/#20240313-131100","text":"General Bump clj-kondo to 2024.03.13 fixing high memory usage issue. Editor Fix workspace/didChangeConfiguration exception causing noise on logs. #1784","title":"2024.03.13-13.11.00"},{"location":"CHANGELOG/#20240301-113751","text":"General Bump clj-kondo to 2024.02.13-20240228.191822-15 . Add :clojure-lsp/different-aliases linter. #1770 Fix unused-public-var false positives for definterface methods. #1762 Fix rename of records when usage is using an alias. #1756 Editor Fix documentation resolve not working for clients without hover markdown support. Added setting to allow requires and imports to be added within the current comment form during code action and completion: :add-missing :add-to-rcf #1316 Fix suppress-diagnostics not working on top-level forms when preceded by comment. #1678 Fix add missing import feature on some corner cases for java imports. #1754 Fix semantic tokens and other analysis not being applied for project files at root. #1759 Add support for adding missing requires and completion results referring to JS libraries which already have an alias in the project #1587","title":"2024.03.01-11.37.51"},{"location":"CHANGELOG/#20240201-110159","text":"General Fix binary not wokring on some aarch64 linux. #1748 Add new Project tree feature via the clojure/workspace/projectTree/nodes custom method. #1752 Fix --log-path setting to work with listen /empty arg, starting clojure-lsp server and logging properly. Editor Fix didChangeConfiguration throwing exception. #1749 Fix rename of ns causing wrong ns names because of duplicate rename actions. #1751 Fix range-formatting throwing exceptions when unbalanced parens are sent from client. #1758 Fix rename functions need to clean up LSP state or restart in some clients implementing LSP method didRenameFiles . #1755 Fix thread last all failed after comment form #_(...) . #1745","title":"2024.02.01-11.01.59"},{"location":"CHANGELOG/#20231229-120927","text":"General Fix deep-merge of client settings with project settings. Fix max-line-length on clean-ns feature not respecting some lines when contains a lot of refers. #1729 Bump cljfmt to 0.12.0. Bump clj-kondo to 2023.12.15 . Editor Fix edn tree visualization for keys with same name in the same level. #1558 Make clear when hover feature is in a calling and not in a specific symbol. #1281 Exclude keys that are already included in the function call from completion suggestions. #1720 API/CLI Drastically improves performance of format task matching cljfmt , avoiding analyzing the project. #1723","title":"2023.12.29-12.09.27"},{"location":"CHANGELOG/#20231030-162541","text":"General Bump clj-kondo to 2023.10.21-20231022.204832-4 . Fix move-to-let/expand-let bug for multi-arity functions #1283 Fix :dependency-scheme setting for .java files from jars #1653 Bump graalvm to 21. Improve overall performance using GraalVM 21 PGO (Profile-Guided Optimizations). Extract the responsibility for merging clj-depend config #1265 Support passing configurations to clj-depend via CLI #1694 Bump clj-depend to 0.9.2 Performance: remove keyword-usages elements from external analysis as they are not used for any feature and for big projects may affect memory. #1700 Editor New paredit refactorings: forward-slurp forward-barf backward-slurp backward-barf raise kill Improve rename to avoid internal errors and show proper error messages. #1691 Exclude unused-public-vars when inside a comment block. Add :analysis-summary field to serverInfo command to get information about project for performance analysis. Add :analysis settings, with options to disable specific analysis for better performance on huge projects. #1700","title":"2023.10.30-16.25.41"},{"location":"CHANGELOG/#20230806-002806","text":"General Fix truncation of namespaced keywords #1640 Add rewrite-clj node to cursor-info. Fixing semantic-tokens, collons not managed by lsp anymore. #1550 Fix :paths-ignore-regex setting to consider settings reload. Bump clj-kondo to 2023.07.14-20230717.090255-3 . #1624 Fix inconsistencies with :defined-by->lint-as . Improve memory usage during cache save, avoiding \"Out of memory\" exceptions. Prevent file rename when a namespace is defined in multiple files #1574 Fix user formatting setting being override by :style/indent metadata in macros. Bump cljfmt to 0.11.2 . #1634 Bump lsp4clj to 1.8.1 . Added functionality to workspace/didChangeConfiguration so it changes configuration on runtime. Editor Avoid returning all known keywords on empty keywords completion for performance reasons. API/CLI Improve mem/cpu usage using less analysis for tasks.","title":"2023.08.06-00.28.06"},{"location":"CHANGELOG/#20230701-223541","text":"General Update flake.nix to build with babashka. #1373 Bump clj-kondo to 2023.06.02-20230630.144012-16 . Improve support for ClojureDart .cljd files. #1589 Slightly reduce OutOfMemory exceptions that may happen with the JVM version. Support ignore unused-public-vars via :linters :clojure-lsp/unused-public-var :exclude-when-contains-meta clj-kondo setting. Fix restructure-keys when map has an :or . #1583 Bump lsp4clj to 1.8.0 . Add post startup tasks progress feedbacks, like \"Generating stubs\", \"Analyzing JDK source\" and \"Fetching Clojars\". Bump cljfmt to 0.10.6 . #1605 Editor New code actions: Replace ':refer :all' with ':refer [my-refer]' and Replace ':refer :all' with alias . #1575 Enhance java support for hover and completion of static class members. Improve :paths-ignore-regex to ignore features avoiding impact in huge files that are intented to be excluded. Fixed semantic-tokens for full qualified namespace Add score to completion items for a better completion client sorting. #1595 Revamp keyword completion. #1599 Avoid LSP errors when cleaning a file without namespaces. #1603 API/CLI New feature: Find all references via API and CLI. #1572","title":"2023.07.01-22.35.41"},{"location":"CHANGELOG/#20230504-193801","text":"General Bump clj-kondo to 2023.04.15-20230503.152749-8 Editor Fix edn tree to consider symbols. #1556 Fix edn tree to consider vector root nodes. #1557 Fix edn tree to handle invalid edn code and not throw exceptions while typing code. API/CLI Avoid enabling unecessary analysis features for API/CLI lint, improving memory usage.","title":"2023.05.04-19.38.01"},{"location":"CHANGELOG/#20230419-124329","text":"General Fix reflection issue in JDK19 with Thread/sleep #1520 Bump clj-kondo to 2023.04.15-20230418.173453-3 , fixing analysis inconsistencies with schema.core Ignore vars defined wrongly via config. #1510 Add support for :output {:langs true} in clj-kondo config to show .cljc language contexts Editor Fix classpath issue message to properly ignore or retry after user input. #1500 Decreate debounce time for calculating changes and diagnostics, improving UX in cost of performance, it doesn't seem to highly affect performance though. Add new setting to change diagnostics range type. #1530 Spec compliance: avoid registering client capabilities if dynamic registration is not set. #1535 Improve java support: using new java-member-definitions analysis, first feature is the allow completion of static members (fields and methods) for java classes. Show edn tree when in edn files via documentSymbol feature. Improve java db cache consistency + analysis performance.","title":"2023.04.19-12.43.29"},{"location":"CHANGELOG/#20230227-131212","text":"Editor Fix exception on hover feature on graal images.","title":"2023.02.27-13.12.12"},{"location":"CHANGELOG/#20230226-234605","text":"General Add new setting :paths-ignore-regex to allow ignore analyzing/linting specific paths, useful if you have folders or files that are not relevant to be linted and are huge which may affect performance. Bump clj-kondo. Fixes missing lint class constructors, making clojure-lsp show add import code action always. Fix wrong ns rename for cljc files. #1508 Editor Fix cache issue: wrong external dependencies analysis when running clojure-lsp in editor after running on CLI, affecting navigation. #1473 Bump lsp4clj fixing progress notifications during initialization for Calva. Allow go to definition of namespace even when the var is not known. Ex: clojure.string/foo will go to the definition of clojure.string . This is useful for cases where the var was not created yet but user wants to go to the ns to check the available functions or check the correct name of the function. Avoid basing results on old analysis. Add new setting :completion :analysis-type to choose between :fast-but-stale (default) or :slow-but-accurate , this should define whether completion should wait for changes that may still happening, this by default reverts the behavior introduced after #1425. #1487 Fix textDocument/hover issue when doc metadata isn't a string literal. Follow references to other vars in doc metadata for use in textDocument/hover . Support :arglists meta when finding docs of functions via hover feature. #1504 Enhance hover to search clojuredocs on CLJS. #1506","title":"2023.02.26-23.46.05"},{"location":"CHANGELOG/#20230126-110816","text":"General Bump clj-kondo to 2023.01.20 Avoid false-positives of unused-public-var for functions used in :gen-class that starts with - as convention. #1443 New jar available on releases: clojure-lsp-server.jar , an Uberjar not aot-ed containing both clojure-lsp core + server code, improving startup time for JVM clients, for example for lein-clojure-lsp . Any lib using clojure-lsp-standalone.jar should consider switch to this new jar. Change :source-paths-ignore-regex default value to [\"target.*\"] , removing resource folders. #1452 Bump cljfmt to 0.9.2 Bump lsp4clj to 1.7.0 Support :style/indent metadata for indentation with cljfmt #1420 Editor Fix add missing import code action when there are multiple options. #1422 Only show completion items if no changed code is being processed, avoiding wrong completion items. #1425 Improve semantic tokens for defprotocol, definterface coloring as interface tokens. Include reffered vars in completion. #1440 Allow rename alias of function calls, renaming properly both function usages and alias definition. Add support for keyword analysis in edn files, allowing find-references, document highlight and other lsp features to keywords. find-definition and references for quoted symbols like 'clojure.core/inc and symbols mentioned in .edn files. #1446 Show error messages when can't apply edits after commands. #1448 API/CLI Make diagnostics command print as json or edn. #1419 Make possible starting a chan server with clojure-lsp components, useful to other clients extend. Consider edn files when linting project, allowing to format edn files. #1452 Report diagnostics lines and columns as 1 based, not 0 like LSP, following clj-kondo standard. #1459","title":"2023.01.26-11.08.16"},{"location":"CHANGELOG/#20221209-155110","text":"General Fix rename issue with VS-Code/Calva on MS-Windows. #1388 Only publish progress on initialize if client provided a workDoneProgress . #1363 Bump clj-kondo to 2022.12.08 . Avoid wrong clj-kondo configs in case clojure-lsp process is spawned from a different directory than project-root. Fall back on CLJS var when finding definition from Clojure and nothing was found. #1403 Editor Show better icons for multimethods, var-arg fns, protocols, records, interfaces and types on workspace/symbol and textDocument/documentSymbol . Inlining the last binding of a let removes the let. #210 Allow import java classes via code-actions Add import 'x.y.Z' . Make add-import command/code-action smarter, checking if there is already a package import to just include the classname instead of full import. Add new refactoring cycle-keyword-auto-resolve , e.g. ::bar -> :foo/bar and vice-versa. #1128 Supporting find definition/references/implementations of definterface . Avoid watching ignored source-paths, causing find-definition/references and other features go to wrong files. API/CLI Allow specify analysis type for dump command, default to analyze project only analysis. #1383 Add :result to the dump command. #1390 Important regression fix where clojure-lsp may do inconsistent lint when classpath scan fail without showing to user the error.","title":"2022.12.09-15.51.10"},{"location":"CHANGELOG/#20221103-001457","text":"General Bump clj-kondo to 2022.11.02 avoiding breaking changes on custom hooks. Bump graalvm to 22.3.0. #1345 Editor Add refactorings to change param order of defn / defmacro , also changing call sites. #1131 Avoid shadowing existing locals when restructuring keys. #1229 Let editors control whether the server's log includes traces of the messages they are exchanging. https://github.com/clojure-lsp/lsp4clj/issues/27 Bump promesa to 9.0.470 Bump lsp4clj to 1.5.0 For users with fewer cores, avoid unnecessary waits for file analysis. Reduce CPU usage by aborting requests that the client won't use. Fix to mark some code actions as preferred, so editors can emphasize them. https://github.com/clojure-lsp/lsp4clj/issues/32 Adds java classes completions, since clj-kondo now knows all java classes defined on external dependencies. #1329 Fix completion to consider required namespaces without alias or refers. #1352","title":"2022.11.03-00.14.57"},{"location":"CHANGELOG/#20221005-163951","text":"General Improve clj-depend merge config to overwrite source-paths only if it is nil or empty. #1264 Fix stubs generation issue on MS-Windows, coming out of enabling all integrations tests on windows. #1211 Improve MS-Windows support by fixing various path, URI and line ending issues coming out of repairing the unit tests suite on windows. #1211 End dep-graph-queries experiment; clojure-lsp now uses the dep-graph to optimize queries whenever possible Bump clj-kondo to 2022.10.05 . #1226 Fix issue with changes being reporting with spurious and incorrect line endings on MS-Windows text files. #1211 Index internal data by URI instead of filename, to minimize conversion between these formats when running queries. #1207 Add support to enable trace logs on server via --trace flag. (For latest Emacs's lsp-mode this can be enabled easyly via lsp-clojure-trace-enable variable) Bump graalvm version for MS-Windows to 22.2.0, in sync with the other archs. #1211 Editor Fix to avoid error when checking code actions from an #_x uneval node. #1227 Add support to decompile jar as a java project when finding the definition of a java class, allowing to have LSP features on that java project. #1187 Add refactorings similar to Sort map : Sort vector , Sort list , Sort set , and Sort clauses for functions like assoc . #1155 Support java class decompilation for zipfile scheme (vim users). Avoid keeping diagnostics of external closed files for Calva. https://github.com/BetterThanTomorrow/calva/issues/1864 Lint opened files after a clojure-lsp or clj-kondo config file is saved on disk, avoiding users to re-edit files. #1247 Allow find definition of java class usages where definition comes from clojure, like defrecords. Fix: wait for rename to apply before allowing another rename, to ensure suggested name is correct. #1270 Process requests in parallel, to prevent typing lag and other performance problems introduced during migration away from lsp4j. #1240 Fix: Avoid wrong ns require after Create ns and require code-action/command. Fix: Avoid errors when a file starts with a comment. #1252 Bump promesa to 9.0.462 and use it for parallel request processing. API/CLI Fix missing diagnostics when --project-root is different than current directory. #1245 Add new dump feature, returning analysis, project information, dependency-graph and others. Check clojure-lsp.api/dump for more information. #744 Improve CLI output avoiding logs from clj-kondo which are already available via verbose log.","title":"2022.10.05-16.39.51"},{"location":"CHANGELOG/#20220901-152731","text":"General Remove dependency on lsp4j. https://github.com/clojure-lsp/lsp4clj/issues/8 Fix extra space on :import when sorting classes. #1152 Bump Graalvm from 22.0.0.2 to 22.2.0 improving binary performance/size. #1154 Bump clj-kondo to 2022.08.03 . General release of dep-graph-queries, improving query performance. See prior release for feature details. Generate nightly builds for macos aarch64 (M1/M2) every push on master. Bump lsp4clj to 1.2.1 . Bump cljfmt to 0.9.0 . Fix issue with classpath clojure build tools invocation on MS-Windows. #1132 Bump babashka/fs to 0.1.11 . Editor Improve completion sorting, showing locals before functions and other completion items. #1158 Fix hover to show current var definition docs instead of def / defn . #1157 Improve hover for requires to show ns docstring. #1171 Fix destructuring of things that have been destructured before. #1156 Some completions require that a new alias be added to the ns form. Fix this feature for Calva users, and improve performance for all users. #1068 Fix resolve-macro-as code action corner case. #1084 Ensure line numbers provided by document-symbol correspond to the latest version of the file. #1178 Avoid exceptions when clients use URIs that don't exist on disk. Fix documentation on completion items. #1181 Fix rename of defrecords. #1165 Fix to send all diagnostics to client at startup, even in very large projects. #1153 Fix to preserve kebab-casing in server-info-raw. #1195 Add refactoring Restructure keys , the inverse of Destructure keys . #1170 Add refactorings to convert between (:x m) and (get m :x) or (:y (:x m)) and (get-in m [:x :y]) . #1172 Add support to imported java class on completion. #1193 Add new question to skip or retry classpath scan during startup if failed. Improve performance of processing of changed files outside editor calling clj-kondo in batch. #1205 When renaming a keyword that is also a destructured key, rename its local usages too. #1192","title":"2022.09.01-15.27.31"},{"location":"CHANGELOG/#20220724-182543","text":"General Bump cljfmt from 0.8.0 -> 0.8.2 Editor Add clojure.core/fn to resolve-macro-as options. #1094 Restore #995 Improve element selected on textDocument/hover (previously reverted) with a fix that keeps it working for Calva even after a syntax error is introduced. Improve call hierarchy performance by parsing less frequently. #1092 Improve system wide performance by keeping a graph of dependencies between namespaces. #990 #1053 Enable setting :experimental {:dep-graph-queries true} to beta test this feature. Improve performance by adding second level of analysis indexing. Improve performance of things that need keyword definitions, like completion and custom lint. Fix hover showing previous function elements on some cases. #1098 Fix: find definition will find registration of unnamespaced keyword. Fix to update unused-public-var lint on registered keywords as usages change in other files. #1018 Fix to navigate to var defined by declare, when there aren't any later defs. #1107 Fix to always go to the definition of the correct var imported by potemkin. #1020 Fix to correctly rename namespaces. #1121 Fix to correctly :keep require and import indent spacing. #1141 Improve accuracy of progress reporting during uncached startup. #1134 Add refactoring Destructure keys to destructure keywords. #905 Add refactoring Extract to def to create a def from the thing under the cursor. #1136 Include defmethods in document and workspace symbols. #1016","title":"2022.07.24-18.25.43"},{"location":"CHANGELOG/#20220629-193213","text":"Editor Reverted #995 Improve element selected on textDocument/hover , as it caused clojure-lsp to stop working for Calva users after a syntax error was introduced. #1080","title":"2022.06.29-19.32.13"},{"location":"CHANGELOG/#20220622-140950","text":"General clojure-lsp has a flake.nix now, being able to be built using clj-nix. #999 Remove use-source-paths-from-classpath setting, its value was already true and disabling it could cause false-positives. Add compute-external-file-changes setting as true by default, when enabled it will consider file changes outside editor like git branch changes and update analysis, avoiding the need to restart server when a file is changed outside editor, this will only work if client file-watchers is enabled. #1002 Bump lsp4clj to 0.4.1. Remove deprecated disabled setting :linters :clj-kondo :async-custom-lint? . #1017 Fix references and code lens of defrecord/deftype for cljs files. #1055 Fix clean-ns to move reader conditionals to before normal requires. #1057 Add new optional linter: clj-depend integration. #957 Add new setting :source-paths-ignore-regex to filter source-paths that are auto generated for example for cljs projects, the default value should be enought for most cases ( [\"resources.*\" \"target.*\"] ), replacing old ignore-classpath-directories . Bump clj-kondo to 2022.06.22. Editor Add support to rename namespace of namespaced keywords like re-frame events/subs. #978 Improve performance of find-declaration feature. #1021 Fix to avoid suggesting an alias from a clj file to a cljs file. #1024 Find references of namespace usages now find all namespace usages on project, not only the definition. #1022 Improve element selected on textDocument/hover , showing the function being called instead of the closest element found backwards. #995 Fix drag from quoted symbols and other special nodes #969 Drag requests two smaller edits, instead of one large edit, potentially avoiding flicker. #1043 Drag is disabled between clauses, to avoid arbitrarily choosing one to move. #1030 Cursor doesn't move within dragged clause. #1029 Improve performance of drag forward. Avoid invalid cached analysis and document text after a rename. #1049 Improve lint performance by only linting references files when usage is added or removed. #1019 Extracted functions are private. #1039 Fix errors when Emacs lock files are linted. #1054","title":"2022.06.22-14.09.50"},{"location":"CHANGELOG/#20220531-173550","text":"General Bump clj-kondo to 2022.05.31 Consider .clj_kondo files as clj files.","title":"2022.05.31-17.35.50"},{"location":"CHANGELOG/#20220523-131811","text":"General Allow specify how many classes clojure-lsp should check before moving sorted package imported classes to next line. #966 Allow :linters to be configured by LSP clients passing string keys/values. #977 Support clj-kondo :config-in-ns and :ns-groups for clojure-lsp/unused-public-var linter. #981 Improve clean-ns correct positioning of multiple refers. Editor Fix powershell.exe command execution error on Windows Fix drag in are when clojure.test is aliased. #967 Reduce time to calculate semantic tokens, reducing CPU usage in large files. #970 Fix JDK global cache load when jdk source were already analyzed on previous sessions, fixing finding definition of jdk classes not working sometimes. Fix command move-form not working. Fix find definition of macros required by :require-macros on cljs files. #980 Add support to completion keywords found on function definition :keys destructuring, improving completion on api calls. Avoid duplicate parens when inserting snippets during completion. #982 CLI/API Make all cli features open files faster, improving speed of all CLI/API features. Fixes #985","title":"2022.05.23-13.18.11"},{"location":"CHANGELOG/#20220503-123540","text":"General Bump clj-kondo to 2022.04.26-20220429.192438-2 . Decrease uncached startup time by 60-70%, by instructing clj-kondo to skip var definition bodies when analyzing deps. #1674 Improve speed of alias/ns completions. Change alias/ns completions to return a label that matches the input. Support sorting classes inside package imports during clean-ns . #932 Avoid saving duplicate source-paths, not calling clj-kondo to analyze same filenames multiple times, improving startup speed. Improve progress report both on editor and CLI using new clj-kondo callback feature. Editor Support workspace/willRenameFiles , renaming namespaces and all its references when a file is renamed. Don't save cache when classpath lookup failed. Wait for editor to apply edits before requesting cursor re-positioning. Fixes cursor positioning after drag in Calva. drag: Request edit only of changed clauses, not entire parent, reducing flicker. CLI/API Bump lsp4clj to 0.3.0 . This release was supported by Clojurists Together","title":"2022.05.03-12.35.40"},{"location":"CHANGELOG/#20220418-005932","text":"General Improve settings documentation. Fix completion performance regression from previous release. Consider .bb and .cljd files as clj files. #906 Bump to clojure 1.11.0 Improve analysis query performance as a whole for lots of features. #916 Bump clj-kondo to 2022.04.09-20220414.123207-3 fixing semantic tokens for :require , :refer and :as . #1609 Move lsp4clj to outside clojure-lsp to its own repo/jar release. Fix local files outside source-paths not being linted even if opened/changed. Consider filename + lastModified as checksum for external files, avoiding analyzing it if analysis is already present. graalvm: Compile static linux with --musl for better compatibility. #868 java: Use XDG_CACHE_HOME or .cache/clojure-lsp instead of config files for JDK cache. java: Cache JDK analysis globally avoiding high CPU usages after startup. java: Add :java :home-path setting for easier way to specify java location for JDK source analysis. #907 Editor Introduce ALPHA move-form command. #566 Rename \"Move coll entry up/down\" to \"Drag forward/backward\", matching Calva/Paredit terminology drag: clauses move intuitively in clojure.test/are drag: top-level forms can be dragged #891 Improve completion performance for most cases, reducing time to compute clj/cljs core symbols. completion: suggest functions defined in Clojure 1.10 and 1.11 completion: Fix to no require extra ns when alias is already required. #920 promote-fn: new feature Promote a fn to a top-level defn. #783 @mainej promote-fn can also promote a literal #() to a fn demote-fn: Demote a fn to a literal #() breaking remove cycle-fn-literal, since the same refactorings can be performed with the more clearly named promote-fn and demote-fn drag: Fix to drag element-wise in destructured keys, not pair-wise. #927 test-tree: reduce CPU usage, especially during startup CLI Reduce CPU and wall-clock time in cli commands clean-ns and diagnostics This release was supported by Clojurists Together","title":"2022.04.18-00.59.32"},{"location":"CHANGELOG/#20220331-200020","text":"Fix URI resolver on java JDK logic. Fix zipfile scheme when finding external deps.","title":"2022.03.31-20.00.20"},{"location":"CHANGELOG/#20220331-142114","text":"Add java class find-definition support, decompiling .class files when available. #762 Add JDK source discoverability feature, searching for installed JDK for later analyze with clj-kondo and support java classes interop. Add :java :download-jdk-source? setting to download JDK source after startup if not cached before globally or found locally. Disabled by default. Avoid high CPU usage and freezes by more efficiently finding referenced files to notify on file change. #844 @mainej Bump clj-kondo to 2022.03.10-20220331.135739-32 improving java analysis and fixing a critical regression for re-frame. #888 This release was supported by Clojurists Together","title":"2022.03.31-14.21.14"},{"location":"CHANGELOG/#20220326-184708","text":"Fix unused-public-var not considering excluding comments, changing async-custom-lint? setting to false.","title":"2022.03.26-18.47.08"},{"location":"CHANGELOG/#20220325-120259","text":"General Fix cljfmt settings merge during refresh/classpath configs merge to avoid multiple config vectors on same symbol. Fix install script for aarch64. #794 Fix handling cljfmt config files that end in .clj https://github.com/weavejester/cljfmt/issues/190 parser: more efficiently seek to cursor position, improving performance especially in large files. #793 @mainej Fix clean-ns not sorting properly node requires for cljs. #815 Fix move-to-let to ensure locals don't move out of scope. #830 Improve logic around require suggestions. #837 Enhance move-to-let to introduce and expand let if an existing one doesn't exist. #829 Bump org.clojure/clojure to 1.11.0 . Fix move-coll-entry to maintain cursor position instead of a range. #862 Clean ns automatically after adding missing require/imports, enabled by default under new :clean :automatically-after-ns-refactor flag. #558 Editor extract-function: Fix wrong args when extracting from multi-arity fn. #683 extract-function: Fix wrong args when extracting after a local usage. #812 @mainej move-coll-entry: clauses move intuitively in assoc , case , cond , and similar functions. #780 @mainej move-coll-entry: fix NPE when when invoked from top-level #803 @mainej Generate stubs async after startup, improving startup time. #788 Improve and add lots of new snippets following practicalli config. #797 Improve how watched new files are analyzed avoiding infinite loops and performance issues. #796 Avoid infinite loops when several files are changed simultaneously. #796 @mainej Fix \"incoming call hierarchy\" not considering usages inside defmethods. #808 range-formatting: more efficiently locate extent of range and reduce number of calls to cljfmt, improving performance especially when formatting large ranges. #795 @mainej cycle-fn-literal: new feature convert between function-literal syntaxes (fn [] ...) <-> #(...) . #774 Add find-implementation feature to defmulti and defmethod . #751 Make find-implementation of defprotocol names find its implementations and find-implementation on deftype / defrecord methods find other implementations. Add new code action Introduce let for existing command. #825 Make find-implementations consider reify . #827 Fix namespace on file creation when nested source-paths are available. #832 unused-public-var: fix to show warnings on vars defined with declare. #840 unused-public-var: large performance improvements, especially for large projects. #861 @mainej API/CLI Extract lsp4clj as a seperate library. #807 @Cyrik Supported by Scarlet Fix inconsistency with clean-ns/format not copying kondo configs. This release was supported by Clojurists Together","title":"2022.03.25-12.02.59"},{"location":"CHANGELOG/#20220223-121212","text":"General Use :source-aliases setting during default deps.edn and lein project-spec aliases, avoiding the need to configure a whole project-spec just because of a additional alias. Exclude from unused-public-var linter vars with metadata ^:export . #753 Fix clean-ns multiple refers sort when there is a alias before the refers. Bump clj-kondo from 2022.01.15 to 2022.02.09 adding support for implementation analysis and more improvements. Medium performance improvement during startup when unused-public-var linter is disabled. Medium performance improvement during startup on unused-public-var calculation parallelizing calculations. Small performance improvement on code actions calcullation. Add :use-source-paths-from-classpath setting defaulting to true, which makes clojure-lsp do not manually discovery source-paths but get from classpath excluding jar files and paths outside project-root. #752 #551 Improve completion performance when all clojure.core or cljs.core symbols are valid completions. #764, #771 @mainej Fix scenarios where the lint findings in individual files differed from what you'd expect based on the .clj-kondo/config.edn settings. Add :exclude-regex and :exclude-when-definted-by-regex to :clojure-lsp/unused-public-var linter. Bump org.clojure/clojure to 1.11.0-rc1 . Editor Fix exception during code actions calculation when in a invalid code of a map with not even key-pairs. Don't return diagnostics for external files like files on jar dependencies, avoiding noise on lint when opening dependencies. Support finding implementations of defprotocol and references of defrecord/deftype, implementing LSP method textDocument/implementation . #656 Make the actions and commands aware of when they were invoked from comments or whitespace. This will allow individual refactorings to be more deliberate about how they handle comments and whitespace. #716 @mainej Correctly position the cursor after calling move-coll-entry-down on an entry with leading comments. #758 @mainej Don't return completions when invoked from a comment, avoiding performance problems. #756 Fix small anomalies in parameter names of extracted private functions. #759 @mainej Add semantic tokens for protocol implementations methods like defrecord and deftype. Small performance improvevement on code lens calculation using transducers. API/CLI Small performance improvement to format , clean-ns , diagnostics , and rename via parallelizing parts of the logic. Fix edn->json parser of serverInfo/raw for Calva use cljfmt configuration. #763 Add :cljfmt-raw config to serverInfo/raw for Calva. #768 Add support for passing specific --filenames for most actions. #775 This release was supported by Clojurists Together","title":"2022.02.23-12.12.12"},{"location":"CHANGELOG/#20220201-200232","text":"General Fix classpath hash regression introduced by last release","title":"2022.02.01-20.02.32"},{"location":"CHANGELOG/#20220201-165314","text":"General Migrate project from depstar -> tools.build. #711 Improve classpath hash to consider invaliding cache when local root deps was changed. Replace datalevin cache db with transit. #703 Bump Graalvm from 21.3.0 to 22.0.0.2 improving binary performance/size Update XDG_CONFIG_HOME to clojure-lsp directory in doc/settings.md Editor Support going to namespace definition on an alias. #706 Add LSP textDocument/declaration , for now adding the making possible navigate to alias and namespaces declared on the namespace. #680 Fix removal of file analysis on didClose for external files like jars. #717 Fix cursor not moving when using code actions that move the cursor automatically. Fix additional-snippets to work on top-level forms as well. Fix resolve completion item not returning insertText. #719 @Cyrik Remove support for LSP codeAction/resolve . It added complexity and was not used in a way that improved performance of the action menu. #722, #725, #726 Fix create public function refactoring not working when function is not a function call.","title":"2022.02.01-16.53.14"},{"location":"CHANGELOG/#20220122-013109","text":"General Fix freezing in some cases during clojure-lsp startup linting. #708","title":"2022.01.22-01.31.09"},{"location":"CHANGELOG/#20220120-141243","text":"General Bump clj-kondo to 2022.01.15 . Add :classpath to serverInfo command for downstream usages. Fix issues in extract-function that arise when operating over .cljc files. Add setting :copy-kondo-configs? to allow disable auto clj-kondo config copy, enabled by default. #694 Lint unused public keywords, like unused re-frame events/subs. #691 Fix rename of namespaced keywords -> aliased keywords. #665 Huge refactor on clojure-lsp codebase, spliting code into submodules, this made possible remove a lot of deps from API jar and help separate clojure-lsp features in the future. #658 Send testTree notification for all project test files after clojure-lsp start. #697 Editor Improve 'create function' refactor code action handling multiple cases. #682 Fix 'resolve macro as ...' code action not working. Fix showDocumentRequest issues when triggered via some refactor code action. Add new code actions + commands Move coll entry down and Move coll entry up to move entries within collections. #684, #701 API/CLI Make format , clean-ns and rename features not need to scan whole classpath, analyzing only project code improving performance a lot.","title":"2022.01.20-14.12.43"},{"location":"CHANGELOG/#20220103-194610","text":"Catch clj-kondo prints to stdout and log to clojure-lsp log file avoiding crashes on some clients like vscode/Calva.","title":"2022.01.03-19.46.10"},{"location":"CHANGELOG/#20220103-154119","text":"General Fix some analysis conflicts regarding custom-async-lint? feature introduced on latest release causing outdated analysis and some deadlocks. Editor Fix inline symbol code action regression from previous releases. #678 Fix expand let refactor duplicating variables in some cases. #676 Add completion support to potemkin usages of a namespace. API/CLI Wait for db cache upsert before end proccess, avoiding the need to re-lint whole classpath on next api/cli runs. Fix the need to use :raw? true on babashka pod usage.","title":"2022.01.03-15.41.19"},{"location":"CHANGELOG/#20211220-003656","text":"General Bump clj-kondo to 2021.12.19 , supporting auto-load configs, improving potemkin support, adding more linters and more. Merge :cljfmt settings with :cljfmt-config-path if file path exists. Avoid high CPU and lockup when clj-kondo throws exceptions. #671 Allow absolute paths in deps.edn :local/root #672 Fix clojure-lsp not loading for some mono-repo cases, improving local/root support for polylith projects. #673 Avoid infinite loop because of cyclic dependencies on deps source-path discovery. Add babashka pod. #555 Editor Change call hierarchy to return selection range of usage, not function definition. Return edits in codeAction/resolve responses rather than commands . #655 Improve :linters :clj-kondo :async-custom-lint? to avoid infinite loops and default to true . Add new custom LSP feature Test Tree , which shows all test hierarchy of a file. #653 Improve function name finding to consider other function definition types for some features. #666 Make textDocument/hover return the correct range from LSP spec, the element range instead of the element scope range. API/CLI Exit process if any error during classpath lookup. Opt-out via :api :exit-on-errors? flag.","title":"2021.12.20-00.36.56"},{"location":"CHANGELOG/#20211201-122816","text":"General Add support for LSP method textDocument/prepareRename which it's the proper way to check if the rename will work correctly. #642 Expose new custom method clojure/cursorInfo/raw for custom hack on current cursor information code. #645 Support stub generation using clj-easy/stub , adding analysis and linting support for closed sources codes like Datomic. Check :stubs settings for more details. #637 Handle config deep merge differently for collections, concating instead of overwriting. Fix unnecessary exception thrown on graal images during startup. Support deps.edn :local/root source-paths discovery, improving support for monorepo projects like polylith . #652 New setting value for :clean :sort :require : :lexicographic . #654 Bump clj-kondo to 2021.10.20-20211126.151305-16 . Editor Support completion on aliased keywords. #649 Add new Sort map keys refactoring code action. #651 Add new Create function code action, allowing to create a function on a existing namespace or creating a new namespace + the function. #646 Improve Extract function refactoring to consider comments above current function. Experimental: new :linters :clj-kondo :async-custom-lint? setting, when true, scan unused-public-vars async improving lint/analysis UI feedback for huge buffers (> ~1000 lines). Default false . This release was supported by Clojurists Together","title":"2021.12.01-12.28.16"},{"location":"CHANGELOG/#20211116-165214","text":"General Improve rename feature to not heavily rely on valid source-paths for most cases. Fix setTrace exception logs for graalvm native images. Huge improvements on namespaces renames and namespaces references find. #573 Fix/Remove warnings during datalevin access. Improve freezing for some MacOS cases. #631 Bump clj-kondo to 2021.10.20-20211116.110002-7 improving code parsing and other fixes. Editor Fix \"Add require\" code actions adding multiple requires instead of the selected. Improve \"Add require\" wording, making it easier to understand what each different action will do. Smart check all available refers to require, adding refer options to Add require code actions. #627 Big improvements on keyword completions. #630 Add setting keep-parens-when-threading? to keep parens for single arity functions when threading. #636 Avoid adding duplicate requires when adding a new require via code action. #640 Improve common known snippets to replace completion items, improving completion UX. #638 This release was supported by Clojurists Together","title":"2021.11.16-16.52.14"},{"location":"CHANGELOG/#20211102-152447","text":"General Bump Graalvm from 21.2.0 to 21.3.0 improving binary performance/size Fix wrong parse of code when code contains namespaced maps like #:foo{:bar 1} . This issue was affecting a lot of features for example code actions. Bump datalevin from 0.5.26 to 0.5.27. Improve semantic tokens for dynamic vars, function definitions, namespaced and aliased keywords. Fix bug where :source-paths settings could be hot-reloaded with wrong-value. Editor Deprecates setting :show-docs-arity-on-same-line? in favor of :hover :arity-on-same-line? . Add support to new LSP LinkedEditingRange feature. #341 Improve suggested Add require ... code actions, this should make clojure-lsp smarter when user wants to add a missing require. #614 Change :notify-references-on-file-change default from false to true , we had some performance improvements and I've been testing this for some time now and didn't see any new issues with that. This should improve a lot the UX when user change any code that is references on other files, updating the diagnostics for those files as well. Improve rename feature UX to output errors when it's not possible rename. Add support for window/showDocument LSP method, used on create-test command/code action after creating the test to show the test file. Add new Unwind thread once and Unwind whole thread code actions to undo a thread call. Improve code actions performance requesting async all actions. Add new LSP custom method clojure/clojuredocs/raw which takes a symbol and a namespace (both strings) and returns any Clojuredocs entry found, otherwise null . Fix missing keywords rename/references for destructured keywords. CLI Show error/warning message when a classpath scan fail during analysis. Fixes #626 Add coloring to diagnostics output matching diagnostic severity. This release was supported by Clojurists Together","title":"2021.11.02-15.24.47"},{"location":"CHANGELOG/#20211020-164947","text":"Editor Hot fix clojuredocs on graalvm native image. Bump clj-kondo to 2021.10.20-20211020.123254-3 to fix a specific issue with cljs. Implement support to return to client LSP Errors, making user UX better since clojure-lsp can return specific errors for specific exceptions.","title":"2021.10.20-16.49.47"},{"location":"CHANGELOG/#20211020-130411","text":"General Improve intialization feedback report messages. Consider dev and test alias for deps.edn projects as project-specs during classpath lookup. #586 Avoid scanning source-paths twice, as it was being considered as part of external classpath as well. Change cache db from sqlite to datalevin for faster startup + better graalvm compatibility. Make the cache analysis save async to make startup faster. Support Auto refresh settings memoizing with a ttl of 1 second avoiding the need of restarting server when changing configs. #502 Bump clj-kondo adding new gen-class linter and other fixes/improvements. Fixes #589 Remove unused duplicate require if any. #527 Fix crash on clean-ns when ns contains comments. Improve project analysis filter to check source-paths. #597 Editor Add reference code lens for ns forms. #578 Fix expand-let bug that occurs when a list form precedes let. #590 Add new command to create test for function at point. #582 Add new code action to create test for current function/var Add private to documentSymbol to make clear that a var or function is private . Add new code action Suppress xxx diagnostic , adding clj-kondo comment code to ignore the diagnostic. #591 Add more semantic tokens: aliases for macros, variable and function definitions. Add clojuredocs information during symbol hover. #571 This release was supported by Clojurists Together","title":"2021.10.20-13.04.11"},{"location":"CHANGELOG/#20210930-152801","text":"Editor Hot fix hover content wrong type hinting.","title":"2021.09.30-15.28.01"},{"location":"CHANGELOG/#20210930-122816","text":"General Use lower-case for refer/import/require sorting. #560 #561 Avoid removing comments when sorting/cleaning namespace. #559 Break lines when sorting refers along with then new :clean :sort :refer :max-line-length setting with a default of 80 . #562 Deprecate lens-segregate-test-references in favor to :code-lens :segregate-test-references Check for a default .cljfmt.edn config file for cljfmt config settings if no :cljfmt-config-path was provided. #563 Bump clj-kondo to 2021.09.25 fixing false-positives with potemkin import-var analysis. Re-scan whole project if any clj-kondo config changed for better consistence. #331 Fix clojure-lsp not initializing when empty project.clj . #579 Support finding config in classpath via new setting :classpath-config-paths [\"my-org/my-lib\"] . #580 Editor Fix resolve macro as code action after regression introduced recently. Fix unused-public-var not being suppressed during project startup. #554 Improve hover feature to return elements when inside a function call. #569 Fix create-private-function command and code action to consider when new function is inside thread macros. Support $/progress LSP feature, sending notifications for client when server is starting, improving the feedback for the user. Improve semantic tokens support for java classes and methods. API/CLI Support renaming namespaces as well with rename feature. Use relative paths instead of absolute paths on diff messages. Add analyze-project! to analyze whole project only and cache analysis, useful for REPL usage for example. Follow same exit status from clj-kondo for diagnostics feature. #572 Improve start project feedback reporting the percentage and specific message. This release was supported by Clojurists Together","title":"2021.09.30-12.28.16"},{"location":"CHANGELOG/#20210913-222535","text":"Editor Rollback change on didChangeWatchedFiles for :change events, avoiding outdated changes overwriting newer changes.","title":"2021.09.13-22.25.35"},{"location":"CHANGELOG/#20210913-193200","text":"General Create .clj-kondo folder if not exists in project root. #528 Fix exception when :clojure-lsp/unused-public-var linter is :off . #546 Bump clj-kondo to 2021.08.07-20210903.210340-28 to fix a false-positive with potemkin. https://github.com/clj-kondo/clj-kondo/issues/1370. Bump clj-kondo to 2021.08.07-20210909.131804-29 fixing issues with built-in clj-kondo cache not present on graalvm binaries. #548 Exclude cljs.test/deftest from unused public vars linter. Migrate default db file from .lsp/sqlite.db to .lsp/.cache/sqlite.db , this is necessary as in the future we will replace sqlite with other db implementation, for users they just need to consider/gitignore the .lsp/.cache folder, this way any next change on db implementations or any other cache will not affect user. Auto migrate existing .lsp/sqlite.db to new .lsp/.cache/sqlite.db to avoid unnecessary project re-scan. Deprecates :sqlite-db-path in place of :cache-path . Editor Fix didChangeWatchedFiles to correctly create the file on server, properly change file content and re-scan with clj-kondo, or remove file analysis. This should improve LSP analysis reliability when changing files outside the editor. #536 Improve completion only showing valid local vars for current cursor. Improve completion sorting adding priority to each item, showing most used symbols like variables and functions first before other completion items. API/CLI New diagnostics command, which return all diagnostics found by clojure-lsp (using clj-kondo). Check the API section for more details. This release was supported by Clojurists Together","title":"2021.09.13-19.32.00"},{"location":"CHANGELOG/#20210904-171144","text":"Hotfix java classes not present on jar, required for clojure-lsp downstreams.","title":"2021.09.04-17.11.44"},{"location":"CHANGELOG/#20210903-004246","text":"General Improve logging during startup for better troubleshooting. Refactor allowing calls to clojure-lsp.main/run! for manually passing args, useful for lein-clojure-lsp for example. Internal: Move graalvm configuration to sqlite-jdbc. Recognize deftest as function definition form for refactoring features like extract-function . Bump Graalvm from 21.1.0 to 21.2.0 API/CLI Use clj-kondo custom lint for API as well, required for correct diagnostics API feature. Editor Fix regression, custom source-paths from initializationOptions were not being parsed correctly. #537 Documentation New domain for documentation and webpage https://clojure-lsp.io","title":"2021.09.03-00.42.46"},{"location":"CHANGELOG/#20210824-144156","text":"General Fix classpath scan when classpath has other things like new lines or warning message besides the classpath. Fixes #523 Improve clean-ns to remove empty reader conditionals( #?(:clj) or #?@(:clj []) on ns form) after cleaning requires/imports. Fix clean-ns false-positives removals to cljc files when the alias/refer/import is being used inside a reader conditional. Add new setting :linters :clj-kondo :ns-exclude-regex which allows exclude diagnostics/findings for namespaces matching that regex. Fix merge of configs resolved for projects with multiple configurations in parent folders and subprojects. Docs Improved the settings docs with a new link to a file with all available clojure-lsp settings.","title":"2021.08.24-14.41.56"},{"location":"CHANGELOG/#20210816-190230","text":"Fix clojure-lsp --version","title":"2021.08.16-19.02.30"},{"location":"CHANGELOG/#20210816-144754","text":"General Fix wrong parse of source-paths for bb.edn when :paths contains symbols not only strings. #507 Bump clj-kondo to fix a issue with clojure-lsp running in a lein process. Editor Fix find-definition in jars for cljc files where the var is available on both cljs and clj files. #509 Add clojure.core.async common vars to common-refers to be required via code action. Remove diagnostics when files are deleted, properly cleaning server. #513 Don't add ns form to blank edn files. #515 Fix initializationOptions parsing for some clients. #516 Fix refactor 'add missing refer' when there is already that namespace with a alias but no refers. Improve :notify-references-on-file-change performance and use-cases, still disabled by default for some time. API Rollback printing only via CLI to work with API as well. (can be disabled via :raw? option) Support for release of lein-clojure-lsp","title":"2021.08.16-14.47.54"},{"location":"CHANGELOG/#20210805-193609","text":"Bump clj-kondo to fix window path issues with analysis. Fix issue with references code lens for vim.","title":"2021.08.05-19.36.09"},{"location":"CHANGELOG/#20210805-182554","text":"Fix async project lint after startup for huge projects. #506 Fix :lint-project-files-after-startup? to be considered before clojure-lsp lint unusued public vars. Fix excluded symbols for code lens, making clojure-lsp check clj-kondo config as well for the :clojure-lsp/unused-public-var excludes","title":"2021.08.05-18.25.54"},{"location":"CHANGELOG/#20210803-133303","text":"General Parse correctly unescaped URIs sent from clients like vim avoiding errors on some features. Bump clj-kondo fixing analysis position issue with declare , making rename and other features work. Don't use PowerShell profiles on Windows when analyzing classpath. Fixes https://github.com/BetterThanTomorrow/calva/issues/1050 Support babashka classpath and source-paths discovery via bb.edn file. (needs babashka >= 0.5.1) Editor Add :hover :hide-file-location? settings option to disable displaying the source path on hover. Use new clj-kondo :custom-lint-fn for the :unused-public-var , this should improve performance and give the ability to suppress unused vars via code with #_{:clj-kondo/ignore [:clojure-lsp/unused-public-var]} or #_:clj-kondo/ignore","title":"2021.08.03-13.33.03"},{"location":"CHANGELOG/#20210728-142406","text":"General Minor fix on the analysis queries comparison. Improve GraalVM configuration to use direct/less configurations. Bump clj-kondo 2021.06.18 -> 2021.07.28 which adds support for macroexpanding. Editor Fix outgoing/incoming call hierarchy when vars are outside project/external jars. Fix completion of aliases without var names typed yet, for example: string/ API/CLI Fix filename in diffs with dry option. Add coloring to diffs following git diff. Add ns-exclude-regex for commands that check whole project, allowing to exclude certain namespaces via regex.","title":"2021.07.28-14.24.06"},{"location":"CHANGELOG/#20210719-144652","text":"General clean-ns now sorts ns children forms according to the ClojureStyleGuide, at the moment moving require form before import form, enabled by default under flag :clean :sort :ns setting. Improve startup error handler and logging during project analysis. Related to #484 Performance improvements using transducers on analysis queries. Fixed auto-resolve source-paths for lein projects that get source-paths dynamically, clojure-lsp will use the default source-paths for these cases Editor Improve hover output, both markdown and plain text forms. Allow calling thread-first/last and thread-first-all/last-all from within the list. Improve resolve-macro-as messages and default excluded symbols. API/CLI Fix empty XDG_CONFIG_HOME not defaulting to $HOME/.config #474 Improve verbose logging setting.","title":"2021.07.19-14.46.52"},{"location":"CHANGELOG/#20210712-123059","text":"Editor Make semantic-tokens return no token for unknown symbols which has :clj-kondo/unknown-namespace on its analysis. Fix file uri location when hovering a symbol. Add reference code lens to keyword definitions, e.g. re-frame.core/reg-sub . Add semantic-tokens debug information to cursor-info response. API/CLI Fix when ns form does not match filename. #466 Fix errors with project-root on graalvm binary Improve API usage avoiding exceptions and returning just data instead. Improve analysis cache to multiple API calls. Add new --raw option allowing to display only raw data. Useful to integrate with other tools like reviewdog.","title":"2021.07.12-12.30.59"},{"location":"CHANGELOG/#20210705-203112","text":"API/CLI Add --verbose option for debugging purposes. Fix usage as library parsing :exec-args correctly","title":"2021.07.05-20.31.12"},{"location":"CHANGELOG/#20210705-151214","text":"General Add :clean :sort settings option to disable sorting during clean-ns . Add :keep value to :ns-indent-blocks-indentation setting to don't change indentation during clean-ns . Deprecate install-latest-clojure-lsp.sh in place of install new script. Improve source paths discoverability for leiningen projects following the same rules as deps.edn projects. For more information, check the settings section . API/CLI Add --dry option to commands, useful to print only diffs instead of making changes. Check the new setup-clojure-lsp Github Action to run clojure-lsp on CI. Add format feature using cljfmt. Now, every release is available in clojars as com.github.clojure-lsp/clojure-lsp .","title":"2021.07.05-15.12.14"},{"location":"CHANGELOG/#20210701-194902","text":"Fix --project-path option for API. Add --log-path option to API.","title":"2021.07.01-19.49.02"},{"location":"CHANGELOG/#20210701-134618","text":"Fix find-references and references lens for defrecord . Improve clean-ns refactoring following the Clojure style guide. Fix clean-ns corner case issue where it would replace the :as value with the :refer value. Deprecate :keep-require-at-start? in favor of :clean :ns-inner-blocks-indentation with default value of :next-line . Bump org.xerial/sqlite-jdbc from 3.34.0 to 3.36.0. Avoid adding duplicated namespace for new blank files. Add API / CLI support, form more information check the API section.","title":"2021.07.01-13.46.18"},{"location":"CHANGELOG/#20210624-142411","text":"Fix missing LSP 3.16 graalvm reflection configs. #452","title":"2021.06.24-14.24.11"},{"location":"CHANGELOG/#20210624-012001","text":"Fix graalvm reflect config for LSP 3.16 protocol. #449 Use last definition when showing signature help. #446 Create 2 new LSP custom methods: clojure/serverInfo/raw and clojure/serverInfo/log deprecating old commands server-info and cursor-info , check the documentation for more information. Add :final-settings to serverInfo methods. #450","title":"2021.06.24-01.20.01"},{"location":"CHANGELOG/#20210621-143054","text":"Avoid removing whole require if unused refer but with used alias during clean-ns. #447 Bump cljfmt 0.7.0 -> 0.8.0. Fixes #266 Bump clj-kondo 2021.06.01 -> 2021.06.18","title":"2021.06.21-14.30.54"},{"location":"CHANGELOG/#20210614-170047","text":"Improve source paths discoverability for deps.edn projects. Adds :source-aliases for customization. For more information, check the settings section .","title":"2021.06.14-17.00.47"},{"location":"CHANGELOG/#20210601-161944","text":"Fix graalvm issue on completionItem InsertTextMode Bump clj-kondo and rewrite-clj to latest releases.","title":"2021.06.01-16.19.44"},{"location":"CHANGELOG/#20210527-174234","text":"Fix corner case error with project paths with spaces or other special characters. #437 Drastically improve didOpen performance, improving kondo findings parsing and making linting async avoiding blocking some editors. #435 Fix :auto-add-ns-to-new-files? flag always being considered as true . #436","title":"2021.05.27-17.42.34"},{"location":"CHANGELOG/#20210522-165045","text":"Fix completion item kind of clojure core items. Fixes #426 Fix graalvm reflect config for SublimeText - #430 Improve code lens for segregated code lens when on test files.","title":"2021.05.22-16.50.45"},{"location":"CHANGELOG/#20210514-152602","text":"Include non full qualified vars on unused-public-var exclude filter. Improve hover documentation: use correct markdown for docstrings; remove unnecessary new lines; add link to filename location. Rollback full text changes on last release and change approach for a temporary fix. #424","title":"2021.05.14-15.26.02"},{"location":"CHANGELOG/#20210506-194400","text":"Quick fix full text changes to handle it sync for semantic tokens Segregate main references from test references with option to disable via lens-segregate-test-references","title":"2021.05.06-19.44.00"},{"location":"CHANGELOG/#20210427-201745","text":"Significantly improve the performance of workspace symbol filtering/searching. See relevant commit . Always sort refers when clean-ns. Add support for installing with homebrew on Linux. Bump clj-kondo to 2021.04.24-20210426.144134-2 adding support for finding re-frame by keyword. Fixes #411 Fix find definition going to declare - Fixes #340 Remove common already known clojure macros from Resolve macro as code action.","title":"2021.04.27-20.17.45"},{"location":"CHANGELOG/#20210423-154947","text":"Improve resolve-macro-as command to check and log if couldn't resolve the macro. Improve workspace symbol filtering/searching. Now, the sole candidates shown are guaranteed to include all the characters contained in the filter/search string. Add more tokens to semantic tokens: keywords, functions/var usages, java classes, local variables. Bump Graalvm from 21.0.0 to 21.1.0 Bump clj-kondo to 2021.04.23 fixing some keywords corner cases.","title":"2021.04.23-15.49.47"},{"location":"CHANGELOG/#20210413-124733","text":"Add common snippets on completion. Check all available snippets here . Add support for custom snippets via :additional-snippets . Check here for more information. - Fixes #403 Bump lsp4j from 0.11.0 -> 0.12.0","title":"2021.04.13-12.47.33"},{"location":"CHANGELOG/#20210407-163410","text":"Fix renaming keywords in cljc files producing duplicate edits. After project startup, publish all project only diagnostics. This is a approach done by other LSPs to make work features like Project errors . Feature flag via lint-project-files-after-startup? with default true . Add experimental support for aarch64 linux native binary Fix formatting issues with a regression introduced on a previous release. - Fixes #339 and #396","title":"2021.04.07-16.34.10"},{"location":"CHANGELOG/#20210403-184355","text":"Fix textDocument/workspaceSymbols filter not working on native binaries. Report duplicate linters as default, can be disabled via :linters :clj-kondo :report-duplicates - Fixes #390 Bump rewrite-clj to 1.0.605-alpha to fix exceptions when on clojure files with babashka interpreter on first line. Bump clj-kondo 2021.04.01-20210402.215253-6 to fix bug https://github.com/clj-kondo/clj-kondo/issues/1246","title":"2021.04.03-18.43.55"},{"location":"CHANGELOG/#20210330-204234","text":"Bump clj-londo 2021.03.22-20210327.192113-4 - Fixes #385 Add support for outgoing call hierarchy - Fixes #384 Improve and fix missing completion item kinds.","title":"2021.03.30-20.42.34"},{"location":"CHANGELOG/#20210326-234107","text":"Bump clj-kondo 2021.03.22-20210324.110254-3 - Fixes #382 [graalvm] Fixes Unable to invoke no-args constructor for class org.eclipse.lsp4j.ShowDocumentCapabilities error. Fix/enhance keyword rename - #383","title":"2021.03.26-23.41.07"},{"location":"CHANGELOG/#20210324-004155","text":"Migrate from lein to deps.edn Bump clj-kondo to 2021.03.22 Fix clean-ns sorting according to symbols not brackets - Fixes #380 Fix missing graalvm reflect config for CompletionItemTextEdit - Fixes #381","title":"2021.03.24-00.41.55"},{"location":"CHANGELOG/#20210321-232919","text":"Add code action 'resolve macro as', it requires client to fill the chosen macro and clj-kondo config file. Bump rewrite-clj to 1.0.594-alpha Bump data.json to 2.0.1 Bump lsp4j to 0.11.0","title":"2021.03.21-23.29.19"},{"location":"CHANGELOG/#20210318-192341","text":"Add support for diagnostic tags: deprecated and unnecessary. Fix wrong textDocument/documentHighlight for function local-usages. Use new clj-kondo copy-configs flag to copy hooks during lint. Bunp clj-kondo to fix unused public linter check for :exclude-when-defined-by","title":"2021.03.18-19.23.41"},{"location":"CHANGELOG/#20210316-202806","text":"Fix server not analyzing after a wrong code on cljs files - #367 Rollback incremental didChange adding a new :text-document-sync-kind setting with :full as default.","title":"2021.03.16-20.28.06"},{"location":"CHANGELOG/#20210314-232246","text":"Fix completion inside refers, re-add support for it - Fixes #364 Change range of expression functions clj-kondo diagnostics to avoid collision with function signature.","title":"2021.03.14-23.22.46"},{"location":"CHANGELOG/#20210306-170535","text":"Fix incremental didChange, debouncing distincting by uri, fixing some inconsistent file changes when multiple files are changed at same time (rename, iedit, etc). Make unused-public-var ignore -main public functions. Add :exclude-when-defined-by option to unused-public-var linter, check settings documentation for more information.","title":"2021.03.06-17.05.35"},{"location":"CHANGELOG/#20210305-133547","text":"Fix clojure-lsp lint crash when analyzing specific macros with clj-kondo hooks. Fix didChange for Nvim client. Add new clojure-lsp linter: unused-public-var - Fixes #359 Add option to disable clj-kondo linter, check settings documentation for more details.","title":"2021.03.05-13.35.47"},{"location":"CHANGELOG/#20210301-191854","text":"Bump clj-kondo fixing issues on require form not being analyzed. Fix textDocument/workspaceSymbols to use the query sent by client.","title":"2021.03.01-19.18.54"},{"location":"CHANGELOG/#20210227-233555","text":"Add support to complete full qualified namespaces - Fixes #337 Add :log-path setting to log to a custom file. Avoid exception on code actions when on cljc reader macros - Related to #346","title":"2021.02.27-23.35.55"},{"location":"CHANGELOG/#20210226-135848","text":"Improve clojure-lsp config search checking always home dir considering XDG_CONFIG_HOME and project root up to system root (/) - Fixes #339. Handle incremental text changes on textDocument/didChange notifications following LSP protocol, improving performance for huge files. Add clj-kondo version to --version and server-info. Add new create private function code action.","title":"2021.02.26-13.58.48"},{"location":"CHANGELOG/#20210224-142308","text":"Improve completion performance resolving the item only when documentation is requested Add new thread first/last all code actions","title":"2021.02.24-14.23.08"},{"location":"CHANGELOG/#20210221-210251","text":"Implement support for textDocument/signatureHelp - Fixes #324 Disable notify-references on didChange with a flag notify-references-on-change . Fix completion not working when reader macro on file - Fixes #332","title":"2021.02.21-21.02.51"},{"location":"CHANGELOG/#20210219-230840","text":"Fix duplicated symbols for cljc files on textDocument/documentSymbols - Fixes #328 Add namespace require when completing a unimported namespace - Fixes #309 Fix completion not working for cljc files","title":"2021.02.19-23.08.40"},{"location":"CHANGELOG/#20210219-001927","text":"Fix completion of invalid clojure core (e.g. foo/ ) - Fixes #270","title":"2021.02.19-00.19.27"},{"location":"CHANGELOG/#20210217-170045","text":"Allow find all references across the project of simple keywords Allow specify custom sqlite.db location with sqlite-db-path , default to <project>/.lsp/sqlite.db","title":"2021.02.17-17.00.45"},{"location":"CHANGELOG/#20210214-194647","text":"Removing false positive logs from invalid analysis from clj-kondo macro expand analysis Fix call hierarchy when the reference was not open yet in the editor. Smart re-analyze variable/function references when arguments of the definition were updated. Rollback Macos native image compress until it works for MacOS Big Sur - #322","title":"2021.02.14-19.46.47"},{"location":"CHANGELOG/#20210213-180419","text":"Bump clj-kondo to fix false-positive unresolved-vars Prioritize project analysis on all analysis during find definition - Fixes #318 Compress native binaries with UPX decreasing binary size.","title":"2021.02.13-18.04.19"},{"location":"CHANGELOG/#20210212-031312","text":"Fix completion issues with graalvm native linux binaries when completing local variables. Fix completion exception when completing numbers - Fixes #310 Completion inside a require suggests all available namespaces Change log pattern to /tmp/clojure-lsp.<TIMESTAMP>.out use default temp file. Should fix issues with permissions on tmp folder.","title":"2021.02.12-03.13.12"},{"location":"CHANGELOG/#20210211-124306","text":"Fix auto add ns not working for projects. New code action: Move to let New code action: Change coll to map, list, set or vector","title":"2021.02.11-12.43.06"},{"location":"CHANGELOG/#20210210-030119","text":"Fix config passed to clj-kondo during analysis - Fixes #308","title":"2021.02.10-03.01.19"},{"location":"CHANGELOG/#20210209-182806","text":"Fix auto add ns to check project root and source paths Add alias on copmletion items - Fix completion items for Calva client","title":"2021.02.09-18.28.06"},{"location":"CHANGELOG/#20210207-225126","text":"Fix install-latest-clojure-lsp.sh script - #304 Fix clojure-lsp re-analysing classpath when project contains a keyword starting with a number - #305 Allow clj-kondo to pick up config correctly in mono repos - #303","title":"2021.02.07-22.51.26"},{"location":"CHANGELOG/#20210207-030431","text":"Make release's native binaries executable by default - #299 Improve completion removing the necessity to call completion/resolveItem - #292 New code action: Add suggested alias to namespaces - #302","title":"2021.02.07-03.04.31"},{"location":"CHANGELOG/#20210205-030534","text":"Add support for keyword analysis (definition, references, completion, rename, hover) Reduce jar and binaries size excluding some dependencies (Need to fix a lein issue yet)","title":"2021.02.05-03.05.34"},{"location":"CHANGELOG/#20210204-020858","text":"Fix --version on graalvm native compiled binaries","title":"2021.02.04-02.08.58"},{"location":"CHANGELOG/#20210204-010921","text":"Add integration tests to release process","title":"2021.02.04-01.09.21"},{"location":"CHANGELOG/#20210202-140223","text":"Fix clojure-lsp embedded jar binary during release CI Fix duplicate references on cljc files","title":"2021.02.02-14.02.23"},{"location":"CHANGELOG/#20210202-030646","text":"Add clojure.java.io to known requires - #291 Add manual System/gc after first classpath scan, it should decrease memory after the first startup Add support for Windows GraalVM compiled native binary","title":"2021.02.02-03.06.46"},{"location":"CHANGELOG/#20210201-203752","text":"Add native binaries for Linux and MacOS compiled with GraalVM #267 (Experimental)","title":"2021.02.01-20.37.52"},{"location":"CHANGELOG/#20210128-030316","text":"Fix clj-kondo batch analysis when merging batchs - Fix #284","title":"2021.01.28-03.03.16"},{"location":"CHANGELOG/#20210127-214742","text":"Fix missing printlng and avoid errors for next time (this was causing issues in clients like vim coc)","title":"2021.01.27-21.47.42"},{"location":"CHANGELOG/#20210126-223527","text":"Fix document-symbol after #261 - Fixes #276 Reduce memory usage on startup batch analyzing classpath via clj-kondo. - Fixes #268","title":"2021.01.26-22.35.27"},{"location":"CHANGELOG/#20210125-225605","text":"Do not remove document on textDocument/didClose , related to #264. Fix default project-specs for shadow-cljs to use npx prefix. Fix range of textDocument/hover for definition usages. Fix completionItem/resolve broken after #261.","title":"2021.01.25-22.56.05"},{"location":"CHANGELOG/#20210125-172205","text":"Remove references code-lens from deftest forms Fix completion for alias ns from external deps - Fixes #269","title":"2021.01.25-17.22.05"},{"location":"CHANGELOG/#20210122-130428","text":"Huge refactor https://github.com/clojure-lsp/clojure-lsp/pull/261 which uses clj-kondo analysis / findings output to almost all clojure-lsp features. Should significantly increase performance and startup time Should fix almost all bugs/issues with windows Users since we now rely on clj-kondo analysis Remove all lint configs from clojure-lsp including macro-defs , they should be configured on clj-kondo side now via .clj-kondo/config.edn Move file path on documentation to bottom","title":"2021.01.22-13.04.28"},{"location":"CHANGELOG/#20210120-013932","text":"Fixes args for extract-function refactoring - Fixes #263","title":"2021.01.20-01.39.32"},{"location":"CHANGELOG/#20210116-032820","text":"Check for defintions when finding references with includeDeclaration as true - Fixes #260 Add custom command cursor-info to debugging clojure-lsp. Fix unnecessary new-lines on imports when executing clean-ns","title":"2021.01.16-03.28.20"},{"location":"CHANGELOG/#20210114-231554","text":"Check for the whole line to add-miising-* code actions instead of expect the cursor at the ns to be required/imported - Fixes #258 Return all possible add-missing-* code actions to the same line.","title":"2021.01.14-23.15.54"},{"location":"CHANGELOG/#20210114-171910","text":"Fix add missing import code actions after refactor","title":"2021.01.14-17.19.10"},{"location":"CHANGELOG/#20210114-124442","text":"Fixes #208","title":"2021.01.14-12.44.42"},{"location":"CHANGELOG/#20210114-023028","text":"LSP 3.16: Add support for codeAction/resolve improving performance if client supports it Bump extend lib [CI] Remove auto release, next releases should contain more than one PR/fix","title":"2021.01.14-02.30.28"},{"location":"building/","text":"Building # GraalVM # Every release, the native binaries (Windows, Linux and MacOS) are compiled with GraalVM and uploaded to Github releases page. To build a native image with GraalVM: Install the GraalVM 21 and set the GRAALVM_HOME to the installation dir. Install native-image with $GRAALVM_HOME/bin/gu install native-image . Run from clojure-lsp project root bb native-cli . The build may take some minutes and the result will be a ./clojure-lsp native binary. Debug / development # Run bb debug-cli . Jar # Editor/CLI # Run bb cli-prod-jar for building the jar to be used with LSP protocol in a editor or CLI via bb prod-cli . JVM API # Run bb lib-jar for building the jar to be used on JVM via API.","title":"Building"},{"location":"building/#building","text":"","title":"Building"},{"location":"building/#graalvm","text":"Every release, the native binaries (Windows, Linux and MacOS) are compiled with GraalVM and uploaded to Github releases page. To build a native image with GraalVM: Install the GraalVM 21 and set the GRAALVM_HOME to the installation dir. Install native-image with $GRAALVM_HOME/bin/gu install native-image . Run from clojure-lsp project root bb native-cli . The build may take some minutes and the result will be a ./clojure-lsp native binary.","title":"GraalVM"},{"location":"building/#debug-development","text":"Run bb debug-cli .","title":"Debug / development"},{"location":"building/#jar","text":"","title":"Jar"},{"location":"building/#editorcli","text":"Run bb cli-prod-jar for building the jar to be used with LSP protocol in a editor or CLI via bb prod-cli .","title":"Editor/CLI"},{"location":"building/#jvm-api","text":"Run bb lib-jar for building the jar to be used on JVM via API.","title":"JVM API"},{"location":"capabilities/","text":"Capabilities # Implementation Status # Below are all the currently supported LSP capabilities and their implementation status: capability done notes initialize \u221a initialized \u221a shutdown \u221a exit \u221a $/cancelRequest $/progress \u221a window/showDocument \u221a window/showMessage \u221a window/showMessageRequest \u221a window/logMessage window/workDoneProgress/create window/workDoneProgress/cancel telemetry/event client/registerCapability \u221a client/unregisterCapability workspace/workspaceFolders workspace/didChangeWorkspaceFolders workspace/didChangeConfiguration \u221a Currently does nothing but log workspace/configuration We use a more robust settings concept (.lsp/config.edn) workspace/didChangeWatchedFiles \u221a workspace/symbol \u221a workspace/executeCommand \u221a See Extra capabilities workspace/applyEdit \u221a TextDocumentEdit and RenameFile only workspace/willRenameFiles \u221a workspace/didRenameFiles \u221a workspace/willCreateFiles workspace/didCreateFiles workspace/willDeleteFiles workspace/didDeleteFiles textDocument/didOpen \u221a textDocument/didChange \u221a textDocument/willSave textDocument/willSaveWaitUntil textDocument/didSave \u221a Do nothing currently textDocument/didClose \u221a textDocument/publishDiagnostics \u221a textDocument/completion \u221a completionItem/resolve \u221a textDocument/hover \u221a textDocument/signatureHelp \u221a Missing support for active parameter ATM textDocument/declaration \u221a Show where the symbol was declared on the file, like alias/refer definitions textDocument/definition \u221a textDocument/typeDefinition textDocument/implementation \u221a Implementation of defprotocols/defmulti showing deftypes and defrecords textDocument/references \u221a textDocument/documentHighlight \u221a textDocument/documentSymbol \u221a textDocument/codeAction \u221a codeAction/resolve \u221a textDocument/codeLens \u221a codeLens/resolve \u221a textDocument/documentLink documentLink/resolve textDocument/documentColor textDocument/colorPresentation textDocument/formatting \u221a textDocument/rangeFormatting \u221a textDocument/onTypeFormatting textDocument/rename \u221a textDocument/prepareRename \u221a textDocument/foldingRange textDocument/selectionRange textDocument/semanticTokens/full \u221a textDocument/semanticTokens/full/delta textDocument/semanticTokens/range \u221a workspace/semanticTokens/refresh workspace/codeLens/refresh \u221a textDocument/linkedEditingRange \u221a textDocument/prepareCallHierarchy \u221a callHierarchy/incomingCalls \u221a callHierarchy/outgoingCalls \u221a textDocument/moniker Extra capabilities # Besides LSP official capabilities, clojure-lsp has some extra features: Refactorings # It should be possible to introduce most of the refactorings here More details # Calling executeCommand with the following commands and additional args will notify the client with applyEdit . All commands expect the first three args to be [document-uri, line, character] (eg [\"file:///home/snoe/file.clj\", 13, 11] ) done command args notes \u221a add-missing-import [document-uri, line, character, import-name] \u221a add-missing-libspec \u221a clean-ns \u221a cycle-coll \u221a cycle-privacy \u221a expand-let \u221a extract-function [document-uri, line, character, function-name] \u221a inline-symbol \u221a introduce-let [document-uri, line, character, binding-name] \u221a move-to-let [document-uri, line, character, binding-name] \u221a thread-first \u221a thread-first-all \u221a thread-last \u221a thread-last-all \u221a unwind-all \u221a unwind-thread \u221a resolve-macro-as [document-uri, line, character, resolved-full-symbol kondo-config-path] \u221a create-test See Vim client section for an example. Emacs provides all those refactorings via lsp-mode with the lsp-clojure- prefix. Other clients might provide a higher level interface to workspace/executeCommand you need to pass the path, line and character numbers. Custom methods # clojure-lsp has some custom LSP methods that doesn't follow the protocol but aggregate value as a clojure IDE: Test tree # Notify client with test tree data to build a UI tree on client side. Type: Server Notification Capability: experimental.testTree Method: clojure/textDocument/testTree Response: TestTreeParams TestTreeParams : {:uri string, :tree TestTreeNode} TestTreeNode : {:name string, name-range: Range, range: Range, :kind TestTreeKind, :children [TestTreeNode]} TestTreeKind : :namespace 1 | :deftest 2 | :testing 3 Project tree # Request the project tree showing project source-paths and external dependencies. If params is null request the project root nodes, otherwise request the nodes of the passed node. The project tree is lazy, so client should request the nodes of a node when user expand it manually. Type: Client request with response Capability: experimental.projectTree Method: clojure/workspace/projectTree/nodes Params: ProjectTreeNodeLeaf | null Response: ProjectTreeNodeBranch ProjectTreeNode : ProjectTreeNodeBranch | ProjectTreeNodeLeaf ProjectTreeNodeBranch : {:name string, :type ProjectTreeNodeType, :uri string?, :detail string?, :id string?, :nodes [ProjectTreeNode]} ProjectTreeNodeLeaf : {:name string, :type ProjectTreeNodeType, :id string?, :uri string?, :range Range?, :detail string?, final boolean} ProjectTreeNodeType : :project 1 | :source-path 2 | :library 3 | :jar 4 | :ns 5 | :class 6 | :function 7 | :variable 8 | :interface 9 Server Info Raw # Use to retrieve from server the server configuration information. Type: Client request with response Capability: none Method: clojure/serverInfo/raw Params: none Response: Any Server Info Log # Use to log to client the server configuration information. Type: Client request with response Capability: none Method: clojure/serverInfo/log Params: none Response: none Cursor Info Log # Use to log to client the debugging information for the symbol at cursor. Type: Client request with response Capability: none Method: clojure/cursorInfo/log Params: [uri, line, character] Response: Any Clojuredocs raw # Use to retrieve any Clojuredocs entry. Will return null if no entry found. Type: Client request with response Capability: none Method: clojure/clojuredocs/raw Params: [symbol-name, symbol-ns] Response: Any","title":"Capabilities"},{"location":"capabilities/#capabilities","text":"","title":"Capabilities"},{"location":"capabilities/#implementation-status","text":"Below are all the currently supported LSP capabilities and their implementation status: capability done notes initialize \u221a initialized \u221a shutdown \u221a exit \u221a $/cancelRequest $/progress \u221a window/showDocument \u221a window/showMessage \u221a window/showMessageRequest \u221a window/logMessage window/workDoneProgress/create window/workDoneProgress/cancel telemetry/event client/registerCapability \u221a client/unregisterCapability workspace/workspaceFolders workspace/didChangeWorkspaceFolders workspace/didChangeConfiguration \u221a Currently does nothing but log workspace/configuration We use a more robust settings concept (.lsp/config.edn) workspace/didChangeWatchedFiles \u221a workspace/symbol \u221a workspace/executeCommand \u221a See Extra capabilities workspace/applyEdit \u221a TextDocumentEdit and RenameFile only workspace/willRenameFiles \u221a workspace/didRenameFiles \u221a workspace/willCreateFiles workspace/didCreateFiles workspace/willDeleteFiles workspace/didDeleteFiles textDocument/didOpen \u221a textDocument/didChange \u221a textDocument/willSave textDocument/willSaveWaitUntil textDocument/didSave \u221a Do nothing currently textDocument/didClose \u221a textDocument/publishDiagnostics \u221a textDocument/completion \u221a completionItem/resolve \u221a textDocument/hover \u221a textDocument/signatureHelp \u221a Missing support for active parameter ATM textDocument/declaration \u221a Show where the symbol was declared on the file, like alias/refer definitions textDocument/definition \u221a textDocument/typeDefinition textDocument/implementation \u221a Implementation of defprotocols/defmulti showing deftypes and defrecords textDocument/references \u221a textDocument/documentHighlight \u221a textDocument/documentSymbol \u221a textDocument/codeAction \u221a codeAction/resolve \u221a textDocument/codeLens \u221a codeLens/resolve \u221a textDocument/documentLink documentLink/resolve textDocument/documentColor textDocument/colorPresentation textDocument/formatting \u221a textDocument/rangeFormatting \u221a textDocument/onTypeFormatting textDocument/rename \u221a textDocument/prepareRename \u221a textDocument/foldingRange textDocument/selectionRange textDocument/semanticTokens/full \u221a textDocument/semanticTokens/full/delta textDocument/semanticTokens/range \u221a workspace/semanticTokens/refresh workspace/codeLens/refresh \u221a textDocument/linkedEditingRange \u221a textDocument/prepareCallHierarchy \u221a callHierarchy/incomingCalls \u221a callHierarchy/outgoingCalls \u221a textDocument/moniker","title":"Implementation Status"},{"location":"capabilities/#extra-capabilities","text":"Besides LSP official capabilities, clojure-lsp has some extra features:","title":"Extra capabilities"},{"location":"capabilities/#refactorings","text":"It should be possible to introduce most of the refactorings here","title":"Refactorings"},{"location":"capabilities/#more-details","text":"Calling executeCommand with the following commands and additional args will notify the client with applyEdit . All commands expect the first three args to be [document-uri, line, character] (eg [\"file:///home/snoe/file.clj\", 13, 11] ) done command args notes \u221a add-missing-import [document-uri, line, character, import-name] \u221a add-missing-libspec \u221a clean-ns \u221a cycle-coll \u221a cycle-privacy \u221a expand-let \u221a extract-function [document-uri, line, character, function-name] \u221a inline-symbol \u221a introduce-let [document-uri, line, character, binding-name] \u221a move-to-let [document-uri, line, character, binding-name] \u221a thread-first \u221a thread-first-all \u221a thread-last \u221a thread-last-all \u221a unwind-all \u221a unwind-thread \u221a resolve-macro-as [document-uri, line, character, resolved-full-symbol kondo-config-path] \u221a create-test See Vim client section for an example. Emacs provides all those refactorings via lsp-mode with the lsp-clojure- prefix. Other clients might provide a higher level interface to workspace/executeCommand you need to pass the path, line and character numbers.","title":"More details"},{"location":"capabilities/#custom-methods","text":"clojure-lsp has some custom LSP methods that doesn't follow the protocol but aggregate value as a clojure IDE:","title":"Custom methods"},{"location":"capabilities/#test-tree","text":"Notify client with test tree data to build a UI tree on client side. Type: Server Notification Capability: experimental.testTree Method: clojure/textDocument/testTree Response: TestTreeParams TestTreeParams : {:uri string, :tree TestTreeNode} TestTreeNode : {:name string, name-range: Range, range: Range, :kind TestTreeKind, :children [TestTreeNode]} TestTreeKind : :namespace 1 | :deftest 2 | :testing 3","title":"Test tree"},{"location":"capabilities/#project-tree","text":"Request the project tree showing project source-paths and external dependencies. If params is null request the project root nodes, otherwise request the nodes of the passed node. The project tree is lazy, so client should request the nodes of a node when user expand it manually. Type: Client request with response Capability: experimental.projectTree Method: clojure/workspace/projectTree/nodes Params: ProjectTreeNodeLeaf | null Response: ProjectTreeNodeBranch ProjectTreeNode : ProjectTreeNodeBranch | ProjectTreeNodeLeaf ProjectTreeNodeBranch : {:name string, :type ProjectTreeNodeType, :uri string?, :detail string?, :id string?, :nodes [ProjectTreeNode]} ProjectTreeNodeLeaf : {:name string, :type ProjectTreeNodeType, :id string?, :uri string?, :range Range?, :detail string?, final boolean} ProjectTreeNodeType : :project 1 | :source-path 2 | :library 3 | :jar 4 | :ns 5 | :class 6 | :function 7 | :variable 8 | :interface 9","title":"Project tree"},{"location":"capabilities/#server-info-raw","text":"Use to retrieve from server the server configuration information. Type: Client request with response Capability: none Method: clojure/serverInfo/raw Params: none Response: Any","title":"Server Info Raw"},{"location":"capabilities/#server-info-log","text":"Use to log to client the server configuration information. Type: Client request with response Capability: none Method: clojure/serverInfo/log Params: none Response: none","title":"Server Info Log"},{"location":"capabilities/#cursor-info-log","text":"Use to log to client the debugging information for the symbol at cursor. Type: Client request with response Capability: none Method: clojure/cursorInfo/log Params: [uri, line, character] Response: Any","title":"Cursor Info Log"},{"location":"capabilities/#clojuredocs-raw","text":"Use to retrieve any Clojuredocs entry. Will return null if no entry found. Type: Client request with response Capability: none Method: clojure/clojuredocs/raw Params: [symbol-name, symbol-ns] Response: Any","title":"Clojuredocs raw"},{"location":"clients/","text":"Clients (Editors) # Clients are either editors with built in LSP support like Oni or nvim, or an appropriate plugin. Clients are responsible for launching the server, the server is a subprocess of your editor not a daemon. In general, make sure to configure the client to use stdio and a server launch command like ['/usr/local/bin/clojure-lsp'] . If that fails, you may need to have your client launch inside a shell, so use something like ['bash', '-c', '/usr/local/bin/clojure-lsp'] . In windows you probably need to use the clojure-lsp.bat . TIP : If your editor is not started from the terminal then it is possible that its $PATH is quite different from the one in the shell and clojure-lsp will not be able to find the executables it needs, such as clojure and npx . To alleviate that, create a wrapper script that sets the PATH correctly. Make sure that nothing in the script uses stdin / stdout as these are used for communication with the editor and any extra input/output could mess it up. An example script (also remember to make it executable, e.g. chmod u+x <script> ): #!/bin/bash -l if [ ! -e npx ] ; then export PATH = $PATH :/Users/me/.nvm/versions/node/v10.24.1/bin fi exec /usr/local/bin/clojure-lsp Emacs # lsp-mode has built in support for clojure-lsp . With use-package , add the following to your emacs config: ( use-package lsp-mode :ensure t :hook (( clojure-mode . lsp ) ( clojurec-mode . lsp ) ( clojurescript-mode . lsp )) :config ;; add paths to your local installation of project mgmt tools, like lein ( setenv \"PATH\" ( concat \"/usr/local/bin\" path-separator ( getenv \"PATH\" ))) ( dolist ( m ' ( clojure-mode clojurec-mode clojurescript-mode clojurex-mode )) ( add-to-list 'lsp-language-id-configuration ` ( , m . \"clojure\" ))) ( setq lsp-clojure-server-command ' ( \"/path/to/clojure-lsp\" ))) ;; Optional: In case `clojure-lsp` is not in your $PATH Optionally you can add lsp-ui for UI feedback and company-mode for completion: ( use-package lsp-ui :ensure t :commands lsp-ui-mode ) ( use-package company :ensure t ) In lsp-mode , lsp-clojure-server-command variable is available to override the command to start the clojure-lsp server, might be necessary to do this on a Windows environment. For a detailed guide on how to configure Emacs with LSP, check here For more lsp-mode clojure settings, check here Visual Studio Code # Calva is a extension for VSCode for Clojure Development that includes clojure-lsp. Vim # I prefer https://github.com/neoclide/coc.nvim but both http://github.com/autozimu/LanguageClient-neovim and https://github.com/prabirshrestha/vim-lsp work well. See my nvim/init.vim and coc-settings.json Another example of a Neovim Conjure/CoC/clojure-lsp setup can be found on dharrigan's github repository. LanguageClient-neovim can be configure with: Refactorings: function ! Expand ( exp ) abort let l :result = expand ( a :exp ) return l :result == # '' ? '' : \"file://\" . l :result endfunction nnoremap < silent > crcc : call LanguageClient#workspace_executeCommand ( 'cycle-coll' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crth : call LanguageClient#workspace_executeCommand ( 'thread-first' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtt : call LanguageClient#workspace_executeCommand ( 'thread-last' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtf : call LanguageClient#workspace_executeCommand ( 'thread-first-all' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtl : call LanguageClient#workspace_executeCommand ( 'thread-last-all' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crml : call LanguageClient#workspace_executeCommand ( 'move-to-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 , input ( 'Binding name: ' ) ] )< CR > nnoremap < silent > cril : call LanguageClient#workspace_executeCommand ( 'introduce-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 , input ( 'Binding name: ' ) ] )< CR > nnoremap < silent > crel : call LanguageClient#workspace_executeCommand ( 'expand-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > cram : call LanguageClient#workspace_executeCommand ( 'add-missing-libspec' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > initializationOptions can be sent by setting: let g:LanguageClient_settingsPath=\".lsp/settings.json\" Project-local .lsp/settings.json would have content like: { \"initializationOptions\" : { \"source-paths\" : [ \"shared-src\" , \"src\" , \"test\" , \"dashboard/src\" ] , \"macro-defs\" : { \"project.macros/dofor\" : [ \"bindings\" , \"bound-elements\" ]}}} Further refactoring mappings include being able to invoke the (coc-codeaction-*) function to provide actions such as move to let , change coll to map and so on. nmap <silent> <Leader>cr <Plug>(coc-rename) nmap <silent> <Leader>cf <Plug>(coc-references) xmap <silent> <Leader>c <Plug>(coc-codeaction-selected) nmap <silent> <Leader>c <Plug>(coc-codeaction-line) nmap <silent> gd <Plug>(coc-definition) Nvim # An very detailed document about how configure Nvim as Clojure IDE using fennel, clojure-lsp and conjure. nvim-fennel-lsp-conjure-as-clojure-ide Intellij # clojure-lsp-intellij (recommended) # The clojure-lsp-intellij is a free open source Intellij plugin that has clojure-lsp built-in and has exclusive support from clojure-lsp maintainers with features that other generic LSP plugins does not support. Generic lsp4intellij # Install the LSP Support plugin and configure it to launch clojure-lsp for Clojure/Script files: Go to Preferences / Languages & Frameworks / Language Server Protocol / Server Definitions. Select Raw command . In the Extension field enter clj;cljs;cljc;edn . In the Command field enter the path to the executable, for instance /usr/local/bin/clojure-lsp . BEWARE: The LSP Support plugin has short timeouts and will kill clojure-lsp silently if it exceeds the limit. It is highly recommended that you increase the Init timeout from 10000 (10s) to e.g. 300000 (5 min). The first scan can easily take over a minute on a bigger project. See Preferences / Languages & Frameworks / Language Server Protocol / Timeouts. If the plugin's icon in the status bar (a circle) turns red, it means starting clojure-lsp failed. Click on it and select Show timeouts - any limits that were exceeded will be in red. Sublime Text # Clojure LSP can be installed by first installing the LSP plugin which brings Language Server Protocol support to Sublime Text editor and then following the set-up instructions here to download Clojure LSP and how to configure it in Sublime Text. Oni # Seems to work reasonably well but couldn't get rename to work reliably https://github.com/onivim/oni Atom # I tried making a client but my hello world attempt didn't seem to work. If someone wants to take this on, I'd be willing to package it here too.","title":"Clients (Editors)"},{"location":"clients/#clients-editors","text":"Clients are either editors with built in LSP support like Oni or nvim, or an appropriate plugin. Clients are responsible for launching the server, the server is a subprocess of your editor not a daemon. In general, make sure to configure the client to use stdio and a server launch command like ['/usr/local/bin/clojure-lsp'] . If that fails, you may need to have your client launch inside a shell, so use something like ['bash', '-c', '/usr/local/bin/clojure-lsp'] . In windows you probably need to use the clojure-lsp.bat . TIP : If your editor is not started from the terminal then it is possible that its $PATH is quite different from the one in the shell and clojure-lsp will not be able to find the executables it needs, such as clojure and npx . To alleviate that, create a wrapper script that sets the PATH correctly. Make sure that nothing in the script uses stdin / stdout as these are used for communication with the editor and any extra input/output could mess it up. An example script (also remember to make it executable, e.g. chmod u+x <script> ): #!/bin/bash -l if [ ! -e npx ] ; then export PATH = $PATH :/Users/me/.nvm/versions/node/v10.24.1/bin fi exec /usr/local/bin/clojure-lsp","title":"Clients (Editors)"},{"location":"clients/#emacs","text":"lsp-mode has built in support for clojure-lsp . With use-package , add the following to your emacs config: ( use-package lsp-mode :ensure t :hook (( clojure-mode . lsp ) ( clojurec-mode . lsp ) ( clojurescript-mode . lsp )) :config ;; add paths to your local installation of project mgmt tools, like lein ( setenv \"PATH\" ( concat \"/usr/local/bin\" path-separator ( getenv \"PATH\" ))) ( dolist ( m ' ( clojure-mode clojurec-mode clojurescript-mode clojurex-mode )) ( add-to-list 'lsp-language-id-configuration ` ( , m . \"clojure\" ))) ( setq lsp-clojure-server-command ' ( \"/path/to/clojure-lsp\" ))) ;; Optional: In case `clojure-lsp` is not in your $PATH Optionally you can add lsp-ui for UI feedback and company-mode for completion: ( use-package lsp-ui :ensure t :commands lsp-ui-mode ) ( use-package company :ensure t ) In lsp-mode , lsp-clojure-server-command variable is available to override the command to start the clojure-lsp server, might be necessary to do this on a Windows environment. For a detailed guide on how to configure Emacs with LSP, check here For more lsp-mode clojure settings, check here","title":"Emacs"},{"location":"clients/#visual-studio-code","text":"Calva is a extension for VSCode for Clojure Development that includes clojure-lsp.","title":"Visual Studio Code"},{"location":"clients/#vim","text":"I prefer https://github.com/neoclide/coc.nvim but both http://github.com/autozimu/LanguageClient-neovim and https://github.com/prabirshrestha/vim-lsp work well. See my nvim/init.vim and coc-settings.json Another example of a Neovim Conjure/CoC/clojure-lsp setup can be found on dharrigan's github repository. LanguageClient-neovim can be configure with: Refactorings: function ! Expand ( exp ) abort let l :result = expand ( a :exp ) return l :result == # '' ? '' : \"file://\" . l :result endfunction nnoremap < silent > crcc : call LanguageClient#workspace_executeCommand ( 'cycle-coll' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crth : call LanguageClient#workspace_executeCommand ( 'thread-first' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtt : call LanguageClient#workspace_executeCommand ( 'thread-last' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtf : call LanguageClient#workspace_executeCommand ( 'thread-first-all' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crtl : call LanguageClient#workspace_executeCommand ( 'thread-last-all' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > crml : call LanguageClient#workspace_executeCommand ( 'move-to-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 , input ( 'Binding name: ' ) ] )< CR > nnoremap < silent > cril : call LanguageClient#workspace_executeCommand ( 'introduce-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 , input ( 'Binding name: ' ) ] )< CR > nnoremap < silent > crel : call LanguageClient#workspace_executeCommand ( 'expand-let' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > nnoremap < silent > cram : call LanguageClient#workspace_executeCommand ( 'add-missing-libspec' , [Expand ( '%:p' ), line ( '.' ) - 1 , col ( '.' ) - 1 ] )< CR > initializationOptions can be sent by setting: let g:LanguageClient_settingsPath=\".lsp/settings.json\" Project-local .lsp/settings.json would have content like: { \"initializationOptions\" : { \"source-paths\" : [ \"shared-src\" , \"src\" , \"test\" , \"dashboard/src\" ] , \"macro-defs\" : { \"project.macros/dofor\" : [ \"bindings\" , \"bound-elements\" ]}}} Further refactoring mappings include being able to invoke the (coc-codeaction-*) function to provide actions such as move to let , change coll to map and so on. nmap <silent> <Leader>cr <Plug>(coc-rename) nmap <silent> <Leader>cf <Plug>(coc-references) xmap <silent> <Leader>c <Plug>(coc-codeaction-selected) nmap <silent> <Leader>c <Plug>(coc-codeaction-line) nmap <silent> gd <Plug>(coc-definition)","title":"Vim"},{"location":"clients/#nvim","text":"An very detailed document about how configure Nvim as Clojure IDE using fennel, clojure-lsp and conjure. nvim-fennel-lsp-conjure-as-clojure-ide","title":"Nvim"},{"location":"clients/#intellij","text":"","title":"Intellij"},{"location":"clients/#clojure-lsp-intellij-recommended","text":"The clojure-lsp-intellij is a free open source Intellij plugin that has clojure-lsp built-in and has exclusive support from clojure-lsp maintainers with features that other generic LSP plugins does not support.","title":"clojure-lsp-intellij (recommended)"},{"location":"clients/#generic-lsp4intellij","text":"Install the LSP Support plugin and configure it to launch clojure-lsp for Clojure/Script files: Go to Preferences / Languages & Frameworks / Language Server Protocol / Server Definitions. Select Raw command . In the Extension field enter clj;cljs;cljc;edn . In the Command field enter the path to the executable, for instance /usr/local/bin/clojure-lsp . BEWARE: The LSP Support plugin has short timeouts and will kill clojure-lsp silently if it exceeds the limit. It is highly recommended that you increase the Init timeout from 10000 (10s) to e.g. 300000 (5 min). The first scan can easily take over a minute on a bigger project. See Preferences / Languages & Frameworks / Language Server Protocol / Timeouts. If the plugin's icon in the status bar (a circle) turns red, it means starting clojure-lsp failed. Click on it and select Show timeouts - any limits that were exceeded will be in red.","title":"Generic lsp4intellij"},{"location":"clients/#sublime-text","text":"Clojure LSP can be installed by first installing the LSP plugin which brings Language Server Protocol support to Sublime Text editor and then following the set-up instructions here to download Clojure LSP and how to configure it in Sublime Text.","title":"Sublime Text"},{"location":"clients/#oni","text":"Seems to work reasonably well but couldn't get rename to work reliably https://github.com/onivim/oni","title":"Oni"},{"location":"clients/#atom","text":"I tried making a client but my hello world attempt didn't seem to work. If someone wants to take this on, I'd be willing to package it here too.","title":"Atom"},{"location":"development/","text":"clojure-lsp Development # There are several ways of finding and fixing a bug or implementing a new feature: The Clojure Way Create a test for your bug/feature, then implement the code following the test (TDD). Build clojure-lsp[.bat] using bb debug-cli each time you have made changes, and test it manually in your client. This is the slowest option. Whichever development path you choose: For final testing, it is good to rebuild the binary with bb debug-cli . There are two custom LSP methods clojure/serverInfo/log and clojure/cursorInfo/log . They can assist in debugging. The Clojure Way # With a clojure-lsp + nREPL powered Clojure editor you can modify your editor session's clojure-lsp server using the Clojure REPL. Here's demo video: https://www.youtube.com/watch?v=4UvT0yqBDw8 These are the steps: bb debug-cli - to build a clojure-lsp[.bat] executable that includes cider-nrepl in the jar. This executable will be saved at the root of the project. Configure your editor to use this clojure-lsp[.bat] executable Have your editor restart its clojure-lsp server Issue the clojure-lsp serverInfo command Find the port entry in the output Connect your editors nREPL client to this port Hack away! Seeing is believing. An easy way to convince yourself that you can actually change clojure-lsp mid-flight is to: Modify the server-info function in src/clojure_lsp/handlers.clj Say, you add a :foo :bar entry to the map returned Evaluate the new server-info function definition Issue the clojure-lsp serverInfo command Find :foo :bar in the output You have just modified the LSP server powering your editor while it was running! This is the Clojure way. No recompiling and restarting and reloading. That is some other, non-Clojure, way. The details in how to perform these steps can vary a bit between the various Clojure editors/plugins. Visual Studio Code with Calva # This project comes with Calva configuration to use the clojure-lsp[.bat] executable built in step 1 above. You can skip step 2, unless are running on MS-Widnows, in which case you should update the setting in .vscode/settings.json to add the .bat extension, i.e. \"calva.clojureLspPath\": \"./clojure-lsp.bat\" . To restart the clojure-lsp server, use the VS Code command Developer: Reload Window The Hack away! step needs to start with you issuing the command Calva: Load Current File and Dependencies . Emacs with CIDER # To configure Emacs to use the nREPL-enabled executable, run (setq lsp-clojure-custom-server-command '(\"~/path/to/clojure-lsp/clojure-lsp\")) , adjusting the path as necessary. If you add this to your Emacs config, you can skip this step in the future. To restart the clojure-lsp server, execute the Emacs command lsp-workspace-restart . To find the server info, execute lsp-clojure-server-info . To connect the nREPL client, run cider-connect-clj , with \"localhost\" and the port. If you re-connect regulary, you may want to add this Emacs shortcut: ( defun lsp-clojure-nrepl-connect () \"Connect to the running nrepl debug server of clojure-lsp.\" ( interactive ) ( let (( info ( lsp-clojure-server-info-raw ))) ( save-match-data ( when-let ( port ( and ( string-match \"\\\"port\\\":\\\\([0-9]+\\\\)\" info ) ( match-string 1 info ))) ( cider-connect-clj ` ( :host \"localhost\" :port , port )))))) Vim with coc.nvim and Fireplace # Change coc-settings.json ( :CocConfig ) clojure-lsp: {command: \"~/path/to/clojure-lsp/clojure-lsp\"} , adjusting the past as necessary. To restart the clojure-lsp server use :CocRestart To find the server info, :echo CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['port'] To find the server log, :echo CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['log-path'] To connect the nREPL client, run :Connect <port> If you re-connect regulary, you may want to add something like this to your vimrc: \" Copies the log-path to your clipboard nnoremap <silent> crsl :call setreg('*', CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['log-path'])<CR> \" Connects to nrepl nnoremap <silent> crsp :execute 'Connect' CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['port']<CR> Neovim with Conjure # Change the lsp config cmd to \"~/path/to/clojure-lsp/clojure-lsp\", adjusting the path as necessary. To restart the LSP: To stop the clojure-lsp server, use :lua vim.lsp.stop_client(vim.lsp.get_active_clients()) To start the clojure-lsp server, use :edit To find the server info or the log file, use :lua clients = vim.lsp.get_active_clients() for k, client_data in ipairs(clients) do id = client_data.id end client = vim.lsp.get_client_by_id(id) result = client.request_sync(\"clojure/serverInfo/raw\", {}, 5000, 15) print('port = ' .. result.result.port) print('log-path = ' .. result.result['log-path']) To connect the nREPL client, run :ConjureConnect <port> Your Favorite Editor # TBD. PR welcome. Debugging & Profiling # The nREPL includes tools for debugging and profiling clojure-lsp. See cli/dev/clojure_lsp/debug.clj . If you're interested in using the profiling tools in that file, you'll need to be familiar with criterium and clj-async-profiler . Note that the performance of clojure-lsp is highly dependent on the size of its db. If you load a repl with -A:build , you'll have access to the debugging tools, but the db will be nearly empty. Follow the [steps][#the-clojure-way] above to connect to an nREPL which has a populated db. Testing # Run bb tasks for a list of available dev tasks. The codebase consists of the lib/ library and the cli/ program which depends on it. bb test-lib , bb test-cli , and bb test (for both of the above). cli/ produces a standalone .jar file that can be converted to a self contained clojure-lsp[.bat] script or a clojure-lsp[.exe] binary executable file. bb prod-jar -> cli\\ standalone jar, bb prod-cli -> executable script with embedded cli/ jar, bb debug-cli -> same as prod-cli but includes support for cider-nrepl and clj-async-profile , and bb native-cli -> binary executable produced with graalvm . There are also cli/ integration tests. They require ./clojure[.bat|.exe] to have already been built with one of the above cli tasks (__NOTE:__always ensure that you rebuild the cli/ executable every time you make changes to lib/ or cli/ source code so tha the integration tests use an up to date executable). bb integration-tests The same development version can be used to lint all of the source code. bb lint Writing tests # A test should be able to run on all JDK versions in scope starting with 1.8 and across GNU/Linux , macos and MS-Windows operating systems. The test author should be aware of the following important differences between *nix and windows: Line endings On *nix: the single Line Feed (LF) char, i.e. \\n . On windows: the Carriage Return (CR) followed by the LF char (CRLF), i.e. \\r\\n . Paths On *nix: Use / as the path separator, absolute paths start with / . On windows: use \\ as the path separator, absolute paths start either with a drive letter followed by :\\ , i.e. [A-Za-Z]:\\ (e.g. c:\\temp and D:\\src ) or with a double \\\\ indicating a network path (e.g. \\\\computer39\\temp ). Below are a few hints to assist with writing test that work accross the different platforms. Line Endings When comparing strings, Use clojure-lsp.test-helper/string= with \\n in your expected result. e.g. use (is (h/strings= \"one\\n\" result) instead of (is (= \"one\\r\\n\" result)) or (is (= \"one\\n\" result)) . Use h/str-includes? with \\n in the string to search for instead of clojure.string/includes? . e.g. (is (h/str-includes? (slurp \"path\") \"something\\n\")) instead of (is (str/includes? (slurp \"path\") \"something\\n\")) or (is (str/includes? (slurp \"path\") \"something\\r\\n\")) . Paths Always use babashka.fs/canonicalize when converting a relative path to an absolute path. Avoiding using any of java File/Path absolute or canonical equivalent fns. This ensures that the drive letter on windows is always in capitals (e.g. D:\\ instead of d:\\ ). This is also the convention used throughout the codebase and it works as well with both existing and non-existing files. Use clojure-lsp.test-helper/file-path , clojure-lsp.test-helper/file->uri with *nix paths. They are converted to the format expected by the OS. e.g. (load-code (h/file-path \"/aaa.clj\") \"(ns aaa)\") instead of (load-code \"/aaa.clj\" \"(ns aaa)\") or (load-code \"c:\\\\aaa.clj\" \"(ns aaa)\")","title":"Development"},{"location":"development/#clojure-lsp-development","text":"There are several ways of finding and fixing a bug or implementing a new feature: The Clojure Way Create a test for your bug/feature, then implement the code following the test (TDD). Build clojure-lsp[.bat] using bb debug-cli each time you have made changes, and test it manually in your client. This is the slowest option. Whichever development path you choose: For final testing, it is good to rebuild the binary with bb debug-cli . There are two custom LSP methods clojure/serverInfo/log and clojure/cursorInfo/log . They can assist in debugging.","title":"clojure-lsp Development"},{"location":"development/#the-clojure-way","text":"With a clojure-lsp + nREPL powered Clojure editor you can modify your editor session's clojure-lsp server using the Clojure REPL. Here's demo video: https://www.youtube.com/watch?v=4UvT0yqBDw8 These are the steps: bb debug-cli - to build a clojure-lsp[.bat] executable that includes cider-nrepl in the jar. This executable will be saved at the root of the project. Configure your editor to use this clojure-lsp[.bat] executable Have your editor restart its clojure-lsp server Issue the clojure-lsp serverInfo command Find the port entry in the output Connect your editors nREPL client to this port Hack away! Seeing is believing. An easy way to convince yourself that you can actually change clojure-lsp mid-flight is to: Modify the server-info function in src/clojure_lsp/handlers.clj Say, you add a :foo :bar entry to the map returned Evaluate the new server-info function definition Issue the clojure-lsp serverInfo command Find :foo :bar in the output You have just modified the LSP server powering your editor while it was running! This is the Clojure way. No recompiling and restarting and reloading. That is some other, non-Clojure, way. The details in how to perform these steps can vary a bit between the various Clojure editors/plugins.","title":"The Clojure Way"},{"location":"development/#visual-studio-code-with-calva","text":"This project comes with Calva configuration to use the clojure-lsp[.bat] executable built in step 1 above. You can skip step 2, unless are running on MS-Widnows, in which case you should update the setting in .vscode/settings.json to add the .bat extension, i.e. \"calva.clojureLspPath\": \"./clojure-lsp.bat\" . To restart the clojure-lsp server, use the VS Code command Developer: Reload Window The Hack away! step needs to start with you issuing the command Calva: Load Current File and Dependencies .","title":"Visual Studio Code with Calva"},{"location":"development/#emacs-with-cider","text":"To configure Emacs to use the nREPL-enabled executable, run (setq lsp-clojure-custom-server-command '(\"~/path/to/clojure-lsp/clojure-lsp\")) , adjusting the path as necessary. If you add this to your Emacs config, you can skip this step in the future. To restart the clojure-lsp server, execute the Emacs command lsp-workspace-restart . To find the server info, execute lsp-clojure-server-info . To connect the nREPL client, run cider-connect-clj , with \"localhost\" and the port. If you re-connect regulary, you may want to add this Emacs shortcut: ( defun lsp-clojure-nrepl-connect () \"Connect to the running nrepl debug server of clojure-lsp.\" ( interactive ) ( let (( info ( lsp-clojure-server-info-raw ))) ( save-match-data ( when-let ( port ( and ( string-match \"\\\"port\\\":\\\\([0-9]+\\\\)\" info ) ( match-string 1 info ))) ( cider-connect-clj ` ( :host \"localhost\" :port , port ))))))","title":"Emacs with CIDER"},{"location":"development/#vim-with-cocnvim-and-fireplace","text":"Change coc-settings.json ( :CocConfig ) clojure-lsp: {command: \"~/path/to/clojure-lsp/clojure-lsp\"} , adjusting the past as necessary. To restart the clojure-lsp server use :CocRestart To find the server info, :echo CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['port'] To find the server log, :echo CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['log-path'] To connect the nREPL client, run :Connect <port> If you re-connect regulary, you may want to add something like this to your vimrc: \" Copies the log-path to your clipboard nnoremap <silent> crsl :call setreg('*', CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['log-path'])<CR> \" Connects to nrepl nnoremap <silent> crsp :execute 'Connect' CocRequest('clojure-lsp', 'clojure/serverInfo/raw')['port']<CR>","title":"Vim with coc.nvim and Fireplace"},{"location":"development/#neovim-with-conjure","text":"Change the lsp config cmd to \"~/path/to/clojure-lsp/clojure-lsp\", adjusting the path as necessary. To restart the LSP: To stop the clojure-lsp server, use :lua vim.lsp.stop_client(vim.lsp.get_active_clients()) To start the clojure-lsp server, use :edit To find the server info or the log file, use :lua clients = vim.lsp.get_active_clients() for k, client_data in ipairs(clients) do id = client_data.id end client = vim.lsp.get_client_by_id(id) result = client.request_sync(\"clojure/serverInfo/raw\", {}, 5000, 15) print('port = ' .. result.result.port) print('log-path = ' .. result.result['log-path']) To connect the nREPL client, run :ConjureConnect <port>","title":"Neovim with Conjure"},{"location":"development/#your-favorite-editor","text":"TBD. PR welcome.","title":"Your Favorite Editor"},{"location":"development/#debugging-profiling","text":"The nREPL includes tools for debugging and profiling clojure-lsp. See cli/dev/clojure_lsp/debug.clj . If you're interested in using the profiling tools in that file, you'll need to be familiar with criterium and clj-async-profiler . Note that the performance of clojure-lsp is highly dependent on the size of its db. If you load a repl with -A:build , you'll have access to the debugging tools, but the db will be nearly empty. Follow the [steps][#the-clojure-way] above to connect to an nREPL which has a populated db.","title":"Debugging &amp; Profiling"},{"location":"development/#testing","text":"Run bb tasks for a list of available dev tasks. The codebase consists of the lib/ library and the cli/ program which depends on it. bb test-lib , bb test-cli , and bb test (for both of the above). cli/ produces a standalone .jar file that can be converted to a self contained clojure-lsp[.bat] script or a clojure-lsp[.exe] binary executable file. bb prod-jar -> cli\\ standalone jar, bb prod-cli -> executable script with embedded cli/ jar, bb debug-cli -> same as prod-cli but includes support for cider-nrepl and clj-async-profile , and bb native-cli -> binary executable produced with graalvm . There are also cli/ integration tests. They require ./clojure[.bat|.exe] to have already been built with one of the above cli tasks (__NOTE:__always ensure that you rebuild the cli/ executable every time you make changes to lib/ or cli/ source code so tha the integration tests use an up to date executable). bb integration-tests The same development version can be used to lint all of the source code. bb lint","title":"Testing"},{"location":"development/#writing-tests","text":"A test should be able to run on all JDK versions in scope starting with 1.8 and across GNU/Linux , macos and MS-Windows operating systems. The test author should be aware of the following important differences between *nix and windows: Line endings On *nix: the single Line Feed (LF) char, i.e. \\n . On windows: the Carriage Return (CR) followed by the LF char (CRLF), i.e. \\r\\n . Paths On *nix: Use / as the path separator, absolute paths start with / . On windows: use \\ as the path separator, absolute paths start either with a drive letter followed by :\\ , i.e. [A-Za-Z]:\\ (e.g. c:\\temp and D:\\src ) or with a double \\\\ indicating a network path (e.g. \\\\computer39\\temp ). Below are a few hints to assist with writing test that work accross the different platforms. Line Endings When comparing strings, Use clojure-lsp.test-helper/string= with \\n in your expected result. e.g. use (is (h/strings= \"one\\n\" result) instead of (is (= \"one\\r\\n\" result)) or (is (= \"one\\n\" result)) . Use h/str-includes? with \\n in the string to search for instead of clojure.string/includes? . e.g. (is (h/str-includes? (slurp \"path\") \"something\\n\")) instead of (is (str/includes? (slurp \"path\") \"something\\n\")) or (is (str/includes? (slurp \"path\") \"something\\r\\n\")) . Paths Always use babashka.fs/canonicalize when converting a relative path to an absolute path. Avoiding using any of java File/Path absolute or canonical equivalent fns. This ensures that the drive letter on windows is always in capitals (e.g. D:\\ instead of d:\\ ). This is also the convention used throughout the codebase and it works as well with both existing and non-existing files. Use clojure-lsp.test-helper/file-path , clojure-lsp.test-helper/file->uri with *nix paths. They are converted to the format expected by the OS. e.g. (load-code (h/file-path \"/aaa.clj\") \"(ns aaa)\") instead of (load-code \"/aaa.clj\" \"(ns aaa)\") or (load-code \"c:\\\\aaa.clj\" \"(ns aaa)\")","title":"Writing tests"},{"location":"features/","text":"Features # Below you can find all available features that clojure-lsp provides with examples using Emacs lsp-mode as the client. Built in LSP features clojure-lsp extra commands LSP features # Find a function/var definition # Find defprotocol/defmulti implementations # Find a function/var declaration in the ns # Find all references of a function, var, keyword or namespace alias # Show all workspace/project symbols # Show all symbols on current file # Rename symbols # Also, it's possible to live rename symbols on the same buffer with linkedEditingRange feature. Document highlight on hover showing symbol usages # Documentation and clojuredocs integration # Java support # To understand what is supported and how to configure it, check the settings section . Completion # Snippets # Snippets are templates that make it easier to enter repeating code patterns, such as common functions/forms, they are available during completion. Tabstops are defined as $number with $0 as last tabstop. Check all available snippets here name description raw content comment Insert comment block (comment\\n ${0:body}\\n ) comment-heading Insert comment Header ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n;; ${1:Namespace summary title}\\n;;\\n;; ${2:Brief description}\\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n\\n$0 comment-separator Insert comment separator ;; ${1:Namespace summary title}\\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n\\n$0 rich-comment Insert rich comment (comment $0 #_()) rich-comment-rdd Insert rich comment rdd block #_{:clj-kondo/ignore [:redefined-var]}\\n(comment\\n $0 #_()) rich-comment-hotload Insert rich comment library hotload #_{:clj-kondo/ignore [:redefined-var]}\\n(comment\\n ;; Add-lib library for hot-loading\\n (require '[clojure.tools.deps.alpha.repl :refer [add-libs]])\\n (add-libs '{${1:domain/library-name} {:mvn/version \\\"${2:1.0.0}\\\"}$3})\\n $0\\n) condp Insert condp (condp ${1:pred} ${2:expr}\\n $0) def Insert def (def ${1:name} $0) def- Insert def private (def ^:private ${1:name} $0) def-doc Insert def with docstring (def ${1:name}\\n \\\"${2:docstring}\\\"\\n $0) defmethod Insert defmethod (defmethod ${1:name} ${2:match}\\n [${3:args}]\\n $0) defmulti Insert defmulti (defmulti ${1:name} ${2:dispatch-fn}) defn Insert public defn (defn ${1:name} [$2]\\n $0) defn-doc Insert public defn with docstring (defn ${1:name}\\n \\\"${2:docstring}\\\"\\n [${3:args}]\\n $0) defn- Insert private defn (defn%s ${1:name} [$2]\\n $0) defprotocol Insert defprotocol (defprotocol ${1:Name}\\n $0) defrecord Insert defrecord (defrecord ${1:Name} [${2:fields}]\\n ${3:Protocol}\\n $0) deftype Insert deftype (deftype ${1:Name} [${2:fields}]\\n ${3:Protocol}\\n $0) fn Insert fn (fn [${1:arg-list}] $0) for Insert for (for [${1:item} ${2:coll}]\\n $0) if Insert if (if ${1:test-expr}\\n ${2:then-expr}\\n ${3:else-expr}) kwargs Insert keyword args {:keys [${1:keys}] :or {${2:defaults}}} let Insert let (let [$0]) letfn Insert letfn (letfn [(${1:name} [${2:args}]\\n $0)]) ns Insert ns (ns ${1:name}\\n $0:references}) ns-doc Insert ns with docstring (ns ${1:name}\\n \\\"${2:docstring}\\\"\\n ${0:references}) require Insert ns :require (:require [${1:namespace}])$0 require-as Insert ns require with :as alias (:require [${1:namespace} :as ${2:alias}]$3) require-refer Insert ns :require with :refer (:require [${1:namespace} :refer [$2]]$3) require-rdd Insert require for rich comment experiments (require '[${1:namespace} :as ${2:alias}]$3)$0 req-as Insert single require dep :as alias [${1:namespace} :as ${2:alias}] req-refer Insert single require dep with :refer [${1:namespace} :refer [$2]] import Insert import (:import [${1:package}]) use Insert require refer preferred over use (:require [${1:namespace} :refer [$2]]) deps-alias Insert alias with extra path & deps :${1:category/name}\\n {:extra-paths [\\\"${2:path}\\\"]\\n :extra-deps {${3:deps-maven or deps-git}}}$0 deps-maven Insert maven dependency ${1:domain/library-name} {:mvn/version \\\"${2:1.0.0}\\\"}$0 deps-git Insert git dependency ${1:domain/library-name}\\n {:git/sha \\\"${2:git-sha-value}\\\"}$0 deps-git-tag Insert git tag dependency ${1:domain/library-name}\\n {:git/tag \\\"${2:git-tag-value}\\\"\\n :git/sha \\\"${3:git-sha-value}\\\"}$0 deps-git-url Insert git URL dependency ${1:domain/library-name}\\n {:git/url \\\"https://github.com/$1\\\"\\n :git/sha \\\"${2:git-sha-value}\\\"}$0 deps-local Insert local dependency ${1:domain/library-name} {:local/root \\\"${2:/path/to/project/root}\\\"}$0 deftest Insert deftest clojure.test (deftest ${1:name}-test\\n (testing \\\"${2:Context of the test assertions}\\\"\\n (is (= ${3:assertion-values}))$4)) $0 testing Insert testing clojure.test (testing \\\"${1:Context of the test assertions}\\\"\\n $0) is Insert is clojure.test (is (= ${1:assertion-values})) Custom snippets # User can register additional custom snippets. For more information, check the snippets config documentation . Code actions # See below for screenshots. Code lenses showing symbol references # Format a whole file or range # Signature help # Semantic tokens # The LSP server is the best to say what is the semantic value of a token on the editor, semantic tokens allows server return to client all tokens of a buffer and how client show apply highlight. Note: server return the semantic token (e.g. function ) and the client/editor apply the color that matches the user's theme. Call hierarchy # Show the incoming or outgoing call hierarchy of a function/variable as a lazy tree Incoming # Show functions that call the current one recursively Outgoing # Show functions that the current one call, recursively Test Tree # Show the tests tree hierarchy of a file Project tree # Show the project tree ns and external dependencies. Diagnostics (linter) # All linters besides the ones below come from clj-kondo that clojure-lsp calls under the hood to lint the code and retrieve the analysis to make most of features work. Every linter configuration should be done on clj-kondo side, so anything related to unresolved symbols or unknown macros are probably related to wrong clj-kondo for the project. For more information on how to configure clj-kondo check here . Below you can find the custom linters implemented on clojure-lsp side that uses the :custom-lint-fn from clj-kondo: clojure-lsp/unused-public-var # For more information on how to configure it, check the diagnostics settings section . clojure-lsp/different-aliases # For more information on how to configure it, check the diagnostics settings section . clj-depend # Clojure-lsp has a optional integration with clj-depend , making it easier to configure namespaces relationship. For more information on how to configure it, check the diagnostics settings section . Stub generation # It's possible to configure clojure-lsp to generate and analyze stubs for specific namespaces available on your project classpath, this is useful for closed source dependencies like datomic.api , with that clojure-lsp will be able to make most features work with those dependencies. For more information check the stubs settings section . Execute command # Commands that client can request. Most code actions use these commands as actions. Note: Most of these are available via code actions and clients or users may choose to use the code action menu to execute them instead of mapping. All functions in clojure-lsp have a two-letter mnemonic shortcut. E.g. tf for thread-first-all . We strongly suggest that client authors and users use these shortcuts keys when choosing to map these commands to key chords or menus; this allows for users to maintain muscle memory and familiarity as they switch between clients and editors. Thank you to clj-refactor for this system and other tools that adhere to it. LSP clients will allow you to bind these commands to shortcuts or menu items using LSP's workspace/executeCommand and passing a map with \"command\" and \"arguments\" keys. Arguments: - file-uri : Absolute file uri. e.x. file:///home/user/project/src/main.clj - row : line-number of the cursor, 0 based. - col : col-number of the cursor, 0 based. - name : Used when introducing a name, usually a string for a valid clojure symbol. - filename : Filename path. e.x. src/utils.clj Shortcut Command Name Arguments Available via code action Example ab drag-param-backward Drag param backward [file-uri,row,col] \u2705 af drag-param-forward Drag param forward [file-uri,row,col] \u2705 ai add-missing-import Add import to namespace [file-uri,row,col[,name]] \u2705 am add-missing-libspec Add missing require [file-uri,row,col] \u2705 as add-require-suggestion Add require suggestion [file-uri,row,col,ns,alias,refer] \u2705 cc cycle-coll Cycle collection (#{}, {}, [], ()) [file-uri,row,col] \u2705 ck cycle-keyword-auto-resolve Cycle keyword auto-resolve [file-uri,row,col] \u2705 cn clean-ns Clean namespace [file-uri,row,col] \u2705 cp cycle-privacy Cycle privacy of def/defn [file-uri,row,col] \u2705 ct create-test Create test [file-uri,row,col] \u2705 df demote-fn Demote fn to #() [file-uri,row,col] \u2705 db drag-backward Drag backward [file-uri,row,col] \u2705 df drag-forward Drag forward [file-uri,row,col] \u2705 dk destructure-keys Destructure keys [file-uri,row,col] \u2705 ed extract-to-def Extract to def [file-uri,row,col,name] \u2705 ef extract-function Extract function [file-uri,row,col,name] \u2705 el expand-let Expand let [file-uri,row,col] fe create-function Create function from example [file-uri,row,col] \u2705 ga get-in-all Move all expressions to get/get-in [file-uri,row,col] \u2705 gl get-in-less Remove one element from get/get-in [file-uri,row,col] \u2705 gm get-in-more Move another expression to get/get-in [file-uri,row,col] \u2705 gn get-in-none Unwind whole get/get-in [file-uri,row,col] \u2705 il introduce-let Introduce let [file-uri,row,col,name] is inline-symbol Inline Symbol [file-uri,row,col] \u2705 ma resolve-macro-as Resolve macro as [file-uri,row,col] \u2705 mf move-form Move form [file-uri,row,col,filename] \u2705 ml move-to-let Move expression to let [file-uri,row,col,name] \u2705 pf promote-fn Promote #() to fn, or fn to defn [file-uri,row,col,fn-name] \u2705 rr replace-refer-all-with-refer Replace ':refer :all' with ':refer [...]' [file-uri,row,col,refers] \u2705 ra replace-refer-all-with-alias Replace ':refer :all' with alias [file-uri,row,col] \u2705 rk restructure-keys Restructure keys [file-uri,row,col] \u2705 sc change-coll Switch collection to {}, (), #{}, [] [file-uri,row,col,\"map\"/\"list\"/\"set\"/\"vector\"] \u2705 sl sort-clauses Sort map/vector/list/set/clauses [file-uri,row,col] \u2705 tf thread-first-all Thread first all [file-uri,row,col] \u2705 th thread-first Thread first expression [file-uri,row,col] tl thread-last-all Thread last all [file-uri,row,col] \u2705 tt thread-last Thread last expression [file-uri,row,col] ua unwind-all Unwind whole thread [file-uri,row,col] \u2705 uw unwind-thread Unwind thread once [file-uri,row,col] fs forward-slurp Paredit: forward slurp [file-uri,row,col] fb forward-barf Paredit: forward barf [file-uri,row,col] bs backward-slurp Paredit: backward slurp [file-uri,row,col] bb backward-barf Paredit: backward barf [file-uri,row,col] rs raise-sexp Paredit: Raise sexp [file-uri,row,col] ks kill-sexp Paredit: Kill sexp [file-uri,row,col] gt go-to-test Go to test [file-uri,row,col] \u2705 Dev # Server information # Return basic information about the server. Cursor information # Return debug information about the element at point.","title":"Features"},{"location":"features/#features","text":"Below you can find all available features that clojure-lsp provides with examples using Emacs lsp-mode as the client. Built in LSP features clojure-lsp extra commands","title":"Features"},{"location":"features/#lsp-features","text":"","title":"LSP features"},{"location":"features/#find-a-functionvar-definition","text":"","title":"Find a function/var definition"},{"location":"features/#find-defprotocoldefmulti-implementations","text":"","title":"Find defprotocol/defmulti implementations"},{"location":"features/#find-a-functionvar-declaration-in-the-ns","text":"","title":"Find a function/var declaration in the ns"},{"location":"features/#find-all-references-of-a-function-var-keyword-or-namespace-alias","text":"","title":"Find all references of a function, var, keyword or namespace alias"},{"location":"features/#show-all-workspaceproject-symbols","text":"","title":"Show all workspace/project symbols"},{"location":"features/#show-all-symbols-on-current-file","text":"","title":"Show all symbols on current file"},{"location":"features/#rename-symbols","text":"Also, it's possible to live rename symbols on the same buffer with linkedEditingRange feature.","title":"Rename symbols"},{"location":"features/#document-highlight-on-hover-showing-symbol-usages","text":"","title":"Document highlight on hover showing symbol usages"},{"location":"features/#documentation-and-clojuredocs-integration","text":"","title":"Documentation and clojuredocs integration"},{"location":"features/#java-support","text":"To understand what is supported and how to configure it, check the settings section .","title":"Java support"},{"location":"features/#completion","text":"","title":"Completion"},{"location":"features/#snippets","text":"Snippets are templates that make it easier to enter repeating code patterns, such as common functions/forms, they are available during completion. Tabstops are defined as $number with $0 as last tabstop. Check all available snippets here name description raw content comment Insert comment block (comment\\n ${0:body}\\n ) comment-heading Insert comment Header ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n;; ${1:Namespace summary title}\\n;;\\n;; ${2:Brief description}\\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n\\n$0 comment-separator Insert comment separator ;; ${1:Namespace summary title}\\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\\n\\n$0 rich-comment Insert rich comment (comment $0 #_()) rich-comment-rdd Insert rich comment rdd block #_{:clj-kondo/ignore [:redefined-var]}\\n(comment\\n $0 #_()) rich-comment-hotload Insert rich comment library hotload #_{:clj-kondo/ignore [:redefined-var]}\\n(comment\\n ;; Add-lib library for hot-loading\\n (require '[clojure.tools.deps.alpha.repl :refer [add-libs]])\\n (add-libs '{${1:domain/library-name} {:mvn/version \\\"${2:1.0.0}\\\"}$3})\\n $0\\n) condp Insert condp (condp ${1:pred} ${2:expr}\\n $0) def Insert def (def ${1:name} $0) def- Insert def private (def ^:private ${1:name} $0) def-doc Insert def with docstring (def ${1:name}\\n \\\"${2:docstring}\\\"\\n $0) defmethod Insert defmethod (defmethod ${1:name} ${2:match}\\n [${3:args}]\\n $0) defmulti Insert defmulti (defmulti ${1:name} ${2:dispatch-fn}) defn Insert public defn (defn ${1:name} [$2]\\n $0) defn-doc Insert public defn with docstring (defn ${1:name}\\n \\\"${2:docstring}\\\"\\n [${3:args}]\\n $0) defn- Insert private defn (defn%s ${1:name} [$2]\\n $0) defprotocol Insert defprotocol (defprotocol ${1:Name}\\n $0) defrecord Insert defrecord (defrecord ${1:Name} [${2:fields}]\\n ${3:Protocol}\\n $0) deftype Insert deftype (deftype ${1:Name} [${2:fields}]\\n ${3:Protocol}\\n $0) fn Insert fn (fn [${1:arg-list}] $0) for Insert for (for [${1:item} ${2:coll}]\\n $0) if Insert if (if ${1:test-expr}\\n ${2:then-expr}\\n ${3:else-expr}) kwargs Insert keyword args {:keys [${1:keys}] :or {${2:defaults}}} let Insert let (let [$0]) letfn Insert letfn (letfn [(${1:name} [${2:args}]\\n $0)]) ns Insert ns (ns ${1:name}\\n $0:references}) ns-doc Insert ns with docstring (ns ${1:name}\\n \\\"${2:docstring}\\\"\\n ${0:references}) require Insert ns :require (:require [${1:namespace}])$0 require-as Insert ns require with :as alias (:require [${1:namespace} :as ${2:alias}]$3) require-refer Insert ns :require with :refer (:require [${1:namespace} :refer [$2]]$3) require-rdd Insert require for rich comment experiments (require '[${1:namespace} :as ${2:alias}]$3)$0 req-as Insert single require dep :as alias [${1:namespace} :as ${2:alias}] req-refer Insert single require dep with :refer [${1:namespace} :refer [$2]] import Insert import (:import [${1:package}]) use Insert require refer preferred over use (:require [${1:namespace} :refer [$2]]) deps-alias Insert alias with extra path & deps :${1:category/name}\\n {:extra-paths [\\\"${2:path}\\\"]\\n :extra-deps {${3:deps-maven or deps-git}}}$0 deps-maven Insert maven dependency ${1:domain/library-name} {:mvn/version \\\"${2:1.0.0}\\\"}$0 deps-git Insert git dependency ${1:domain/library-name}\\n {:git/sha \\\"${2:git-sha-value}\\\"}$0 deps-git-tag Insert git tag dependency ${1:domain/library-name}\\n {:git/tag \\\"${2:git-tag-value}\\\"\\n :git/sha \\\"${3:git-sha-value}\\\"}$0 deps-git-url Insert git URL dependency ${1:domain/library-name}\\n {:git/url \\\"https://github.com/$1\\\"\\n :git/sha \\\"${2:git-sha-value}\\\"}$0 deps-local Insert local dependency ${1:domain/library-name} {:local/root \\\"${2:/path/to/project/root}\\\"}$0 deftest Insert deftest clojure.test (deftest ${1:name}-test\\n (testing \\\"${2:Context of the test assertions}\\\"\\n (is (= ${3:assertion-values}))$4)) $0 testing Insert testing clojure.test (testing \\\"${1:Context of the test assertions}\\\"\\n $0) is Insert is clojure.test (is (= ${1:assertion-values}))","title":"Snippets"},{"location":"features/#custom-snippets","text":"User can register additional custom snippets. For more information, check the snippets config documentation .","title":"Custom snippets"},{"location":"features/#code-actions","text":"See below for screenshots.","title":"Code actions"},{"location":"features/#code-lenses-showing-symbol-references","text":"","title":"Code lenses showing symbol references"},{"location":"features/#format-a-whole-file-or-range","text":"","title":"Format a whole file or range"},{"location":"features/#signature-help","text":"","title":"Signature help"},{"location":"features/#semantic-tokens","text":"The LSP server is the best to say what is the semantic value of a token on the editor, semantic tokens allows server return to client all tokens of a buffer and how client show apply highlight. Note: server return the semantic token (e.g. function ) and the client/editor apply the color that matches the user's theme.","title":"Semantic tokens"},{"location":"features/#call-hierarchy","text":"Show the incoming or outgoing call hierarchy of a function/variable as a lazy tree","title":"Call hierarchy"},{"location":"features/#incoming","text":"Show functions that call the current one recursively","title":"Incoming"},{"location":"features/#outgoing","text":"Show functions that the current one call, recursively","title":"Outgoing"},{"location":"features/#test-tree","text":"Show the tests tree hierarchy of a file","title":"Test Tree"},{"location":"features/#project-tree","text":"Show the project tree ns and external dependencies.","title":"Project tree"},{"location":"features/#diagnostics-linter","text":"All linters besides the ones below come from clj-kondo that clojure-lsp calls under the hood to lint the code and retrieve the analysis to make most of features work. Every linter configuration should be done on clj-kondo side, so anything related to unresolved symbols or unknown macros are probably related to wrong clj-kondo for the project. For more information on how to configure clj-kondo check here . Below you can find the custom linters implemented on clojure-lsp side that uses the :custom-lint-fn from clj-kondo:","title":"Diagnostics (linter)"},{"location":"features/#clojure-lspunused-public-var","text":"For more information on how to configure it, check the diagnostics settings section .","title":"clojure-lsp/unused-public-var"},{"location":"features/#clojure-lspdifferent-aliases","text":"For more information on how to configure it, check the diagnostics settings section .","title":"clojure-lsp/different-aliases"},{"location":"features/#clj-depend","text":"Clojure-lsp has a optional integration with clj-depend , making it easier to configure namespaces relationship. For more information on how to configure it, check the diagnostics settings section .","title":"clj-depend"},{"location":"features/#stub-generation","text":"It's possible to configure clojure-lsp to generate and analyze stubs for specific namespaces available on your project classpath, this is useful for closed source dependencies like datomic.api , with that clojure-lsp will be able to make most features work with those dependencies. For more information check the stubs settings section .","title":"Stub generation"},{"location":"features/#execute-command","text":"Commands that client can request. Most code actions use these commands as actions. Note: Most of these are available via code actions and clients or users may choose to use the code action menu to execute them instead of mapping. All functions in clojure-lsp have a two-letter mnemonic shortcut. E.g. tf for thread-first-all . We strongly suggest that client authors and users use these shortcuts keys when choosing to map these commands to key chords or menus; this allows for users to maintain muscle memory and familiarity as they switch between clients and editors. Thank you to clj-refactor for this system and other tools that adhere to it. LSP clients will allow you to bind these commands to shortcuts or menu items using LSP's workspace/executeCommand and passing a map with \"command\" and \"arguments\" keys. Arguments: - file-uri : Absolute file uri. e.x. file:///home/user/project/src/main.clj - row : line-number of the cursor, 0 based. - col : col-number of the cursor, 0 based. - name : Used when introducing a name, usually a string for a valid clojure symbol. - filename : Filename path. e.x. src/utils.clj Shortcut Command Name Arguments Available via code action Example ab drag-param-backward Drag param backward [file-uri,row,col] \u2705 af drag-param-forward Drag param forward [file-uri,row,col] \u2705 ai add-missing-import Add import to namespace [file-uri,row,col[,name]] \u2705 am add-missing-libspec Add missing require [file-uri,row,col] \u2705 as add-require-suggestion Add require suggestion [file-uri,row,col,ns,alias,refer] \u2705 cc cycle-coll Cycle collection (#{}, {}, [], ()) [file-uri,row,col] \u2705 ck cycle-keyword-auto-resolve Cycle keyword auto-resolve [file-uri,row,col] \u2705 cn clean-ns Clean namespace [file-uri,row,col] \u2705 cp cycle-privacy Cycle privacy of def/defn [file-uri,row,col] \u2705 ct create-test Create test [file-uri,row,col] \u2705 df demote-fn Demote fn to #() [file-uri,row,col] \u2705 db drag-backward Drag backward [file-uri,row,col] \u2705 df drag-forward Drag forward [file-uri,row,col] \u2705 dk destructure-keys Destructure keys [file-uri,row,col] \u2705 ed extract-to-def Extract to def [file-uri,row,col,name] \u2705 ef extract-function Extract function [file-uri,row,col,name] \u2705 el expand-let Expand let [file-uri,row,col] fe create-function Create function from example [file-uri,row,col] \u2705 ga get-in-all Move all expressions to get/get-in [file-uri,row,col] \u2705 gl get-in-less Remove one element from get/get-in [file-uri,row,col] \u2705 gm get-in-more Move another expression to get/get-in [file-uri,row,col] \u2705 gn get-in-none Unwind whole get/get-in [file-uri,row,col] \u2705 il introduce-let Introduce let [file-uri,row,col,name] is inline-symbol Inline Symbol [file-uri,row,col] \u2705 ma resolve-macro-as Resolve macro as [file-uri,row,col] \u2705 mf move-form Move form [file-uri,row,col,filename] \u2705 ml move-to-let Move expression to let [file-uri,row,col,name] \u2705 pf promote-fn Promote #() to fn, or fn to defn [file-uri,row,col,fn-name] \u2705 rr replace-refer-all-with-refer Replace ':refer :all' with ':refer [...]' [file-uri,row,col,refers] \u2705 ra replace-refer-all-with-alias Replace ':refer :all' with alias [file-uri,row,col] \u2705 rk restructure-keys Restructure keys [file-uri,row,col] \u2705 sc change-coll Switch collection to {}, (), #{}, [] [file-uri,row,col,\"map\"/\"list\"/\"set\"/\"vector\"] \u2705 sl sort-clauses Sort map/vector/list/set/clauses [file-uri,row,col] \u2705 tf thread-first-all Thread first all [file-uri,row,col] \u2705 th thread-first Thread first expression [file-uri,row,col] tl thread-last-all Thread last all [file-uri,row,col] \u2705 tt thread-last Thread last expression [file-uri,row,col] ua unwind-all Unwind whole thread [file-uri,row,col] \u2705 uw unwind-thread Unwind thread once [file-uri,row,col] fs forward-slurp Paredit: forward slurp [file-uri,row,col] fb forward-barf Paredit: forward barf [file-uri,row,col] bs backward-slurp Paredit: backward slurp [file-uri,row,col] bb backward-barf Paredit: backward barf [file-uri,row,col] rs raise-sexp Paredit: Raise sexp [file-uri,row,col] ks kill-sexp Paredit: Kill sexp [file-uri,row,col] gt go-to-test Go to test [file-uri,row,col] \u2705","title":"Execute command"},{"location":"features/#dev","text":"","title":"Dev"},{"location":"features/#server-information","text":"Return basic information about the server.","title":"Server information"},{"location":"features/#cursor-information","text":"Return debug information about the element at point.","title":"Cursor information"},{"location":"installation/","text":"Installation # Below are all available clojure-lsp installation methods, after installed, follow the documentation for your editor's language client. See Clients . Homebrew (MacOS and Linux) # We have a custom tap using the native compiled binaries for users that use homebrew: brew remove clojure-lsp # if you have old clojure-lsp installed via brew brew install clojure-lsp/brew/clojure-lsp-native Script # Stable release: sudo bash < < ( curl -s https://raw.githubusercontent.com/clojure-lsp/clojure-lsp/master/install ) nightly build: curl -O https://raw.githubusercontent.com/clojure-lsp/clojure-lsp/master/install chmod a+x install sudo ./install --version nightly Nix # clojure-lsp is available in the nixpkgs : nix-shell -p clojure-lsp or if using flakes: nix run github:clojure-lsp/clojure-lsp # or nix shell github:clojure-lsp/clojure-lsp or consume the flake overlay: inputs . clojure-lsp . url = \"github:clojure-lsp/clojure-lsp\" ; nixpkgs . overlays = [ inputs . clojure-lsp . overlays . default ]; Arch Linux # clojure-lsp is available in the Arch User Repository . It can be installed using your favorite AUR helper such as yay , yaourt , apacman and pacaur . Here is an example using yay : yay -S clojure-lsp-bin Windows # clojure-lsp is available as a native executable in the Clojure Scoop bucket . You need to install Scoop if you don't have it already. Issue following command to download the clojure-lsp executable. scoop install clojure-lsp Native binary (recommended) # clojure-lsp builds using GraalVM a native executable for each OS: Linux, MacOS and Windows. Manually # The binaries are available on Github releases as clojure-lsp-native-<os>-<arch>.zip , after downloading you just need to unzip it. Embedded jar (Legacy executable) # In Github releases you will find a clojure-lsp file that runs a embedded jar. This should be removed soon, use GraalVM binaries instead. You need java on your $PATH. Grab the latest clojure-lsp from github LATEST Place it in your $PATH with a chmod 755","title":"Installation"},{"location":"installation/#installation","text":"Below are all available clojure-lsp installation methods, after installed, follow the documentation for your editor's language client. See Clients .","title":"Installation"},{"location":"installation/#homebrew-macos-and-linux","text":"We have a custom tap using the native compiled binaries for users that use homebrew: brew remove clojure-lsp # if you have old clojure-lsp installed via brew brew install clojure-lsp/brew/clojure-lsp-native","title":"Homebrew (MacOS and Linux)"},{"location":"installation/#script","text":"Stable release: sudo bash < < ( curl -s https://raw.githubusercontent.com/clojure-lsp/clojure-lsp/master/install ) nightly build: curl -O https://raw.githubusercontent.com/clojure-lsp/clojure-lsp/master/install chmod a+x install sudo ./install --version nightly","title":"Script"},{"location":"installation/#nix","text":"clojure-lsp is available in the nixpkgs : nix-shell -p clojure-lsp or if using flakes: nix run github:clojure-lsp/clojure-lsp # or nix shell github:clojure-lsp/clojure-lsp or consume the flake overlay: inputs . clojure-lsp . url = \"github:clojure-lsp/clojure-lsp\" ; nixpkgs . overlays = [ inputs . clojure-lsp . overlays . default ];","title":"Nix"},{"location":"installation/#arch-linux","text":"clojure-lsp is available in the Arch User Repository . It can be installed using your favorite AUR helper such as yay , yaourt , apacman and pacaur . Here is an example using yay : yay -S clojure-lsp-bin","title":"Arch Linux"},{"location":"installation/#windows","text":"clojure-lsp is available as a native executable in the Clojure Scoop bucket . You need to install Scoop if you don't have it already. Issue following command to download the clojure-lsp executable. scoop install clojure-lsp","title":"Windows"},{"location":"installation/#native-binary-recommended","text":"clojure-lsp builds using GraalVM a native executable for each OS: Linux, MacOS and Windows.","title":"Native binary (recommended)"},{"location":"installation/#manually","text":"The binaries are available on Github releases as clojure-lsp-native-<os>-<arch>.zip , after downloading you just need to unzip it.","title":"Manually"},{"location":"installation/#embedded-jar-legacy-executable","text":"In Github releases you will find a clojure-lsp file that runs a embedded jar. This should be removed soon, use GraalVM binaries instead. You need java on your $PATH. Grab the latest clojure-lsp from github LATEST Place it in your $PATH with a chmod 755","title":"Embedded jar (Legacy executable)"},{"location":"settings/","text":"Settings # clojure-lsp settings are picked up only on server start (but they can be changed on runtime) and can be configured in 4 ways: Project configuration Global configuration LSP InitializationOptions Classpath config paths Project # clojure-lsp will look for project specific settings in a file called .lsp/config.edn . It will search from your project root folder up the directory structure so you can have multiple projects share the same settings. Example: { :cljfmt { :indents { # re \".*\" ns [[ :inner 0 ] [ :inner 1 ]]}} :auto-add-ns-to-new-files? false } Global # For global settings which should work for all the projects using clojure-lsp , you just need to add the same configs to ~/.config/clojure-lsp/config.edn or $XDG_CONFIG_HOME/clojure-lsp/config.edn . Note: ~/.lsp/config.edn is considered too but deprecated. For an example of a global config.edn , check here . InitializationOptions # This is specific for a client, which it sends to clojure-lsp on startup, check LSP spec for more information . This is useful if you are changing a default for a client/editor that will affect all users of that editor. This is an example how Emacs lsp-mode pass custom information. Another example, for neovim users, using coc.nvim and coc-clojure can be found here If you are using a client which defines InitializationOptions as a json object, you can use json types instead: keyword -> string or colon-prefixed string ( \"incremental\" or \":incremental\" ) map -> object ( {\"unused-public-ns\": {\"level\": \"info\"}} ) set -> array ( [\"src\" \"test\"] ) vector -> array ( [\"src\" \"test\"] ) Classpath config paths # When starting the server, clojure-lsp will search for a specific path clojure-lsp.exports/<group-id>/<artifact-id>/config.edn for extra configurations in the classpath, only if you set the setting :classpath-config-paths containing that group/artifact . Example: Lib my-org/my-lib could have a clojure-lsp config edn that makes sense for the usages of that lib, making available on the classpath: my-lib/resources/clojure-lsp.exports/my-org/my-lib/config.edn { :cljfmt { :indents { foo [[ :block 0 ]]}}} and then if your project use/has the my-org/my-lib inside your classpath, you could add the setting your-project/.lsp/config.edn { :classpath-config-paths [ \"my-org/my-lib\" ]} And then clojure-lsp will merge the configuration from the lib with the other configurations from your project. This is useful if you have some rule to apply to clojure-lsp for multiple projects, mostly using via API for linting for example, and want to move the common configuration to some place instead of adding to each project that needs that. All settings # You can find all settings and its default values here and below the docs for each one: name description default :clean Settings related to clean-ns refactoring. Check Clean settings below. :additional-snippets Additional user snippets to be available during completing, check the snippets section below [] :add-missing :add-to-rcf Missing requires and imports will be added to the top of the comment form for code actions and completions from within a comment form, can be :ask , :never or :always . :ask :api :exit-on-errors? Whether to exit the clojure-lsp process during api/cli call if any error is found, like classpath scan failure true :auto-add-ns-to-new-files? Whether to automatically add the ns form in new blank files. true :cache-path Where to store the project's analysis cache, used to speed up next clojure-lsp startup. A path relative to project root or an absolute path. .lsp/.cache :classpath-config-paths List of extra configurations to load from classpath, for more info, check Classpath config paths section. [] :cljfmt-config-path Where to find cljfmt configuration for formatting. A path relative to project root or an absolute path. Use #re for regex inside the cljfmt configuration file. .cljfmt.edn :cljfmt If no :cljfmt-config-path is provided, used this for formatting, json encoded configuration for cljfmt {} :code-lens :segregate-test-references Segregate main references from test references with option to disable true :completion :analysis-type The type for analysis to be performed during the completion, accepted values are fast-but-stale which won't wait for remaining analysis to complete to process the completion and slow-but-accurate which will wait for any changes on document to then process the completion items. :fast-but-stale :completion :additional-edits-warning-text A warning to show when the completion will perform additional edits, such as requiring a new alias. Appears in the completion items' documentation. nil :copy-kondo-configs? Whether to copy clj-kondo hooks configs exported by libs on classpath during startup lint. true :dependency-scheme Defines the format that the client and server should use for URLs of dependencies in jars. The two valid values are \"jar\" and \"zipfile\" . Different editors may handle these URLs differently. For example, in nvim when a \"zipfile\" URI is opened, the file will be editable, but \"jar\" URIs will not be. (This can be powerful, but if you edit a jar in your .m2 directory, you may break other projects.) \"jar\" will make urls compatible with java's JarURLConnection. Clients that can't extract the jar natively can make an LSP extension request of clojure/dependencyContents with the jar uri and the server will return the jar entry's contents, an approach used by some Java clients \"zipfile\" :document-formatting? if true or not present, document formatting is provided. true :document-range-formatting? if true or not present, document range formatting is provided. true :hover :arity-on-same-line? Whether to keep the arity on the same line of the function on hover, useful for Emacs users. false :hover :clojuredocs Whether to get clojuredocs information on hover, the clojuredocs content is cached. true :hover :hide-file-location? Whether to show the full filename and path on hover. false :source-paths-ignore-regex list of regex to filter source-paths. By default, source-paths are retrieved from classpath, and usually the classpath contains folders that are not directly project code or it's auto-generated like cljs resources or target folders but it's inside your project. Replace old :ignore-classpath-directories setting. [\"target.*\"] :paths-ignore-regex list of regex to filter paths to be analyzed. Useful for excluding huge files or folders that may affect final analysis size and performance, like huge edn files. [] :java :download-jdk-source? Whether to download JDK source from :java :jdk-source-download-uri and cache after startup for JDK classes java support. false :java :home-path Whether to use this path to find JDK source and cache after startup for JDK classes java support. nil :java :jdk-source-uri URI containing the JDK source to be used. If :download-jdk-source? is enabled and URI is NOT file:// then download the source. Check https://github.com/clojure-lsp/jdk-source for more sources. https://raw.githubusercontent.com/clojure-lsp/jdk-source/main/openjdk-19/reduced/source.zip :java :decompile-jar-as-project? Whether to decompile the whole jar as a java project when finding the definition of a java class, useful to navigate to other classes from that java class. true :keep-parens-when-threading? Whether to keep parenthesis when threading single arity functions. false :lint-project-files-after-startup? Whether to async lint all project only files after startup to make features like List project errors work. true :diagnostics :range-type which range use for diagnostics, :full makes the range be the whole affected diagnostic while :simple makes the range be the first character of the diagnostic. :full :linters clojure-lsp custom linters, check the diagnostics settings section below :log-path A absolute path to a file where clojure-lsp should log. A JVM tmp path, usually /tmp/clojure-lsp.*.out :notify-references-on-file-change Whether to update diagnostics of the changed references when editing files, avoiding outdated diagnostics in other files. true :project-specs A vector of a map with :project-path and :classpath-cmd , defining how clojure-lsp should find your project classpath. The :project-path should be a file and the :classpath-cmd the command to run to get the classpath Check Classpath scan section below :semantic-tokens? Whether to enable LSP semantic tokens server support for syntax highlighting. true :source-aliases Used for deps.edn or project.clj projects, the aliases which clojure-lsp should get the source-paths besides the root level :paths and :extra-paths . Check the Source paths discovery section below. #{:dev :test} :source-paths project-local directories to look for clj/cljc/cljs files, if using deps.edn , project.clj or bb.edn , use :source-aliases instead. #{\"src\" \"test\"} :stubs Stub generation related settings, check the Stub generation section below. :text-document-sync-kind The sync kind during document changes, if client should send whole buffer or just related changes. Should be :full or :incremental :full :use-metadata-for-privacy? Whether to use ^:private metadata for refactorings instead of defn- false :analysis :keywords :definitions Whether to enable keyword definitions analysis for performance. true :analysis :keywords :usages Whether to enable keyword usages analysis for performance. true :analysis :java :class-definitions Whether to enable java class definitions analysis for performance. true :analysis :java :member-definitions Whether to enable java member definitions analysis for performance. true :analysis :symbols Whether to enable symbols analysis for performance. true Classpath scan # clojure-lsp needs to analyze the whole project and its dependencies to understand your code for most features, during the startup clojure-lsp will try to find the classpath of your project to pass to clj-kondo later. You can configure how clojure-lsp should find the classpath with the project-specs setting, but keep in mind that usually the default is enough, it will also consider the :source-aliases setting if any to find the classpath using those aliases. Supported project types at the moment are: leiningen : If a project.clj is found at the project root, clojure-lsp will run lein classpath with :source-aliases specified if any. deps : If a deps.edn is found at the project root, clojure-lsp will run clojure -Spath with :source-aliases specified if any. boot : If a build.boot is found at the project root, clojure-lsp will run boot show --fake-classpath . shadow-cljs : If a shadow-cljs.edn is found at the project root, clojure-lsp will run npx shadow-cljs classpath . babashka : If a bb.edn is found at the project root, clojure-lsp will run bb print-deps --format classpath . Note that it's possible to have more than one project type at the same time e.g. deps + babashka, clojure-lsp will merge the classpath and everything should work fine. Make sure to have these programs available on the PATH environment variable used by your editor, otherwise clojure-lsp will warn about a classpath scan fail, causing a lot of features to not work properly. Alternatively, you can configure the project-specs specific for your project, for example: .lsp/config.edn { :project-specs [{ :project-path \"deps.edn\" :env { \"PATH\" \"/some/custom/path\" } ;; optional if you want to override the PATH used in the classpath-cmd :classpath-cmd [ \"clojure\" \"-A:my-custom-alias\" \"-Spath\" ]}]} Note that clojure-lsp will make this scan to save the cache when: The project has no cache ( .lsp/.cache ) The project deps file ( project.clj for example) changed. The clj-kondo config has changed. Diagnostics (linter) # Default: Check :linters in all-available-settings.edn . clj-kondo # clojure-lsp uses clj-kondo under the hood to lint the code and retrieve the analysis to make most of features work, you don't have to install clj-kondo to make it work. clojure-lsp will use a specific clj-kondo version that can be retrieved via clojure-lsp --version , but make sure you have it properly configured in your .clj-kondo/config.edn file. It has the possible key/values: :clj-kondo :level with available values: :off , :on with default value of :on :report-duplicates which will show all linters of the same symbol instead of showing only the first spot. Available values: true , false with default value of true ns-exclude-regex which will exclude the diagnostics/findings for namespaces that match this regex. Example: .lsp/config.edn { :linters { :clj-kondo { :level :on :report-duplicates true :ns-exclude-regex \"some-ns.*\" }}} Note for vim users If you are a (neo)vim user and have [ale](https://github.com/dense-analysis/ale) installed as a plugin, you **should not** have this configured as a linter `let g:ale_linters = {'clojure': ['clj-kondo']}` in your vimrc. Having this linter enabled via `ale` will only conflict with the built-in clj-kondo bundled with clojure-lsp. Also, clojure-lsp by default pass copy-configs flag as true to clj-kondo to copy configurations exported from libs on classpath, to disable this behavior, set copy-kondo-configs? setting to false. For more information about all clj-kondo available configurations, check the clj-kondo configuration section Custom clj-kondo linters # Clojure-lsp register custom linters in clj-kondo, for specifically those linters, configurations should be done on clj-kondo config files, e.g. ( <project>/.clj-kondo/config.edn ). Note that configuring these custom linters via clj-kondo's ns metadata config is not supported. Below are the custom linters used: clojure-lsp/unused-public-var # A custom linter that reports public functions/vars not used over the project. It has the possible key/values: :level with available values: :info , :warning , :error or :off with default value of :info . :exclude a whole namespace with #{my-ns} or a specific var #{my-ns/foo} . :exclude-regex same as above but with support for regex, like #{\"my-ns/f.*\"} . :exclude-when-defined-by excludes this linter when your var is defined by a macro for example, like #{my-ns/deftest} . :exclude-when-defined-by-regex same as above but with support for regex, like #{\"my-ns/.*\"} . :exclude-when-contains-meta excludes this linter when your var has any of these metas, like #{:my-meta} . :ignore-test-references? whether to ignore test references of a var-definition when considering if the var is unused. Useful to check functions that have tests but are not being used in the source code. Default: false . Example: .clj-kondo/config.edn { :linters { :clojure-lsp/unused-public-var { :level :warning :exclude # { my-ns/foo my-ns/bar other-ns my-func } :exclude-regex # { \"my-integration-tests.*\" } :exclude-when-defined-by # { my-ns/defflow } :exclude-when-defined-by-regex # { \"my.custom/macro-.*\" } :exclude-when-contains-meta # { :my-cool-meta } :ignore-test-references? true }}} clojure-lsp/different-aliases # Sometimes, it's desirable to use the same alias across namespaces to enhance readability and reduce cognitive load. It has the possible keys/values: :level with available values: :info , :warning , :error or :off with default value of :off . :exclude-aliases ignores the symbols provided in a set, example #{sut} clj-depend # clojure-lsp uses clj-depend when any clj-depend config is found either on clojure-lsp config or as a .clj-depend/config.edn file. The clj-depend config should be within the :config key. { :config { :layers { :controller { :defined-by \".*\\\\.controller\\\\..*\" :accesses-layers # { :logic }} :logic { :defined-by \".*\\\\.logic\\\\..*\" :accesses-layers # { :model }}}}} When you need to inform some other parameter for clj-depend that is not a config, you can inform it this way: { :config { ,,, } :snapshot? true } Disable linter # It's not recommended to disable a linter as it provides helpful smart checks/suggestions for your code, even so it's possible via the following config: .lsp/config.edn { :linters { :clj-kondo { :level :off } :clj-depend { :level :off }}} For information on how to troubleshoot the linter, check the troubleshooting section Source paths discovery # Some features require know the available source paths of your project, where your code lives, clojure-lsp has some settings for that. By default, clojure-lsp will infer source-paths from the classpath, excluding files that are jar and not under project-root, this usually works for most cases, if not, check next items. You can specify a source-aliases setting, making clojure-lsp use those alias when conmputing the classpath, e.g. #{:src :test :my-alias} If that is not enough, for example you have source-paths that are not included on any project profile (not recommended), you can manually specify via the :source-paths settings. e.g [\"src\" \"test\" \"my/other/folder\"] . Clean # Default: Check :clean in all-available-settings.edn . automatically-after-ns-refactor # Whether to call clean-ns on the namespace after applying any refactor to it like adding missing require/imports/refers. ns-inner-blocks-indentation # How to indent ns children forms like require,import. next-line # Keep first child on the next line of :require / :import and next children following the same indentation. Recommended by how-to-ns guide too. Check ;; better on Clojure Style Guide . same-line # Keep first child on the same line of :require / :import and next children following the same indentation. Check ;; good on Clojure Style Guide . keep # Don't change indentation at all, keeping the one user selected first. ns-import-classes-indentation # How to indent classes inside package imports from :import form. Note: package imports with only one class will keep indentation: Ex: [java.io File] next-line # Keep the first class inside a package import on the next line and next children following the same indentation. Ex: ( :import [ java.io File Foo ]) same-line # Keep the first class inside a package import on the same line and next children following the same indentation. Ex: ( :import [ java.io File Foo ]) Also, check :sort :import-classes below for more customizations. sort # to disable a specific sort you can set it to nil, example: { :clean { :sort { :import-classes nil }}} ns # Whether to enable sort of ns children like require, import forms following Clojure Style Guide . require # Whether to enable sort of :require form. true to sort according to the Clojure Style Guide, :lexicographically to do a lexicographic sort that places unwrapped namespaces last. import # Whether to enable sort of :import form. import-classes # Whether to enable sort of package classes inside :import form. :classes-per-line : the max classes allowed to keep in a single line, if more than this value, clojure-lsp will move all classes to :next-line or :same-line following :ns-import-classes-indentation , Possivel values: any positive number or -1 to keep all classes in the same line. refer # Whether to enable sort of :refer form. :max-line-length : the max refers to keep at same line before breaking the line. Default 80 . Snippets # Besides the 19 built-in snippets, it's possible to configure custom additional snippets via :additional-snippets setting: :name the name to use while completing to reach that snippet. :detail Custom text to show along with the completion name. :snippet The body of the snippet, besides any text it can contains: $1 , $2 , ... as the tabstops representing each place where user may change the content. $0 as the last tabstop. $current-form to replace the current form in the snippet. Example: { :additional-snippets [{ :name \"wrap-let-sexpr\" :detail \"Wrap current sexpr in let\" :snippet \"(let [$1] $0$current-form)\" }]} when completion is called on the code below with the cursor as | wrap| ( + 1 2 ) It should return a completion item that after applied should result in: ( let [ | ] ( + 1 2 )) Java support # At the moment, clojure-lsp only supports find definition of java classes and completion of fields/methods when it detects a Java class (mostly from static classes usages), other features are not supported yet. When a find-definition of a java class is triggered, clojure-lsp checks the following: If the java source( .java ) is available on classpath, clojure-lsp just return that file location. If the java source is not available, only the .class , clojure-lsp decompiles it. If :java :decompile-jar-as-project? is enabled, clojure-lsp decompiles the whole jar at the global cache folder ( ~/.cache/clojure-lsp/java ) If :java :decompile-jar-as-project? is disabled, clojure-lsp decompiles the class file at the local cache folder ( .lsp/.cache/java ) If the java class is from JDK (e.g. java.util.UUID ), clojure-lsp tries a few things to be able to sucessfully find the definition, following this waterfall decision: Most JRE installations contains the java source code in a src.zip , clojure-lsp tries to find it via :java :home-path setting if provided, JAVA_HOME env var or java command on PATH , if found clojure-lsp extracts to its global cache dir ($XDG_CACHE or ~/.cache/clojure-lsp ) to be used in other projects. If src.zip is not found or user specified a custom :java :jdk-source-uri , clojure-lsp tries to download the source from that uri, only if :java :download-jdk-source? is enabled, disabled by default, extracting to the global cache dir later. Stub generation # It's possible to configure clojure-lsp to generate and analyze stubs for specific namespaces available on your project classpath, this is useful for closed source dependencies like datomic.api , with that clojure-lsp will be able to make most features work with those dependencies. The available settings inside :stubs are: :generation for auto stubs generation: :namespaces the namespaces to generate and analyze stubs, empty by default disabling stub generation. :output-dir the output where to generate the stubs, by default .lsp/.cache/stubs :java-command the path to java command to spawn the stub process, default use java from $PATH . :extra-dirs , dirs to analyze to consider as part of manual generated stubs. Empty by default. Example: { :stubs { :generation { :namespaces # { \"datomic.api\" }}}} This should generate stubs for datomic.api namespace only on .lsp/.cache/stubs and clojure-lsp should analyze that during startup to provide completion, hover and other features. Or to use manual generated stubs: { :stubs { :extra-dirs [ \".my-stubs\" ]}} clojure-lsp will generate no stubs with that, but analyze that folder and consider it as manual generated stubs. Changing settings # clojure-lsp supports workspace/didChangeConfiguration commands to change the server settings while it is running, everything inside the :settings map can be changed, but not outside it (the project root for example).","title":"Settings"},{"location":"settings/#settings","text":"clojure-lsp settings are picked up only on server start (but they can be changed on runtime) and can be configured in 4 ways: Project configuration Global configuration LSP InitializationOptions Classpath config paths","title":"Settings"},{"location":"settings/#project","text":"clojure-lsp will look for project specific settings in a file called .lsp/config.edn . It will search from your project root folder up the directory structure so you can have multiple projects share the same settings. Example: { :cljfmt { :indents { # re \".*\" ns [[ :inner 0 ] [ :inner 1 ]]}} :auto-add-ns-to-new-files? false }","title":"Project"},{"location":"settings/#global","text":"For global settings which should work for all the projects using clojure-lsp , you just need to add the same configs to ~/.config/clojure-lsp/config.edn or $XDG_CONFIG_HOME/clojure-lsp/config.edn . Note: ~/.lsp/config.edn is considered too but deprecated. For an example of a global config.edn , check here .","title":"Global"},{"location":"settings/#initializationoptions","text":"This is specific for a client, which it sends to clojure-lsp on startup, check LSP spec for more information . This is useful if you are changing a default for a client/editor that will affect all users of that editor. This is an example how Emacs lsp-mode pass custom information. Another example, for neovim users, using coc.nvim and coc-clojure can be found here If you are using a client which defines InitializationOptions as a json object, you can use json types instead: keyword -> string or colon-prefixed string ( \"incremental\" or \":incremental\" ) map -> object ( {\"unused-public-ns\": {\"level\": \"info\"}} ) set -> array ( [\"src\" \"test\"] ) vector -> array ( [\"src\" \"test\"] )","title":"InitializationOptions"},{"location":"settings/#classpath-config-paths","text":"When starting the server, clojure-lsp will search for a specific path clojure-lsp.exports/<group-id>/<artifact-id>/config.edn for extra configurations in the classpath, only if you set the setting :classpath-config-paths containing that group/artifact . Example: Lib my-org/my-lib could have a clojure-lsp config edn that makes sense for the usages of that lib, making available on the classpath: my-lib/resources/clojure-lsp.exports/my-org/my-lib/config.edn { :cljfmt { :indents { foo [[ :block 0 ]]}}} and then if your project use/has the my-org/my-lib inside your classpath, you could add the setting your-project/.lsp/config.edn { :classpath-config-paths [ \"my-org/my-lib\" ]} And then clojure-lsp will merge the configuration from the lib with the other configurations from your project. This is useful if you have some rule to apply to clojure-lsp for multiple projects, mostly using via API for linting for example, and want to move the common configuration to some place instead of adding to each project that needs that.","title":"Classpath config paths"},{"location":"settings/#all-settings","text":"You can find all settings and its default values here and below the docs for each one: name description default :clean Settings related to clean-ns refactoring. Check Clean settings below. :additional-snippets Additional user snippets to be available during completing, check the snippets section below [] :add-missing :add-to-rcf Missing requires and imports will be added to the top of the comment form for code actions and completions from within a comment form, can be :ask , :never or :always . :ask :api :exit-on-errors? Whether to exit the clojure-lsp process during api/cli call if any error is found, like classpath scan failure true :auto-add-ns-to-new-files? Whether to automatically add the ns form in new blank files. true :cache-path Where to store the project's analysis cache, used to speed up next clojure-lsp startup. A path relative to project root or an absolute path. .lsp/.cache :classpath-config-paths List of extra configurations to load from classpath, for more info, check Classpath config paths section. [] :cljfmt-config-path Where to find cljfmt configuration for formatting. A path relative to project root or an absolute path. Use #re for regex inside the cljfmt configuration file. .cljfmt.edn :cljfmt If no :cljfmt-config-path is provided, used this for formatting, json encoded configuration for cljfmt {} :code-lens :segregate-test-references Segregate main references from test references with option to disable true :completion :analysis-type The type for analysis to be performed during the completion, accepted values are fast-but-stale which won't wait for remaining analysis to complete to process the completion and slow-but-accurate which will wait for any changes on document to then process the completion items. :fast-but-stale :completion :additional-edits-warning-text A warning to show when the completion will perform additional edits, such as requiring a new alias. Appears in the completion items' documentation. nil :copy-kondo-configs? Whether to copy clj-kondo hooks configs exported by libs on classpath during startup lint. true :dependency-scheme Defines the format that the client and server should use for URLs of dependencies in jars. The two valid values are \"jar\" and \"zipfile\" . Different editors may handle these URLs differently. For example, in nvim when a \"zipfile\" URI is opened, the file will be editable, but \"jar\" URIs will not be. (This can be powerful, but if you edit a jar in your .m2 directory, you may break other projects.) \"jar\" will make urls compatible with java's JarURLConnection. Clients that can't extract the jar natively can make an LSP extension request of clojure/dependencyContents with the jar uri and the server will return the jar entry's contents, an approach used by some Java clients \"zipfile\" :document-formatting? if true or not present, document formatting is provided. true :document-range-formatting? if true or not present, document range formatting is provided. true :hover :arity-on-same-line? Whether to keep the arity on the same line of the function on hover, useful for Emacs users. false :hover :clojuredocs Whether to get clojuredocs information on hover, the clojuredocs content is cached. true :hover :hide-file-location? Whether to show the full filename and path on hover. false :source-paths-ignore-regex list of regex to filter source-paths. By default, source-paths are retrieved from classpath, and usually the classpath contains folders that are not directly project code or it's auto-generated like cljs resources or target folders but it's inside your project. Replace old :ignore-classpath-directories setting. [\"target.*\"] :paths-ignore-regex list of regex to filter paths to be analyzed. Useful for excluding huge files or folders that may affect final analysis size and performance, like huge edn files. [] :java :download-jdk-source? Whether to download JDK source from :java :jdk-source-download-uri and cache after startup for JDK classes java support. false :java :home-path Whether to use this path to find JDK source and cache after startup for JDK classes java support. nil :java :jdk-source-uri URI containing the JDK source to be used. If :download-jdk-source? is enabled and URI is NOT file:// then download the source. Check https://github.com/clojure-lsp/jdk-source for more sources. https://raw.githubusercontent.com/clojure-lsp/jdk-source/main/openjdk-19/reduced/source.zip :java :decompile-jar-as-project? Whether to decompile the whole jar as a java project when finding the definition of a java class, useful to navigate to other classes from that java class. true :keep-parens-when-threading? Whether to keep parenthesis when threading single arity functions. false :lint-project-files-after-startup? Whether to async lint all project only files after startup to make features like List project errors work. true :diagnostics :range-type which range use for diagnostics, :full makes the range be the whole affected diagnostic while :simple makes the range be the first character of the diagnostic. :full :linters clojure-lsp custom linters, check the diagnostics settings section below :log-path A absolute path to a file where clojure-lsp should log. A JVM tmp path, usually /tmp/clojure-lsp.*.out :notify-references-on-file-change Whether to update diagnostics of the changed references when editing files, avoiding outdated diagnostics in other files. true :project-specs A vector of a map with :project-path and :classpath-cmd , defining how clojure-lsp should find your project classpath. The :project-path should be a file and the :classpath-cmd the command to run to get the classpath Check Classpath scan section below :semantic-tokens? Whether to enable LSP semantic tokens server support for syntax highlighting. true :source-aliases Used for deps.edn or project.clj projects, the aliases which clojure-lsp should get the source-paths besides the root level :paths and :extra-paths . Check the Source paths discovery section below. #{:dev :test} :source-paths project-local directories to look for clj/cljc/cljs files, if using deps.edn , project.clj or bb.edn , use :source-aliases instead. #{\"src\" \"test\"} :stubs Stub generation related settings, check the Stub generation section below. :text-document-sync-kind The sync kind during document changes, if client should send whole buffer or just related changes. Should be :full or :incremental :full :use-metadata-for-privacy? Whether to use ^:private metadata for refactorings instead of defn- false :analysis :keywords :definitions Whether to enable keyword definitions analysis for performance. true :analysis :keywords :usages Whether to enable keyword usages analysis for performance. true :analysis :java :class-definitions Whether to enable java class definitions analysis for performance. true :analysis :java :member-definitions Whether to enable java member definitions analysis for performance. true :analysis :symbols Whether to enable symbols analysis for performance. true","title":"All settings"},{"location":"settings/#classpath-scan","text":"clojure-lsp needs to analyze the whole project and its dependencies to understand your code for most features, during the startup clojure-lsp will try to find the classpath of your project to pass to clj-kondo later. You can configure how clojure-lsp should find the classpath with the project-specs setting, but keep in mind that usually the default is enough, it will also consider the :source-aliases setting if any to find the classpath using those aliases. Supported project types at the moment are: leiningen : If a project.clj is found at the project root, clojure-lsp will run lein classpath with :source-aliases specified if any. deps : If a deps.edn is found at the project root, clojure-lsp will run clojure -Spath with :source-aliases specified if any. boot : If a build.boot is found at the project root, clojure-lsp will run boot show --fake-classpath . shadow-cljs : If a shadow-cljs.edn is found at the project root, clojure-lsp will run npx shadow-cljs classpath . babashka : If a bb.edn is found at the project root, clojure-lsp will run bb print-deps --format classpath . Note that it's possible to have more than one project type at the same time e.g. deps + babashka, clojure-lsp will merge the classpath and everything should work fine. Make sure to have these programs available on the PATH environment variable used by your editor, otherwise clojure-lsp will warn about a classpath scan fail, causing a lot of features to not work properly. Alternatively, you can configure the project-specs specific for your project, for example: .lsp/config.edn { :project-specs [{ :project-path \"deps.edn\" :env { \"PATH\" \"/some/custom/path\" } ;; optional if you want to override the PATH used in the classpath-cmd :classpath-cmd [ \"clojure\" \"-A:my-custom-alias\" \"-Spath\" ]}]} Note that clojure-lsp will make this scan to save the cache when: The project has no cache ( .lsp/.cache ) The project deps file ( project.clj for example) changed. The clj-kondo config has changed.","title":"Classpath scan"},{"location":"settings/#diagnostics-linter","text":"Default: Check :linters in all-available-settings.edn .","title":"Diagnostics (linter)"},{"location":"settings/#clj-kondo","text":"clojure-lsp uses clj-kondo under the hood to lint the code and retrieve the analysis to make most of features work, you don't have to install clj-kondo to make it work. clojure-lsp will use a specific clj-kondo version that can be retrieved via clojure-lsp --version , but make sure you have it properly configured in your .clj-kondo/config.edn file. It has the possible key/values: :clj-kondo :level with available values: :off , :on with default value of :on :report-duplicates which will show all linters of the same symbol instead of showing only the first spot. Available values: true , false with default value of true ns-exclude-regex which will exclude the diagnostics/findings for namespaces that match this regex. Example: .lsp/config.edn { :linters { :clj-kondo { :level :on :report-duplicates true :ns-exclude-regex \"some-ns.*\" }}} Note for vim users If you are a (neo)vim user and have [ale](https://github.com/dense-analysis/ale) installed as a plugin, you **should not** have this configured as a linter `let g:ale_linters = {'clojure': ['clj-kondo']}` in your vimrc. Having this linter enabled via `ale` will only conflict with the built-in clj-kondo bundled with clojure-lsp. Also, clojure-lsp by default pass copy-configs flag as true to clj-kondo to copy configurations exported from libs on classpath, to disable this behavior, set copy-kondo-configs? setting to false. For more information about all clj-kondo available configurations, check the clj-kondo configuration section","title":"clj-kondo"},{"location":"settings/#custom-clj-kondo-linters","text":"Clojure-lsp register custom linters in clj-kondo, for specifically those linters, configurations should be done on clj-kondo config files, e.g. ( <project>/.clj-kondo/config.edn ). Note that configuring these custom linters via clj-kondo's ns metadata config is not supported. Below are the custom linters used:","title":"Custom clj-kondo linters"},{"location":"settings/#clojure-lspunused-public-var","text":"A custom linter that reports public functions/vars not used over the project. It has the possible key/values: :level with available values: :info , :warning , :error or :off with default value of :info . :exclude a whole namespace with #{my-ns} or a specific var #{my-ns/foo} . :exclude-regex same as above but with support for regex, like #{\"my-ns/f.*\"} . :exclude-when-defined-by excludes this linter when your var is defined by a macro for example, like #{my-ns/deftest} . :exclude-when-defined-by-regex same as above but with support for regex, like #{\"my-ns/.*\"} . :exclude-when-contains-meta excludes this linter when your var has any of these metas, like #{:my-meta} . :ignore-test-references? whether to ignore test references of a var-definition when considering if the var is unused. Useful to check functions that have tests but are not being used in the source code. Default: false . Example: .clj-kondo/config.edn { :linters { :clojure-lsp/unused-public-var { :level :warning :exclude # { my-ns/foo my-ns/bar other-ns my-func } :exclude-regex # { \"my-integration-tests.*\" } :exclude-when-defined-by # { my-ns/defflow } :exclude-when-defined-by-regex # { \"my.custom/macro-.*\" } :exclude-when-contains-meta # { :my-cool-meta } :ignore-test-references? true }}}","title":"clojure-lsp/unused-public-var"},{"location":"settings/#clojure-lspdifferent-aliases","text":"Sometimes, it's desirable to use the same alias across namespaces to enhance readability and reduce cognitive load. It has the possible keys/values: :level with available values: :info , :warning , :error or :off with default value of :off . :exclude-aliases ignores the symbols provided in a set, example #{sut}","title":"clojure-lsp/different-aliases"},{"location":"settings/#clj-depend","text":"clojure-lsp uses clj-depend when any clj-depend config is found either on clojure-lsp config or as a .clj-depend/config.edn file. The clj-depend config should be within the :config key. { :config { :layers { :controller { :defined-by \".*\\\\.controller\\\\..*\" :accesses-layers # { :logic }} :logic { :defined-by \".*\\\\.logic\\\\..*\" :accesses-layers # { :model }}}}} When you need to inform some other parameter for clj-depend that is not a config, you can inform it this way: { :config { ,,, } :snapshot? true }","title":"clj-depend"},{"location":"settings/#disable-linter","text":"It's not recommended to disable a linter as it provides helpful smart checks/suggestions for your code, even so it's possible via the following config: .lsp/config.edn { :linters { :clj-kondo { :level :off } :clj-depend { :level :off }}} For information on how to troubleshoot the linter, check the troubleshooting section","title":"Disable linter"},{"location":"settings/#source-paths-discovery","text":"Some features require know the available source paths of your project, where your code lives, clojure-lsp has some settings for that. By default, clojure-lsp will infer source-paths from the classpath, excluding files that are jar and not under project-root, this usually works for most cases, if not, check next items. You can specify a source-aliases setting, making clojure-lsp use those alias when conmputing the classpath, e.g. #{:src :test :my-alias} If that is not enough, for example you have source-paths that are not included on any project profile (not recommended), you can manually specify via the :source-paths settings. e.g [\"src\" \"test\" \"my/other/folder\"] .","title":"Source paths discovery"},{"location":"settings/#clean","text":"Default: Check :clean in all-available-settings.edn .","title":"Clean"},{"location":"settings/#automatically-after-ns-refactor","text":"Whether to call clean-ns on the namespace after applying any refactor to it like adding missing require/imports/refers.","title":"automatically-after-ns-refactor"},{"location":"settings/#ns-inner-blocks-indentation","text":"How to indent ns children forms like require,import.","title":"ns-inner-blocks-indentation"},{"location":"settings/#next-line","text":"Keep first child on the next line of :require / :import and next children following the same indentation. Recommended by how-to-ns guide too. Check ;; better on Clojure Style Guide .","title":"next-line"},{"location":"settings/#same-line","text":"Keep first child on the same line of :require / :import and next children following the same indentation. Check ;; good on Clojure Style Guide .","title":"same-line"},{"location":"settings/#keep","text":"Don't change indentation at all, keeping the one user selected first.","title":"keep"},{"location":"settings/#ns-import-classes-indentation","text":"How to indent classes inside package imports from :import form. Note: package imports with only one class will keep indentation: Ex: [java.io File]","title":"ns-import-classes-indentation"},{"location":"settings/#next-line_1","text":"Keep the first class inside a package import on the next line and next children following the same indentation. Ex: ( :import [ java.io File Foo ])","title":"next-line"},{"location":"settings/#same-line_1","text":"Keep the first class inside a package import on the same line and next children following the same indentation. Ex: ( :import [ java.io File Foo ]) Also, check :sort :import-classes below for more customizations.","title":"same-line"},{"location":"settings/#sort","text":"to disable a specific sort you can set it to nil, example: { :clean { :sort { :import-classes nil }}}","title":"sort"},{"location":"settings/#ns","text":"Whether to enable sort of ns children like require, import forms following Clojure Style Guide .","title":"ns"},{"location":"settings/#require","text":"Whether to enable sort of :require form. true to sort according to the Clojure Style Guide, :lexicographically to do a lexicographic sort that places unwrapped namespaces last.","title":"require"},{"location":"settings/#import","text":"Whether to enable sort of :import form.","title":"import"},{"location":"settings/#import-classes","text":"Whether to enable sort of package classes inside :import form. :classes-per-line : the max classes allowed to keep in a single line, if more than this value, clojure-lsp will move all classes to :next-line or :same-line following :ns-import-classes-indentation , Possivel values: any positive number or -1 to keep all classes in the same line.","title":"import-classes"},{"location":"settings/#refer","text":"Whether to enable sort of :refer form. :max-line-length : the max refers to keep at same line before breaking the line. Default 80 .","title":"refer"},{"location":"settings/#snippets","text":"Besides the 19 built-in snippets, it's possible to configure custom additional snippets via :additional-snippets setting: :name the name to use while completing to reach that snippet. :detail Custom text to show along with the completion name. :snippet The body of the snippet, besides any text it can contains: $1 , $2 , ... as the tabstops representing each place where user may change the content. $0 as the last tabstop. $current-form to replace the current form in the snippet. Example: { :additional-snippets [{ :name \"wrap-let-sexpr\" :detail \"Wrap current sexpr in let\" :snippet \"(let [$1] $0$current-form)\" }]} when completion is called on the code below with the cursor as | wrap| ( + 1 2 ) It should return a completion item that after applied should result in: ( let [ | ] ( + 1 2 ))","title":"Snippets"},{"location":"settings/#java-support","text":"At the moment, clojure-lsp only supports find definition of java classes and completion of fields/methods when it detects a Java class (mostly from static classes usages), other features are not supported yet. When a find-definition of a java class is triggered, clojure-lsp checks the following: If the java source( .java ) is available on classpath, clojure-lsp just return that file location. If the java source is not available, only the .class , clojure-lsp decompiles it. If :java :decompile-jar-as-project? is enabled, clojure-lsp decompiles the whole jar at the global cache folder ( ~/.cache/clojure-lsp/java ) If :java :decompile-jar-as-project? is disabled, clojure-lsp decompiles the class file at the local cache folder ( .lsp/.cache/java ) If the java class is from JDK (e.g. java.util.UUID ), clojure-lsp tries a few things to be able to sucessfully find the definition, following this waterfall decision: Most JRE installations contains the java source code in a src.zip , clojure-lsp tries to find it via :java :home-path setting if provided, JAVA_HOME env var or java command on PATH , if found clojure-lsp extracts to its global cache dir ($XDG_CACHE or ~/.cache/clojure-lsp ) to be used in other projects. If src.zip is not found or user specified a custom :java :jdk-source-uri , clojure-lsp tries to download the source from that uri, only if :java :download-jdk-source? is enabled, disabled by default, extracting to the global cache dir later.","title":"Java support"},{"location":"settings/#stub-generation","text":"It's possible to configure clojure-lsp to generate and analyze stubs for specific namespaces available on your project classpath, this is useful for closed source dependencies like datomic.api , with that clojure-lsp will be able to make most features work with those dependencies. The available settings inside :stubs are: :generation for auto stubs generation: :namespaces the namespaces to generate and analyze stubs, empty by default disabling stub generation. :output-dir the output where to generate the stubs, by default .lsp/.cache/stubs :java-command the path to java command to spawn the stub process, default use java from $PATH . :extra-dirs , dirs to analyze to consider as part of manual generated stubs. Empty by default. Example: { :stubs { :generation { :namespaces # { \"datomic.api\" }}}} This should generate stubs for datomic.api namespace only on .lsp/.cache/stubs and clojure-lsp should analyze that during startup to provide completion, hover and other features. Or to use manual generated stubs: { :stubs { :extra-dirs [ \".my-stubs\" ]}} clojure-lsp will generate no stubs with that, but analyze that folder and consider it as manual generated stubs.","title":"Stub generation"},{"location":"settings/#changing-settings","text":"clojure-lsp supports workspace/didChangeConfiguration commands to change the server settings while it is running, everything inside the :settings map can be changed, but not outside it (the project root for example).","title":"Changing settings"},{"location":"troubleshooting/","text":"Troubleshooting # Logs # Server log # clojure-lsp logs most of what is doing to a file which location could be found: on :log-path if specified in your clojure-lsp config, for example: {:log-path \"/tmp/clojure-lsp.out\"} Auto generated every server start on /tmp/clojure-lsp.<TIMESTAMP>.out or /var/folders/... for MacOS. Emacs users You can open server logs in a buffer with M-x lsp-clojure-server-log . Client<->Server log # All LSP clients should provide a way to get the jsonrpc logs between client and server, this helps debug the requests and responses content and time. Check below how to get the logs for most used clients: Emacs/lsp-mode https://emacs-lsp.github.io/lsp-mode/page/troubleshooting/#log-client-server-json VSCode/Calva https://calva.io/clojure-lsp/#viewing-the-logs-between-the-client-and-server An alternative is to pass --trace-level verbose to clojure-lsp during process start and clojure-lsp will log the communication to the server-log. Server Info # clojure-lsp has a custom command that prints useful information about the current running clojure-lsp for the current project, it's called clojure/serverInfo/log , some clients already have ways to call that automatically: Emacs lsp-mode: via lsp-clojure-server-info command. VsCode Calva: via Calva Diagnostics: Clojure-lsp Server Info command. Intellij clojure-lsp plugin: via Settings Tools Clojure LSP Copy server info to clipboard option. Some features are not working # clojure-lsp uses clj-kondo to analyze the classpath during server initialize for most features work, so make sure you don't see any \"Error while looking up classpath...\" on clojure-lsp log file. Please note that clojure-lsp comes bundled with clj-kondo , so you do not have to install it separately. For more information, check the Classpath scan settings section. Classpath scan error # By default clojure-lsp knows how to scan most common clojure projects using the following rules: If the project root has a project.clj file, it'll run lein classpath to get the classpath. If the project root has a deps.edn file, it'll run clojure -Spath to get the classpath. If the project root has a build.boot file, it'll run boot show --fake-classpath to get the classpath. If the project root has a shadow-cljs.edn file, it'll run npx shadow-cljs classpath to get the classpath. If your project doesn't follow the above rules or you need a custom command to get the classpath you need to configure the project-specs clojure-lsp setting, for more details check the settings section . Folders not being analyzed/linted # By default clojure-lsp get source-paths from classpath, for more details check settings section . If the definition lives under a different source dir, you can define source-aliases or source-paths setting as mentioned on settings section . It is also important to get your project-root correct in your client otherwise the source paths will not be found, check the project-root via your LSP client. If you are using deps and using a :local/root dependency to reference another project, i.e., { :deps { foo.bar/baz { :local/root \"/path/to/foo/project/containing/a/deps.edn\" }}} and you are finding that gotoDefinition isn't working when attempting to jump to the namespace in the referenced project, then it could be that your ~/.config/clojure-lsp/config.edn (or legacy ~/.lsp/config.edn ) has a source paths entry, i.e., :source-paths [\"src\" \"test\"] . This will prevent the lookup from working, as it restricts clojure-lsp to only scan those folders in the current project for sources, and not the other project referenced via the :local/root deps entry. It can be fixed by removing the :source-paths from the config (as clojure-lsp has good defaults anyway). If you do require more specific source paths, then those can be added at the project level. Wrong diagnostics/lint # clojure-lsp use clj-kondo to lint and cache in a .clj-kondo/.cache dir, try to remove that folder if you think it's not linting correctly clojure-lsp persist the external jars analysis in a .lsp/.cache/ folder, if you have issues with some specific feature, try to remove that dir and restart the server. If you have issues with macros, double check your clj-kondo config . Missing Add require... on code actions when using CoC and (neo)vim # If you find, when executing the command (coc-codeaction-line) (or (coc-codeaction-selected) or (coc-codeaction-cursor) ), that you aren't getting back all of the code actions you might expect, please ensure that you have, in your coc-settings.json the line disableDiagnostics set to false or better yet, don't have the line there at all :- ---) Server is not initializing # Make sure you have the most recent version of clojure-lsp Check if the executable is working running it from the command line, it should start up and start reading from stdin. Type Content-Length: 51\\n\\n{\"jsonrpc\":\"2.0\",\"method\":\"foo\",\"id\":1,\"params\":{}} . After a few moments you should get something like: $ ./clojure-lsp Content-Length: 51 {\"jsonrpc\":\"2.0\",\"method\":\"foo\",\"id\":1,\"params\":{}} Content-Length: 101 {\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32601,\"message\":\"Method not found\",\"data\":{\"method\":\"foo\"}}} If that is ok, clojure-lsp logs to /tmp/clojure-lsp.*.out , so watch that file and start your editor. LSP Clients also generally have a way to trace server interactions. Turn that on and attach both server and client logs to an issue if it's not obvious what's going on. Vim users For example, if you are using neovim with CoC , first ensure that trace.server is set to verbose in your coc-settings.json file, e.g., \"languageserver\": { \"clojure-lsp\": { \"command\": \"clojure-lsp\", \"filetypes\": [\"clojure\"], \"disableDiagnostics\": false, \"rootPatterns\": [\"deps.edn\", \"project.clj\"], \"additionalSchemes\": [\"jar\", \"zipfile\"], \"trace.server\": \"verbose\", \"initializationOptions\": { \"project-specs\": [{ \"project-path\": \"deps.edn\", \"classpath-cmd\": [\"clj\", \"-Spath\"] }], \"use-metadata-for-privacy?\": true, } } } Then, once vim has loaded (and clojure-lsp has initialised), you can issue this command: :CocCommand workspace.showOutput This will show the JSON request/response bodies that go between vim and clojure-lsp. Please capture that information if you need help in tracking down the problem you are experiencing (either by reporting github issues, or talking with someone in Slack/Discord or whatever...) High memory usage # clojure-lsp uses a native image that helps a lot with memory usage, but there is no hard limit so for huge Clojure projects or projects with lots of dependencies, memory may be a issue because of multiple analysis (keywords, function usages, java class/members etc). It's possible to retrieve the project analysis of a running clojure-lsp process via the serverInfo command, a :analysis map will contain both internal (your project) and external (project dependencies) count of each analysis used by clojure-lsp, extremally high count of elements (> hundred thousand) tends to increase memory usage + cache size ( .lsp/.cache ). As last resource if your project has a enormous number of some specific elements, it's possible to disable some analysis which should help decrease memory usage and even increase performance via the :analysis setting, but keep in mind that some features related to those analysis may not work, for example, {:analysis {:keywords false}} will remove support for find-references of keywords, or {:analysis {:java {:class-definitions false :member-definitions false}}} will completly disable java features like auto completion of java elements. MacOS # In some version of MacOS, Apple restrict the binary to run, to fix that run: xattr -d com.apple.quarantine /path/to/clojure-lsp","title":"Troubleshooting"},{"location":"troubleshooting/#troubleshooting","text":"","title":"Troubleshooting"},{"location":"troubleshooting/#logs","text":"","title":"Logs"},{"location":"troubleshooting/#server-log","text":"clojure-lsp logs most of what is doing to a file which location could be found: on :log-path if specified in your clojure-lsp config, for example: {:log-path \"/tmp/clojure-lsp.out\"} Auto generated every server start on /tmp/clojure-lsp.<TIMESTAMP>.out or /var/folders/... for MacOS. Emacs users You can open server logs in a buffer with M-x lsp-clojure-server-log .","title":"Server log"},{"location":"troubleshooting/#client-server-log","text":"All LSP clients should provide a way to get the jsonrpc logs between client and server, this helps debug the requests and responses content and time. Check below how to get the logs for most used clients: Emacs/lsp-mode https://emacs-lsp.github.io/lsp-mode/page/troubleshooting/#log-client-server-json VSCode/Calva https://calva.io/clojure-lsp/#viewing-the-logs-between-the-client-and-server An alternative is to pass --trace-level verbose to clojure-lsp during process start and clojure-lsp will log the communication to the server-log.","title":"Client&lt;-&gt;Server log"},{"location":"troubleshooting/#server-info","text":"clojure-lsp has a custom command that prints useful information about the current running clojure-lsp for the current project, it's called clojure/serverInfo/log , some clients already have ways to call that automatically: Emacs lsp-mode: via lsp-clojure-server-info command. VsCode Calva: via Calva Diagnostics: Clojure-lsp Server Info command. Intellij clojure-lsp plugin: via Settings Tools Clojure LSP Copy server info to clipboard option.","title":"Server Info"},{"location":"troubleshooting/#some-features-are-not-working","text":"clojure-lsp uses clj-kondo to analyze the classpath during server initialize for most features work, so make sure you don't see any \"Error while looking up classpath...\" on clojure-lsp log file. Please note that clojure-lsp comes bundled with clj-kondo , so you do not have to install it separately. For more information, check the Classpath scan settings section.","title":"Some features are not working"},{"location":"troubleshooting/#classpath-scan-error","text":"By default clojure-lsp knows how to scan most common clojure projects using the following rules: If the project root has a project.clj file, it'll run lein classpath to get the classpath. If the project root has a deps.edn file, it'll run clojure -Spath to get the classpath. If the project root has a build.boot file, it'll run boot show --fake-classpath to get the classpath. If the project root has a shadow-cljs.edn file, it'll run npx shadow-cljs classpath to get the classpath. If your project doesn't follow the above rules or you need a custom command to get the classpath you need to configure the project-specs clojure-lsp setting, for more details check the settings section .","title":"Classpath scan error"},{"location":"troubleshooting/#folders-not-being-analyzedlinted","text":"By default clojure-lsp get source-paths from classpath, for more details check settings section . If the definition lives under a different source dir, you can define source-aliases or source-paths setting as mentioned on settings section . It is also important to get your project-root correct in your client otherwise the source paths will not be found, check the project-root via your LSP client. If you are using deps and using a :local/root dependency to reference another project, i.e., { :deps { foo.bar/baz { :local/root \"/path/to/foo/project/containing/a/deps.edn\" }}} and you are finding that gotoDefinition isn't working when attempting to jump to the namespace in the referenced project, then it could be that your ~/.config/clojure-lsp/config.edn (or legacy ~/.lsp/config.edn ) has a source paths entry, i.e., :source-paths [\"src\" \"test\"] . This will prevent the lookup from working, as it restricts clojure-lsp to only scan those folders in the current project for sources, and not the other project referenced via the :local/root deps entry. It can be fixed by removing the :source-paths from the config (as clojure-lsp has good defaults anyway). If you do require more specific source paths, then those can be added at the project level.","title":"Folders not being analyzed/linted"},{"location":"troubleshooting/#wrong-diagnosticslint","text":"clojure-lsp use clj-kondo to lint and cache in a .clj-kondo/.cache dir, try to remove that folder if you think it's not linting correctly clojure-lsp persist the external jars analysis in a .lsp/.cache/ folder, if you have issues with some specific feature, try to remove that dir and restart the server. If you have issues with macros, double check your clj-kondo config .","title":"Wrong diagnostics/lint"},{"location":"troubleshooting/#missing-add-require-on-code-actions-when-using-coc-and-neovim","text":"If you find, when executing the command (coc-codeaction-line) (or (coc-codeaction-selected) or (coc-codeaction-cursor) ), that you aren't getting back all of the code actions you might expect, please ensure that you have, in your coc-settings.json the line disableDiagnostics set to false or better yet, don't have the line there at all :- ---)","title":"Missing Add require... on code actions when using CoC and (neo)vim"},{"location":"troubleshooting/#server-is-not-initializing","text":"Make sure you have the most recent version of clojure-lsp Check if the executable is working running it from the command line, it should start up and start reading from stdin. Type Content-Length: 51\\n\\n{\"jsonrpc\":\"2.0\",\"method\":\"foo\",\"id\":1,\"params\":{}} . After a few moments you should get something like: $ ./clojure-lsp Content-Length: 51 {\"jsonrpc\":\"2.0\",\"method\":\"foo\",\"id\":1,\"params\":{}} Content-Length: 101 {\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32601,\"message\":\"Method not found\",\"data\":{\"method\":\"foo\"}}} If that is ok, clojure-lsp logs to /tmp/clojure-lsp.*.out , so watch that file and start your editor. LSP Clients also generally have a way to trace server interactions. Turn that on and attach both server and client logs to an issue if it's not obvious what's going on. Vim users For example, if you are using neovim with CoC , first ensure that trace.server is set to verbose in your coc-settings.json file, e.g., \"languageserver\": { \"clojure-lsp\": { \"command\": \"clojure-lsp\", \"filetypes\": [\"clojure\"], \"disableDiagnostics\": false, \"rootPatterns\": [\"deps.edn\", \"project.clj\"], \"additionalSchemes\": [\"jar\", \"zipfile\"], \"trace.server\": \"verbose\", \"initializationOptions\": { \"project-specs\": [{ \"project-path\": \"deps.edn\", \"classpath-cmd\": [\"clj\", \"-Spath\"] }], \"use-metadata-for-privacy?\": true, } } } Then, once vim has loaded (and clojure-lsp has initialised), you can issue this command: :CocCommand workspace.showOutput This will show the JSON request/response bodies that go between vim and clojure-lsp. Please capture that information if you need help in tracking down the problem you are experiencing (either by reporting github issues, or talking with someone in Slack/Discord or whatever...)","title":"Server is not initializing"},{"location":"troubleshooting/#high-memory-usage","text":"clojure-lsp uses a native image that helps a lot with memory usage, but there is no hard limit so for huge Clojure projects or projects with lots of dependencies, memory may be a issue because of multiple analysis (keywords, function usages, java class/members etc). It's possible to retrieve the project analysis of a running clojure-lsp process via the serverInfo command, a :analysis map will contain both internal (your project) and external (project dependencies) count of each analysis used by clojure-lsp, extremally high count of elements (> hundred thousand) tends to increase memory usage + cache size ( .lsp/.cache ). As last resource if your project has a enormous number of some specific elements, it's possible to disable some analysis which should help decrease memory usage and even increase performance via the :analysis setting, but keep in mind that some features related to those analysis may not work, for example, {:analysis {:keywords false}} will remove support for find-references of keywords, or {:analysis {:java {:class-definitions false :member-definitions false}}} will completly disable java features like auto completion of java elements.","title":"High memory usage"},{"location":"troubleshooting/#macos","text":"In some version of MacOS, Apple restrict the binary to run, to fix that run: xattr -d com.apple.quarantine /path/to/clojure-lsp","title":"MacOS"},{"location":"api/api/","text":"API (JVM) # The namespace clojure-lsp.api should be used as the entrypoint for all available features of the CLI and some specific for library only usage, feel free to open a issue for missing features. Below is an example using the clean-ns feature on a deps.edn project: { :aliases { :lint-ns { :replace-deps { com.github.clojure-lsp/clojure-lsp { :mvn/version \"...\" }} :exec-fn clojure-lsp.api/clean-ns! :exec-args { :dry? true }}}}","title":"API (JVM)"},{"location":"api/api/#api-jvm","text":"The namespace clojure-lsp.api should be used as the entrypoint for all available features of the CLI and some specific for library only usage, feel free to open a issue for missing features. Below is an example using the clean-ns feature on a deps.edn project: { :aliases { :lint-ns { :replace-deps { com.github.clojure-lsp/clojure-lsp { :mvn/version \"...\" }} :exec-fn clojure-lsp.api/clean-ns! :exec-args { :dry? true }}}}","title":"API (JVM)"},{"location":"api/bb-pod/","text":"Babashka pod # It's possible to load clojure-lsp as a babashka pod giving access to the clojure-lsp.api namespace, Check babashka pod registry example .","title":"Babashka pod"},{"location":"api/bb-pod/#babashka-pod","text":"It's possible to load clojure-lsp as a babashka pod giving access to the clojure-lsp.api namespace, Check babashka pod registry example .","title":"Babashka pod"},{"location":"api/ci/","text":"CI # Having clojure-lsp cli in your CI machine is enough to run any task, if using Github Actions, you can use setup-clojure-lsp GitHub action to install clojure-lsp in your CI. Remember to install your build tool, like clojure or leiningen as well in your CI according to your project to clojure-lsp be able to scan the classpath correctly.","title":"CI"},{"location":"api/ci/#ci","text":"Having clojure-lsp cli in your CI machine is enough to run any task, if using Github Actions, you can use setup-clojure-lsp GitHub action to install clojure-lsp in your CI. Remember to install your build tool, like clojure or leiningen as well in your CI according to your project to clojure-lsp be able to scan the classpath correctly.","title":"CI"},{"location":"api/cli/","text":"CLI (terminal) # clojure-lsp --help should show all available commands and options: Clojure development tool implementing LSP Usage: clojure-lsp <command> [<options>] All options: -h, --help Print the available commands and its options --version Print clojure-lsp version --verbose Use stdout for clojure-lsp logs instead of default log settings --trace Deprecated: use --trace-level instead. --trace-level LEVEL off Enable trace logs between client and server, for debugging. Set to 'messages' for basic traces, or 'verbose' for more detailed traces. Defaults to 'off' for no traces. -s, --settings SETTINGS Optional settings as edn to use for the specified command. For all available settings, check https://clojure-lsp.io/settings --log-path PATH Path to use as the log path for clojure-lsp.out, debug purposes only. --dry false Make no changes to files, only report diffs --raw false Print only necessary data -p, --project-root PATH Specify the path to the project root to clojure-lsp consider during analysis startup. -n, --namespace NS [] Optional namespace to apply the action, all if not supplied. This flag accepts multiple values --filenames FILENAMES Optional filenames to apply the action. Filenames can be either absolute/relatetive files or directories. This flag accepts filenames separated by comma or double colon. --ns-exclude-regex REGEX Optional regex representing the namespaces to be excluded during a command -o, --output EDN Optional settings as edn on how the result should be printed. Check `clojure-lsp.api/diagnostics`/`clojure-lsp.api/dump` for all available options to this flag. --from FROM Full qualified symbol name or ns only, e.g. my-project/my-var. option for rename/references --to TO Full qualified symbol name or ns only, e.g. my-project/my-var. option for rename --analysis EDN Optional settings as edn on how clojure-lsp should consider the analysis. Check `clojure-lsp.api/dump` for all available options to this flag. Available commands: listen (or empty) Start clojure-lsp as server, listening to stdin. clean-ns Organize ns form, removing unused requires/refers/imports and sorting alphabetically. diagnostics Analyze the project and find all diagnostics (warnings, errors). format Format code using cljfmt. rename Rename a symbol and all references across the project, use --from and --to options. references Find all references of a full qualified symbol across the project and/or dependencies, use --from option. dump (experimental) Dump all project known data including classpath, source-paths, dep-graph and clj-kondo analysis data. See https://clojure-lsp.io/settings/ for detailed documentation.","title":"CLI"},{"location":"api/cli/#cli-terminal","text":"clojure-lsp --help should show all available commands and options: Clojure development tool implementing LSP Usage: clojure-lsp <command> [<options>] All options: -h, --help Print the available commands and its options --version Print clojure-lsp version --verbose Use stdout for clojure-lsp logs instead of default log settings --trace Deprecated: use --trace-level instead. --trace-level LEVEL off Enable trace logs between client and server, for debugging. Set to 'messages' for basic traces, or 'verbose' for more detailed traces. Defaults to 'off' for no traces. -s, --settings SETTINGS Optional settings as edn to use for the specified command. For all available settings, check https://clojure-lsp.io/settings --log-path PATH Path to use as the log path for clojure-lsp.out, debug purposes only. --dry false Make no changes to files, only report diffs --raw false Print only necessary data -p, --project-root PATH Specify the path to the project root to clojure-lsp consider during analysis startup. -n, --namespace NS [] Optional namespace to apply the action, all if not supplied. This flag accepts multiple values --filenames FILENAMES Optional filenames to apply the action. Filenames can be either absolute/relatetive files or directories. This flag accepts filenames separated by comma or double colon. --ns-exclude-regex REGEX Optional regex representing the namespaces to be excluded during a command -o, --output EDN Optional settings as edn on how the result should be printed. Check `clojure-lsp.api/diagnostics`/`clojure-lsp.api/dump` for all available options to this flag. --from FROM Full qualified symbol name or ns only, e.g. my-project/my-var. option for rename/references --to TO Full qualified symbol name or ns only, e.g. my-project/my-var. option for rename --analysis EDN Optional settings as edn on how clojure-lsp should consider the analysis. Check `clojure-lsp.api/dump` for all available options to this flag. Available commands: listen (or empty) Start clojure-lsp as server, listening to stdin. clean-ns Organize ns form, removing unused requires/refers/imports and sorting alphabetically. diagnostics Analyze the project and find all diagnostics (warnings, errors). format Format code using cljfmt. rename Rename a symbol and all references across the project, use --from and --to options. references Find all references of a full qualified symbol across the project and/or dependencies, use --from option. dump (experimental) Dump all project known data including classpath, source-paths, dep-graph and clj-kondo analysis data. See https://clojure-lsp.io/settings/ for detailed documentation.","title":"CLI (terminal)"},{"location":"api/lein-plugin/","text":"Leiningen plugin # To run clojure-lsp from Leiningen easily, check lein-clojure-lsp plugin.","title":"Lein plugin"},{"location":"api/lein-plugin/#leiningen-plugin","text":"To run clojure-lsp from Leiningen easily, check lein-clojure-lsp plugin.","title":"Leiningen plugin"},{"location":"api/what-is-it/","text":"What is clojure-lsp API? # clojure-lsp is commonly used in a text editor during code development, but since it knows and have all necessary features to handle clojure code, it's the ideal/reliable tool to manage your code outside the editor as well via multiple ways. It has its own API containing the main features that can be used as: API (JVM) : Use from your REPL or any other library that wants to leverage clojure-lsp features programatically. CLI : Use from your terminal as a tool to format, clean, check diagnostics from clojure-lsp executable directly. CI : Need to check if your code is formatted/clean/doesn't contain any lint errors after push? Use it in your CI. Lein plugin : Use all CLI features but without the need to install it on your machine, using directly as a leiningen plugin. Babashka pod : Use clojure-lsp as a babashka pod for your bb program. Settings # clojure-lsp will check for .lsp/config.edn in the project or home dir, but it's possible to force override the settings via the :settings option of the API or --settings option of the CLI. For all available settings, check the settings documentation .","title":"What is clojure-lsp API?"},{"location":"api/what-is-it/#what-is-clojure-lsp-api","text":"clojure-lsp is commonly used in a text editor during code development, but since it knows and have all necessary features to handle clojure code, it's the ideal/reliable tool to manage your code outside the editor as well via multiple ways. It has its own API containing the main features that can be used as: API (JVM) : Use from your REPL or any other library that wants to leverage clojure-lsp features programatically. CLI : Use from your terminal as a tool to format, clean, check diagnostics from clojure-lsp executable directly. CI : Need to check if your code is formatted/clean/doesn't contain any lint errors after push? Use it in your CI. Lein plugin : Use all CLI features but without the need to install it on your machine, using directly as a leiningen plugin. Babashka pod : Use clojure-lsp as a babashka pod for your bb program.","title":"What is clojure-lsp API?"},{"location":"api/what-is-it/#settings","text":"clojure-lsp will check for .lsp/config.edn in the project or home dir, but it's possible to force override the settings via the :settings option of the API or --settings option of the CLI. For all available settings, check the settings documentation .","title":"Settings"}]}